"use strict";var e=require("hbuilderx"),t=require("fs"),n=require("path"),r=require("os"),i=require("querystring");require("child_process");var o=require("zlib");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=s(e),l=s(t),u=s(n),c=s(r),d=s(i),h=s(o);const f=u.default;var p="win32"===process.platform,m=/^[a-zA-Z]\:\/$/;function g(e){return e.replace(/\\/g,"/")}function y(e){p&&"/"===e.charAt(e.length-1)&&":"!==e.charAt(e.length-2)&&(e=e.substring(0,e.length-1));try{return l.default.statSync(e),!0}catch(e){return!1}}function _(e){var t=e.replace(/\\/g,"/").split("/"),n="";t.forEach((function(e){n+=e+"/",e&&function(e){y(e)||p&&m.test(e)||l.default.mkdirSync(e,511)}(n)}))}var b={backSlashRegExp:/\\/g,exclusionRegExp:/^\./,getLineSeparator:function(){return"/"},exists:function(e){return y(e)},parent:function(e){var t=e.split("/");return t.pop(),t.join("/")},absPath:function(e){return g(f.normalize(g(l.default.realpathSync(e))))},normalize:function(e){return g(f.normalize(e))},isFile:function(e){return l.default.statSync(e).isFile()},isDirectory:function(e){return l.default.statSync(e).isDirectory()},getFilteredFileList:function(e,t,n){var r,i,o,s,a,u,c,d,h,p=[];if(r=e,i=t.include||t,o=t.exclude||null,b.exists(r))for(s=l.default.readdirSync(r),a=0;a<s.length;a++)h=s[a],c=f.join(r,h),(u=l.default.statSync(c)).isFile()?(n&&-1===c.indexOf("/")&&(c=g(c)),d=!0,i&&(d=c.match(i)),d&&o&&(d=!c.match(o)),!d||b.exclusionRegExp&&b.exclusionRegExp.test(h)||p.push(c)):!u.isDirectory()||b.exclusionRegExp&&b.exclusionRegExp.test(h)||this.getFilteredFileList(c,t,n).forEach((function(e){p.push(e)}));return p},copyDir:function(e,t,n,r){n=n||/\w/,e=g(f.normalize(e)),t=g(f.normalize(t));var i,o,s,a=b.getFilteredFileList(e,n,!0),l=[];for(i=0;i<a.length;i++)s=(o=a[i]).replace(e,t),b.copyFile(o,s,r)&&l.push(s);return l.length?l:null},copyFile:function(e,t,n){var r;return!(n&&b.exists(t)&&l.default.statSync(t).mtime.getTime()>=l.default.statSync(e).mtime.getTime())&&(r=f.dirname(t),b.exists(r)||_(r),l.default.writeFileSync(t,l.default.readFileSync(e,"binary"),"binary"),!0)},renameFile:function(e,t){return l.default.renameSync(e,t)},readFile:function(e,t){"utf-8"===t&&(t="utf8"),t||(t="utf8");var n=l.default.readFileSync(e,t);return 0===n.indexOf("\ufeff")&&(n=n.substring(1,n.length)),n},readFileAsync:function(e,t){var n=prim();try{n.resolve(b.readFile(e,t))}catch(e){n.reject(e)}return n.promise},saveUtf8File:function(e,t){b.saveFile(e,t,"utf8")},saveFile:function(e,t,n){var r;"utf-8"===n&&(n="utf8"),n||(n="utf8"),r=f.dirname(e),b.exists(r)||_(r),l.default.writeFileSync(e,t,n)},deleteFile:function(e){var t,n;if(b.exists(e))if(l.default.lstatSync(e).isDirectory()){for(t=l.default.readdirSync(e),n=0;n<t.length;n++)this.deleteFile(f.join(e,t[n]));l.default.rmdirSync(e)}else l.default.unlinkSync(e)},deleteEmptyDirs:function(e){var t,n,r,i;if(b.exists(e)){for(t=l.default.readdirSync(e),n=0;n<t.length;n++)r=t[n],i=f.join(e,r),l.default.lstatSync(i).isDirectory()&&b.deleteEmptyDirs(i);0===l.default.readdirSync(e).length&&b.deleteFile(e)}}},v=b;function w(e){var t={exports:{}};return e(t,t.exports),t.exports}var E=w((function(e,t){e.exports=function(){function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,(function(e){return i(t[s][1][e]||e)}),c,c.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}return e}()({1:[function(e,t,n){function r(e,t,n){var r;return e&&(r={b:e}),t&&((r=r||{}).a=t),n&&((r=r||{}).x=n),r}function i(e,t){if(null!==e&&"object"==typeof e){var n,o,s,l,u=h.getComment(e);if(u&&h.removeComment(e),"[object Array]"===Object.prototype.toString.apply(e)){for(l={a:{}},n=0,o=e.length;n<o;n++)a(l.a,n,u.a[n],i(e[n]))&&(s=!0);!s&&u.e&&(l.e=r(u.e[0],u.e[1]),s=!0)}else{l={s:{}};var c,d=Object.keys(e);for(u&&u.o?(c=[],u.o.concat(d).forEach((function(t){Object.prototype.hasOwnProperty.call(e,t)&&c.indexOf(t)<0&&c.push(t)}))):c=d,l.o=c,n=0,o=c.length;n<o;n++){var f=c[n];a(l.s,f,u.c[f],i(e[f]))&&(s=!0)}!s&&u.e&&(l.e=r(u.e[0],u.e[1]),s=!0)}return t&&u&&u.r&&(l.r=r(u.r[0],u.r[1])),s?l:void 0}}function o(){var e="";return[].forEach.call(arguments,(function(t){t&&""!==t.trim()&&(e&&(e+="; "),e+=t.trim())})),e}function s(e,t){var n=[];if(c(e,t,n,[]),n.length>0){var r=d(t,null,1);r+="\n# Orphaned comments:\n",n.forEach((function(e){r+=("# "+e.path.join("/")+": "+o(e.b,e.a,e.e)).replace("\n","\\n ")+"\n"})),d(t,r,1)}}function a(e,t,n,i){var o=r(n?n[0]:void 0,n?n[1]:void 0,i);return o&&(e[t]=o),o}function l(e,t){var n=r(t.b,t.a);return n.path=e,n}function u(e,t,n){if(e){var r,i;if(e.a)for(r=0,i=e.a.length;r<i;r++){var o=n.slice().concat([r]),s=e.a[r];s&&(t.push(l(o,s)),u(s.x,t,o))}else e.o&&e.o.forEach((function(r){var i=n.slice().concat([r]),o=e.s[r];o&&(t.push(l(i,o)),u(o.x,t,i))}));e.e&&t.push(l(n,e.e))}}function c(e,t,n,r){if(e){if(null===t||"object"!=typeof t)return void u(e,n,r);var i,o=h.createComment(t);if(0===r.length&&e.r&&(o.r=[e.r.b,e.r.a]),"[object Array]"===Object.prototype.toString.apply(t)){o.a=[];var s=e.a||{};for(var a in s)if(s.hasOwnProperty(a)){i=parseInt(a);var d=e.a[a];if(d){var f=r.slice().concat([i]);i<t.length?(o.a[i]=[d.b,d.a],c(d.x,t[i],n,f)):(n.push(l(f,d)),u(d.x,n,f))}}0===i&&e.e&&(o.e=[e.e.b,e.e.a])}else o.c={},o.o=[],(e.o||[]).forEach((function(i){var s=r.slice().concat([i]),a=e.s[i];Object.prototype.hasOwnProperty.call(t,i)?(o.o.push(i),a&&(o.c[i]=[a.b,a.a],c(a.x,t[i],n,s))):a&&(n.push(l(s,a)),u(a.x,n,s))})),e.e&&(o.e=[e.e.b,e.e.a])}}function d(e,t,n){var r=h.createComment(e,h.getComment(e));return r.r||(r.r=["",""]),(t||""===t)&&(r.r[n]=h.forceComment(t)),r.r[n]||""}var h=e("./hjson-common");t.exports={extract:function(e){return i(e,!0)},merge:s,header:function(e,t){return d(e,t,0)},footer:function(e,t){return d(e,t,1)}}},{"./hjson-common":2}],2:[function(e,t,n){function r(e,t){function n(){return i=e.charAt(l),l++,i}var r,i,o="",s=0,a=!0,l=0;for(n(),"-"===i&&(o="-",n());i>="0"&&i<="9";)a&&("0"==i?s++:a=!1),o+=i,n();if(a&&s--,"."===i)for(o+=".";n()&&i>="0"&&i<="9";)o+=i;if("e"===i||"E"===i)for(o+=i,n(),"-"!==i&&"+"!==i||(o+=i,n());i>="0"&&i<="9";)o+=i,n();for(;i&&i<=" ";)n();return t&&(","!==i&&"}"!==i&&"]"!==i&&"#"!==i&&("/"!==i||"/"!==e[l]&&"*"!==e[l])||(i=0)),r=+o,i||s||!isFinite(r)?void 0:r}function i(e,t){return Object.defineProperty&&Object.defineProperty(e,"__COMMENTS__",{enumerable:!1,writable:!0}),e.__COMMENTS__=t||{}}function o(e){Object.defineProperty(e,"__COMMENTS__",{value:void 0})}function s(e){return e.__COMMENTS__}function a(e){if(!e)return"";var t,n,r,i,o=e.split("\n");for(r=0;r<o.length;r++)for(i=(t=o[r]).length,n=0;n<i;n++){var s=t[n];if("#"===s)break;if("/"===s&&("/"===t[n+1]||"*"===t[n+1])){"*"===t[n+1]&&(r=o.length);break}if(s>" "){o[r]="# "+t;break}}return o.join("\n")}var l=e("os");t.exports={EOL:l.EOL||"\n",tryParseNumber:r,createComment:i,removeComment:o,getComment:s,forceComment:a}},{os:8}],3:[function(e,t,n){function r(e,t){function n(e){return"[object Function]"==={}.toString.call(e)}if("[object Array]"!==Object.prototype.toString.apply(e)){if(e)throw new Error("dsf option must contain an array!");return o}if(0===e.length)return o;var r=[];return e.forEach((function(e){if(!e.name||!n(e.parse)||!n(e.stringify))throw new Error("extension does not match the DSF interface");r.push((function(){try{if("parse"==t)return e.parse.apply(null,arguments);if("stringify"==t){var n=e.stringify.apply(null,arguments);if(void 0!==n&&("string"!=typeof n||0===n.length||'"'===n[0]||[].some.call(n,(function(e){return s(e)}))))throw new Error("value may not be empty, start with a quote or contain a punctuator character except colon: "+n);return n}throw new Error("Invalid type")}catch(t){throw new Error("DSF-"+e.name+" failed; "+t.message)}}))})),i.bind(null,r)}function i(e,t){if(e)for(var n=0;n<e.length;n++){var r=e[n](t);if(void 0!==r)return r}}function o(){}function s(e){return"{"===e||"}"===e||"["===e||"]"===e||","===e}function a(){return{name:"math",parse:function(e){switch(e){case"+inf":case"inf":case"+Inf":case"Inf":return 1/0;case"-inf":case"-Inf":return-1/0;case"nan":case"NaN":return NaN}},stringify:function(e){if("number"==typeof e)return 1/e==-1/0?"-0":e===1/0?"Inf":e===-1/0?"-Inf":isNaN(e)?"NaN":void 0}}}function l(e){var t=e&&e.out;return{name:"hex",parse:function(e){if(/^0x[0-9A-Fa-f]+$/.test(e))return parseInt(e,16)},stringify:function(e){if(t&&Number.isInteger(e))return"0x"+e.toString(16)}}}function u(){return{name:"date",parse:function(e){if(/^\d{4}-\d{2}-\d{2}$/.test(e)||/^\d{4}-\d{2}-\d{2}T\d{2}\:\d{2}\:\d{2}(?:.\d+)(?:Z|[+-]\d{2}:\d{2})$/.test(e)){var t=Date.parse(e);if(!isNaN(t))return new Date(t)}},stringify:function(e){if("[object Date]"===Object.prototype.toString.call(e)){var t=e.toISOString();return-1!==t.indexOf("T00:00:00.000Z",t.length-14)?t.substr(0,10):t}}}}a.description="support for Inf/inf, -Inf/-inf, Nan/naN and -0",l.description="parse hexadecimal numbers prefixed with 0x",u.description="support ISO dates",t.exports={loadDsf:r,std:{math:a,hex:l,date:u}}},{}],4:[function(e,t,n){t.exports=function(t,n){function r(){v=0,w=" "}function i(e){return"{"===e||"}"===e||"["===e||"]"===e||","===e||":"===e}function o(e){var t,n=0,r=1;for(t=v-1;t>0&&"\n"!==b[t];t--,n++);for(;t>0;t--)"\n"===b[t]&&r++;throw new Error(e+" at line "+r+","+n+" >>>"+b.substr(v-n,20)+" ...")}function s(){return w=b.charAt(v),v++,w}function a(e){return b.charAt(v+e)}function l(e){for(var t="",n=w;s();){if(w===n)return s(),e&&"'"===n&&"'"===w&&0===t.length?(s(),u()):t;if("\\"===w)if(s(),"u"===w){for(var r=0,i=0;i<4;i++){s();var a,l=w.charCodeAt(0);w>="0"&&w<="9"?a=l-48:w>="a"&&w<="f"?a=l-97+10:w>="A"&&w<="F"?a=l-65+10:o("Bad \\u char "+w),r=16*r+a}t+=String.fromCharCode(r)}else{if("string"!=typeof F[w])break;t+=F[w]}else"\n"===w||"\r"===w?o("Bad string containing newline"):t+=w}o("Bad string")}function u(){function e(){for(var e=r;w&&w<=" "&&"\n"!==w&&e-- >0;)s()}for(var t="",n=0,r=0;;){var i=a(-r-5);if(!i||"\n"===i)break;r++}for(;w&&w<=" "&&"\n"!==w;)s();for("\n"===w&&(s(),e());;){if(w){if("'"===w){if(n++,s(),3===n)return"\n"===t.slice(-1)&&(t=t.slice(0,-1)),t;continue}for(;n>0;)t+="'",n--}else o("Bad multiline string");"\n"===w?(t+="\n",s(),e()):("\r"!==w&&(t+=w),s())}}function c(){if('"'===w||"'"===w)return l(!1);for(var e="",t=v,n=-1;;){if(":"===w)return e?n>=0&&n!==e.length&&(v=t+n,o("Found whitespace in your key name (use quotes to include)")):o("Found ':' but no key name (for an empty key name use quotes)"),e;w<=" "?w?n<0&&(n=e.length):o("Found EOF while looking for a key name (check your syntax)"):i(w)?o("Found '"+w+"' where a key name was expected (check your syntax or use quotes if the key name includes {}[],: or whitespace)"):e+=w,s()}}function d(){for(;w;){for(;w&&w<=" ";)s();if("#"===w||"/"===w&&"/"===a(0))for(;w&&"\n"!==w;)s();else{if("/"!==w||"*"!==a(0))break;for(s(),s();w&&("*"!==w||"/"!==a(0));)s();w&&(s(),s())}}}function h(){var e=w;for(i(w)&&o("Found a punctuator character '"+w+"' when expecting a quoteless string (check your syntax)");;){s();var t="\r"===w||"\n"===w||""===w;if(t||","===w||"}"===w||"]"===w||"#"===w||"/"===w&&("/"===a(0)||"*"===a(0))){var n=e[0];switch(n){case"f":if("false"===e.trim())return!1;break;case"n":if("null"===e.trim())return null;break;case"t":if("true"===e.trim())return!0;break;default:if("-"===n||n>="0"&&n<="9"){var r=D.tryParseNumber(e);if(void 0!==r)return r}}if(t){e=e.trim();var l=C(e);return void 0!==l?l:e}}e+=w}}function f(e,t){var n;for(e--,n=v-2;n>e&&b[n]<=" "&&"\n"!==b[n];n--);"\n"===b[n]&&n--,"\r"===b[n]&&n--;var r=b.substr(e,n-e+1);for(n=0;n<r.length;n++)if(r[n]>" "){var i=r.indexOf("\n");if(i>=0){var o=[r.substr(0,i),r.substr(i+1)];return t&&0===o[0].trim().length&&o.shift(),o}return[r]}return[]}function p(e){function t(e,n){var r,i,o,s;switch(typeof e){case"string":e.indexOf(n)>=0&&(s=e);break;case"object":if("[object Array]"===Object.prototype.toString.apply(e))for(r=0,o=e.length;r<o;r++)s=t(e[r],n)||s;else for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s=t(e[i],n)||s)}return s}function n(n){var r=t(e,n);return r?"found '"+n+"' in a string value, your mistake could be with:\n  > "+r+"\n  (unquoted strings contain everything up to the next line!)":""}return n("}")||n("]")}function m(){var e,t,n,r=[];try{if(E&&(e=D.createComment(r,{a:[]})),s(),t=v,d(),e&&(n=f(t,!0).join("\n")),"]"===w)return s(),e&&(e.e=[n]),r;for(;w;){if(r.push(y()),t=v,d(),","===w&&(s(),t=v,d()),e){var i=f(t);e.a.push([n||"",i[0]||""]),n=i[1]}if("]"===w)return s(),e&&(e.a[e.a.length-1][1]+=n||""),r;d()}o("End of input while parsing an array (missing ']')")}catch(e){throw e.hint=e.hint||p(r),e}}function g(e){var t,n,r,i="",a={};try{if(E&&(t=D.createComment(a,{c:{},o:[]})),e?n=1:(s(),n=v),d(),t&&(r=f(n,!0).join("\n")),"}"===w&&!e)return t&&(t.e=[r]),s(),a;for(;w;){if(i=c(),d(),":"!==w&&o("Expected ':' instead of '"+w+"'"),s(),a[i]=y(),n=v,d(),","===w&&(s(),n=v,d()),t){var l=f(n);t.c[i]=[r||"",l[0]||""],r=l[1],t.o.push(i)}if("}"===w&&!e)return s(),t&&(t.c[i][1]+=r||""),a;d()}if(e)return a;o("End of input while parsing an object (missing '}')")}catch(e){throw e.hint=e.hint||p(a),e}}function y(){switch(d(),w){case"{":return g();case"[":return m();case"'":case'"':return l(!0);default:return h()}}function _(e,t){var n=v;if(d(),w&&o("Syntax error, found trailing characters"),E){var r=t.join("\n"),i=f(n).join("\n");(i||r)&&(D.createComment(e,D.getComment(e)).r=[r,i])}return e}var b,v,w,E,C,D=e("./hjson-common"),x=e("./hjson-dsf"),F={'"':'"',"'":"'","\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};if("string"!=typeof t)throw new Error("source is not a string");var S=null,k=!0;return n&&"object"==typeof n&&(E=n.keepWsc,S=n.dsf,k=!1!==n.legacyRoot),C=x.loadDsf(S,"parse"),b=t,r(),k?function(){d();var e=E?f(1):null;switch(w){case"{":return _(g(),e);case"[":return _(m(),e)}try{return _(g(!0),e)}catch(t){r();try{return _(y(),e)}catch(e){throw t}}}():function(){d();var e=E?f(1):null;switch(w){case"{":return _(g(),e);case"[":return _(m(),e);default:return _(y(),e)}}()}},{"./hjson-common":2,"./hjson-dsf":3}],5:[function(e,t,n){t.exports=function(t,n){function r(e,t){return j+=e[0].length+e[1].length-e[2]-e[3],e[0]+t+e[1]}function i(e){return e.replace(T,(function(e){var t=B[e];return"string"==typeof t?r(C.esc,t):r(C.uni,("0000"+e.charCodeAt(0).toString(16)).slice(-4))}))}function o(e,t,n,o){return e?(I.lastIndex=0,A.lastIndex=0,y||n||I.test(e)||void 0!==u.tryParseNumber(e,!0)||A.test(e)?(T.lastIndex=0,N.lastIndex=0,T.test(e)?N.test(e)||o||!b?r(C.qstr,i(e)):s(e,t):r(C.qstr,e)):r(C.str,e)):r(C.qstr,"")}function s(e,t){var n,i=e.replace(/\r/g,"").split("\n");if(t+=f,1===i.length)return r(C.mstr,i[0]);var o=h+t+C.mstr[0];for(n=0;n<i.length;n++)o+=h,i[n]&&(o+=t+i[n]);return o+h+t+C.mstr[1]}function a(e){return e?g||O.test(e)?(T.lastIndex=0,r(C.qkey,T.test(e)?i(e):e)):r(C.key,e):'""'}function l(e,t,n,i){function s(e){return e&&"\n"===e["\r"===e[0]?1:0]}function c(e){return e&&!s(e)}function d(e,t,n){if(!e)return"";var i,o=(e=u.forceComment(e)).length;for(i=0;i<o&&e[i]<=" ";i++);return n&&i>0&&(e=e.substr(i)),i<o?t+r(C.rem,e):e}var g=S(e);if(void 0!==g)return r(C.dsf,g);switch(typeof e){case"string":return o(e,L,t,i);case"number":return isFinite(e)?r(C.num,String(e)):r(C.lit,"null");case"boolean":return r(C.lit,String(e));case"object":if(!e)return r(C.lit,"null");var w;p&&(w=u.getComment(e));var D,x,F,k,T,I,N,A,B,O,P="[object Array]"===Object.prototype.toString.apply(e),$=L,M=h+$,U=h+(L+=f),R=n||m?"":M,V=[],H=_?[]:null,q=y,z=b,W=v?"":C.com[0],Z=0;if(P){for(x=0,F=e.length;x<F;x++){if(D=x<F-1,w?(A=c((N=w.a[x]||[])[1]),V.push(d(N[0],"\n")+U),H&&(N[0]||N[1]||A)&&(H=null)):V.push(U),j=0,T=e[x],V.push(l(T,!!w&&A,!0)+(D?v:"")),H){switch(typeof T){case"string":j=0,y=!0,b=0,H.push(l(T,!1,!0)+(D?C.com[0]:"")),y=q,b=z;break;case"object":if(T){H=null;break}default:H.push(V[V.length-1]+(D?W:""))}D&&(j+=C.com[0].length-C.com[2]),Z+=j}w&&N[1]&&V.push(d(N[1],A?" ":"\n",A))}0===F?w&&w.e&&V.push(d(w.e[0],"\n")+M):V.push(M),0===V.length?B=r(C.arr,""):(B=R+r(C.arr,V.join("")),H&&(O=H.join(" ")).length-Z<=_&&(B=r(C.arr,O)))}else{var K=w?w.o.slice():[],J=[];for(k in e)Object.prototype.hasOwnProperty.call(e,k)&&K.indexOf(k)<0&&J.push(k);E&&J.sort();var G=K.concat(J);for(x=0,F=G.length;x<F;x++)if(D=x<F-1,k=G[x],w?(A=c((N=w.c[k]||[])[1]),V.push(d(N[0],"\n")+U),H&&(N[0]||N[1]||A)&&(H=null)):V.push(U),j=0,I=l(T=e[k],w&&A),V.push(a(k)+C.col[0]+(s(I)?"":" ")+I+(D?v:"")),w&&N[1]&&V.push(d(N[1],A?" ":"\n",A)),H){switch(typeof T){case"string":j=0,y=!0,b=0,I=l(T,!1),y=q,b=z,H.push(a(k)+C.col[0]+" "+I+(D?C.com[0]:""));break;case"object":if(T){H=null;break}default:H.push(V[V.length-1]+(D?W:""))}j+=C.col[0].length-C.col[2],D&&(j+=C.com[0].length-C.com[2]),Z+=j}0===F?w&&w.e&&V.push(d(w.e[0],"\n")+M):V.push(M),0===V.length?B=r(C.obj,""):(B=R+r(C.obj,V.join("")),H&&(O=H.join(" ")).length-Z<=_&&(B=r(C.obj,O)))}return L=$,B}}var u=e("./hjson-common"),c=e("./hjson-dsf"),d={obj:["{","}"],arr:["[","]"],key:["",""],qkey:['"','"'],col:[":",""],com:[",",""],str:["",""],qstr:['"','"'],mstr:["'''","'''"],num:["",""],lit:["",""],dsf:["",""],esc:["\\",""],uni:["\\u",""],rem:["",""]},h=u.EOL,f="  ",p=!1,m=!1,g=!1,y=!1,_=0,b=1,v="",w=null,E=!1,C=d;if(n&&"object"==typeof n){n.quotes="always"===n.quotes?"strings":n.quotes,"\n"!==n.eol&&"\r\n"!==n.eol||(h=n.eol),p=n.keepWsc,_=n.condense||0,m=n.bracesSameLine,g="all"===n.quotes||"keys"===n.quotes,y="all"===n.quotes||"strings"===n.quotes||!0===n.separator,b=y||"off"==n.multiline?0:"no-tabs"==n.multiline?2:1,v=!0===n.separator?C.com[0]:"",w=n.dsf,E=n.sortProps,"number"==typeof n.space?f=new Array(n.space+1).join(" "):"string"==typeof n.space&&(f=n.space),!0===n.colors&&(C={obj:["[37m{[0m","[37m}[0m"],arr:["[37m[[0m","[37m][0m"],key:["[33m","[0m"],qkey:['[33m"','"[0m'],col:["[37m:[0m",""],com:["[37m,[0m",""],str:["[37;1m","[0m"],qstr:['[37;1m"','"[0m'],mstr:["[37;1m'''","'''[0m"],num:["[36;1m","[0m"],lit:["[36m","[0m"],dsf:["[37m","[0m"],esc:["[31m\\","[0m"],uni:["[31m\\u","[0m"],rem:["[35m","[0m"]});var D,x=Object.keys(d);for(D=x.length-1;D>=0;D--){var F=x[D];C[F].push(d[F][0].length,d[F][1].length)}}var S,k="-­؀-؄܏឴឵‌-‏\u2028- ⁠-⁯\ufeff￰-￿",T=new RegExp('[\\\\\\"\0-'+k+"]","g"),I=new RegExp("^\\s|^\"|^'|^#|^\\/\\*|^\\/\\/|^\\{|^\\}|^\\[|^\\]|^:|^,|\\s$|[\0-"+k+"]","g"),N=new RegExp("'''|^[\\s]+$|[\0-"+(2===b?"\t":"\b")+"\v\f-"+k+"]","g"),A=new RegExp("^(true|false|null)\\s*((,|\\]|\\}|#|//|/\\*).*)?$"),B={"\b":"b","\t":"t","\n":"n","\f":"f","\r":"r",'"':'"',"\\":"\\"},O=/[,\{\[\}\]\s:#"']|\/\/|\/\*/,L="",j=0;S=c.loadDsf(w,"stringify");var P="",$=p?$=(u.getComment(t)||{}).r:null;return $&&$[0]&&(P=$[0]+"\n"),P+=l(t,null,!0,!0),$&&(P+=$[1]||""),P}},{"./hjson-common":2,"./hjson-dsf":3}],6:[function(e,t,n){t.exports="3.2.1"},{}],7:[function(e,t,n){var r=e("./hjson-common"),i=e("./hjson-version"),o=e("./hjson-parse"),s=e("./hjson-stringify"),a=e("./hjson-comments"),l=e("./hjson-dsf");t.exports={parse:o,stringify:s,endOfLine:function(){return r.EOL},setEndOfLine:function(e){"\n"!==e&&"\r\n"!==e||(r.EOL=e)},version:i,rt:{parse:function(e,t){return(t=t||{}).keepWsc=!0,o(e,t)},stringify:function(e,t){return(t=t||{}).keepWsc=!0,s(e,t)}},comments:a,dsf:l.std}},{"./hjson-comments":1,"./hjson-common":2,"./hjson-dsf":3,"./hjson-parse":4,"./hjson-stringify":5,"./hjson-version":6}],8:[function(e,t,n){},{}]},{},[7])(7)}));class C{static _TRUE=!1;static _initialized=!1;static _startTime=0;static _levels=[];static _caches=new Array;static _maxCacheCount=1024;static _platform=null;static LEVEL={T:"T",D:"D",I:"I",W:"W",E:"E",F:"F",TABLE:"TABLE"};constructor(){}static initialize({debug:e=!1,levels:t,onchange:n}){C._initialized||(C._initialized=!0,C._TRUE=e,C._startTime=Date.now(),t&&(C._levels=t),n&&(C._onchange=n))}static get TRUE(){return C._TRUE}static get count(){return C._caches.length}static get items(){return C._caches}static get startTime(){return C._startTime}static get platform(){return C._platform}static set platform(e){C._platform=e,C.Table(e)}static Assert(e,t){return e||(C.E(t),C.Fail(t)),e}static IsTrue(e,t){return C.Assert(e,t)}static IsNotNull(e){if(null===e)throw new Error("IsNotNull")}static IsNotReached(e){C.IsTrue(!1,e||"Unreachable code hit")}static IsInstanceOf(e,t,n){return e instanceof t||C.IsNotReached(n||"Value "+e+" is not a[n] "+(t.name||typeof t)),e}static IsDefault(e,t){return C.Assert(e===t)}static Fail(e="",t=""){throw 1==arguments.length?new Error("Assert fail: "+e):new Error("Assert fail: "+e+" detailMessage: "+t)}static Close(){throw new Error("close")}static L(){C.Write([...arguments],C.LEVEL.D)}static I(){C.Write([...arguments],C.LEVEL.I)}static W(){C.Write([...arguments],C.LEVEL.W)}static E(){C.Write([...arguments],C.LEVEL.E)}static Print(e){C.onWrite(e)}static Stack(){C.Write([...arguments],C.LEVEL.T)}static Table(e){console.table(e)}static Trace(e){C.Write([e+":","..."]),console.time(e)}static TraceEnd(e){console.timeEnd(e)}static Write(e,t){C.onWrite(e,t)}static WriteIf(e,t,n){e||C.onWrite(t,n)}static onWrite(e,t=C.LEVEL.D){if(C._onchange(e,t),C._levels.indexOf(t)<0)return;let n=C.nowTime(),r=n+" "+t+"/",i=C.LEVEL;switch(t){case i.T:case i.D:console.log(r,...e);break;case i.I:console.info(r,...e);break;case i.W:console.warn(r,...e);break;case i.E:case i.F:console.error(r,...e);break;case i.TABLE:console.table(e)}this.enqueue(n,t,e)}static enqueue(e,t,n){C._caches.length>C._maxCacheCount&&C._caches.splice(0,1)[0];var r=(Array.isArray(n)?Array.from(n):n).toString();C._caches.push({time:e,data:r,level:t})}static nowTime(){return(new Date).toISOString().split("T")[1]}static _onchange(e,t){}}var D={Debug:C};const x=["_id"];class F{constructor(e){if(this.reset(),e)for(const t in e)this[t]&&(this[t]=e[t])}reset(){this._required=[],this._properties={},this._arrayFromProperties=[],this._fields=[],this._checkedFields=[],this._userCheckedFields=[],this._foreigns=[],this._foreignKeys={},this._enumStatic={},this._enumForeignKeys={},this._enumForeignKeyMapping={},this._validateFunctions=[],this._dependencies=[],this._schemas={}}get required(){return this._required}set required(e){this._required=e}get properties(){return this._properties}set properties(e){this._properties=e}get arrayFromProperties(){return this._arrayFromProperties}set arrayFromProperties(e){this._arrayFromProperties=e}get fields(){return this._fields}set fields(e){this._fields=e}get checkedFields(){return this._checkedFields}set checkedFields(e){this._checkedFields=e}get userCheckedFields(){return this._userCheckedFields}set userCheckedFields(e){this._userCheckedFields=e}get enumStatic(){return this._enumStatic}set enumStatic(e){this._enumStatic=e}get foreigns(){return this._foreigns}set foreigns(e){this._foreigns=e}get foreignKeys(){return this._foreignKeys}set foreignKeys(e){this._foreignKeys=e}get enumForeignKeys(){return this._enumForeignKeys}set enumForeignKeys(e){this._enumForeignKeys=e}get enumForeignKeyMapping(){return this._enumForeignKeyMapping}set enumForeignKeyMapping(e){this._enumForeignKeyMapping=e}get validateFunctions(){return this._validateFunctions}set validateFunctions(e){this._validateFunctions=e}get dependencies(){return this._dependencies}set dependencies(e){this._dependencies=e}get schemas(){return this._schemas}set schemas(e){this._schemas=e}}class S{constructor(e){this._schema=e}filter(e){if(!e||!Array.isArray(e)||!e.length)return this._schema;this._fields=e;const{required:t,fields:n,properties:r,arrayFromProperties:i}=schema;let o=[];for(let t=0;t<i.length;t++){let n=i[t];e.indexOf(n.key)>-1&&o.push(n)}return new F({required:t,properties:r,arrayFromProperties:o,fields:n})}isCheckedField(e){if("password"===e.bsonType||e.forceDefaultValue)return!1;if("object"===e.bsonType)return!1;const t=e.permission;return!t||!1!==t.write&&!1!==t[".write"]}}var k={SchemaLoader:class extends class{constructor(){this._data=null}get data(){return this._data}load(e){this._data="object"==typeof e?JSON.parse(JSON.stringify(e)):JSON.parse(e),this._data.schema&&(this._data=this._data.schema),void 0===this._data.required&&(this._data.required=[])}}{static GetForeignkeyFields(e,t){const n=t.slice(0),r=e.enumForeignKeys;for(let e=0;e<n.length;e++){const t=n[e];r[t]&&(n[e]=`${t}{${r[t]} as text}`)}return n}constructor(){super(),this._schema=new F,this._schemaFilter=new S(this._schema)}get schema(){return this._schema}get noPasswordFields(){return this._schema.noPasswordFields}get hasPassword(){return this.fields.length!==this.noPasswordFields.length}load(e){return super.load(e),this._schema.reset(),this._resolve(),this._schema}_resolve(){const{required:e,permission:t,properties:n}=this._data;this._schema.required=e,this._schema.permission=t,this._schema.properties=n;const r=this._schema.fields,i=this._schema.checkedFields,o=this._schema.arrayFromProperties;for(const e in n){const t=n[e];x.indexOf(e)>-1||(this._fixOldVersion(t),o.push({key:e,value:t}),this._processEnum(e,t),this._processTree(e,t),this._processValidateFunction(t))}let s=this._proderOrder(o);for(let e=0;e<s.length;e++){const{key:t,value:n}=s[e];r.push(t),this._schemaFilter.isCheckedField(n)&&i.push(t)}this._schema.arrayFromProperties=s}_processEnum(e,t){if(!t.enum)return;if(this._fixEnumData(t),Array.isArray(t.enum))return void(this._schema.enumStatic[e]=1);if(t.foreignKey){let n=t.foreignKey.split(".")[0];this._schema.foreigns.includes(n)||this._schema.foreigns.push(n),this._schema.foreignKeys[n]=t.foreignKey,this._schema.enumForeignKeyMapping[e]=t}const{collection:n,field:r}=t.enum;if(!n||!r)return null;let i=[],o=r.split(",");for(let e=0;e<o.length;e++){const t=o[e].trim();let n=i.length>0?i[i.length-1]:null;n&&n.indexOf("(")>-1&&n.indexOf(")")<0?i[i.length-1]=n+","+t:i.push(t)}for(let t=0;t<i.length;t++){const n=i[t].split("as");if(!(n.length<2)&&"text"===n[1].trim()){this._schema.enumForeignKeys[e]=n[0].trim();break}}}_processTree(e,t){t.enum&&t.enumType&&"tree"===t.enumType&&t.enum.collection&&this._schema.dependencies.push(t.enum.collection)}_processValidateFunction(e){let t=e.validateFunction;if("object"==typeof t){const{name:e,client:n}=t;if(t=e,!1===n)return}t&&this._schema.validateFunctions.push(t)}_fixEnumData(e){let t=e.enum;if(!Array.isArray(t)||!t.length||"object"==typeof t[0])return;let n=new Array(t.length);for(let e=0;e<t.length;e++){const r=t[e];n[e]={value:r,text:r}}e.enum=n}_fixOldVersion(e){e.component&&!e.componentForEdit&&(e.componentForEdit=e.component)}_proderOrder(e){let t=[];for(let n=e.length-1;n>=0;n--){const r=e[n];void 0!==r.value.order&&(t.push(r),e.splice(n,1))}return t.length?(t.sort(this._sortComparer),t.push(...e),t):e}_sortComparer(e,t){return e.value.order>t.value.order?1:e.value.order<t.value.order?-1:0}}};const T=["title","label","description"],I=["required","minimum","maximum","exclusiveMinimum","exclusiveMaximum","minLength","maxLength","format","pattern"];var N={SchemaLocale:class{constructor(){this._i18n={}}get i18n(){return this._i18n}build(e){this._i18n={};const{arrayFromProperties:t}=e;for(let e=0;e<t.length;e++){const n=t[e];this.processNode(n.key,n.value)}}processNode(e,t){let n=this._i18n,r=T;for(let i=0;i<r.length;i++){const o=r[i],s=t[o];if("object"==typeof s)for(const t in s){const r=s[t];n[t]||(n[t]={}),n[t][e]||(n[t][e]={}),n[t][e][o]=r}}t.enum&&this.processEnum(e,t),t.errorMessage&&this.processErrorMessage(e,t),(t.componentForEdit||t.componentForShow)&&this.processComponent(e,t)}processEnum(e,t){const n=t.enum;if(!n||!n.length)return;if("object"!=typeof n[0].text)return;let r=this._i18n;for(let t=0;t<n.length;t++){const{value:i,text:o}=n[t];for(const t in o)r[t]||(r[t]={}),r[t][e]||(r[t][e]={}),r[t][e].enum||(r[t][e].enum=[]),r[t][e].enum.push({value:i,text:o[t]})}}processErrorMessage(e,t){const{errorMessage:n}=t;if(!n||"object"!=typeof n)return;let r=this._i18n;for(const t in n){const i=n[t];if(I.includes(t)&&"object"==typeof i)for(const n in i)this.undefinedToObject(r,[n,e,"errorMessage"]),r[n][e].errorMessage[t]=i[n];else I.includes(t)||"string"!=typeof i||(this.undefinedToObject(r,[t,e,"errorMessage"]),r[t][e].errorMessage=n[t])}}processComponent(e,t){t.componentForEdit&&"object"==typeof t.componentForEdit.props&&this.processComponentProps(e,t.componentForEdit.props,"componentForEdit"),t.componentForShow&&"object"==typeof t.componentForShow.props&&this.processComponentProps(e,t.componentForShow.props,"componentForShow")}processComponentProps(e,t,n){let r=this._i18n;for(const i in t){let o=t[i];if("object"==typeof o)for(const t in o)this.undefinedToObject(r,[t,e,n,"props",i]),r[t][e][n].props[i]=o[t]}}undefinedToObject(e,t){let n=e;for(let e=0;e<t.length;e++){const r=t[e];n[r]||(n[r]={}),n=n[r]}}}};var A={INDENT:2,END_OF_LINE:"\n",VALIDATOR_DIR:"js_sdk/validator",UNI_COMPONENTS:["template","div","text","view","button","input","image","slider","switch","textarea","editor","picker","rich-text","progress","checkbox-group","checkbox","radio-group","radio"],LOCALE_FORMAT:"%"};var B={ComponentType:{Show:"componentForShow",Edit:"componentForEdit"}};const{ComponentType:O}=B,L=["minLength","maxLength"],j={minLength:":min",maxLength:":max"},P=["maxLength"],$={maxLength:":limit"},M=["input","textarea","switch","slider","picker","checkbox-group","radio-group"],U={input:"@input",textarea:"@input",switch:"@change",slider:"@change",picker:"@change","checkbox-group":"@change","radio-group":"@change"},R={"@input":"binddata('{name}', $event.detail.value)","@change":"binddata('{name}', $event.detail.value)"},V={input:"uni-input-border",textarea:"uni-textarea-border"},H={switch:":checked",slider:":value"};class q{constructor(){this._schema=null}getType(e){if(e.enumType&&"tree"===e.enumType)return"tree";if(e.enum)return"array";if("file"===e.bsonType)return"file";if("array"===e.bsonType&&"file"===e.arrayType)return"file";switch(e.bsonType){case"array":return"array";case"string":case"password":return"string";case"int":case"double":return"number";case"bool":return"bool";case"date":return"date";case"timestamp":return"timestamp";case"fileurls":return"fileurls"}return null}getParentkey(e){let t="",n="";const{properties:r}=this._schema.schemas[e];for(const e in r){const i=r[e];if(i.parentKey){n=i.parentKey,t=e;break}}return{parentKey:t,selfKey:n}}file(e,t){Z.DefaultFile(e,t)}tree(e,t){var n=e.props;L.forEach((t=>{void 0!==e[t]&&(n[j[t]]=e[t])}));const{selfKey:r,parentKey:i}=this.getParentkey(t.enum.collection);r&&(n["self-field"]=r),i&&(n["parent-field"]=i),e.name||(e.name="uni-data-picker")}picker(e,t){Z.DefaultPicker(e,t)}array(e,t){Z.DefaultArray(e,t)}string(e,t){Z.DefaultString(e,t)}number(e,t,n){Z.DefaultNumber(e,t,n)}bool(e,t){Z.DefaultBool(e,t)}timestamp(e,t){Z.DefaultTimestamp(e,t)}fileurls(e,t){Z.DefaultFileurls(e,t)}}class z extends q{constructor(){super()}process(e){this._schema=e;var t=e.arrayFromProperties,n=e.required;for(let e=0;e<t.length;e++){const a=t[e];var r=a.key,i=a.value,o=this.getType(i),s=n.includes(r);void 0===i[O.Edit]&&(i[O.Edit]={}),void 0===i[O.Edit].props&&(i[O.Edit].props={}),this[o]&&this[o](i[O.Edit],i,s),this.defaultProperties(r,i)}}defaultProperties(e,t){const n=t[O.Edit],r=n.name,i=n.props;if(M.includes(r)){var o=U[r];void 0===i[o]&&(i[o]=function(e,t,n){const r=new RegExp("{"+t+"}","g");return e.replace(r,n)}(R[o],"name",e))}if(this.defaultClass(r,i),this.defaultVMode(r,i,e),Z.isClientdbComponent(n,t)){const e=t.enum;for(const t in e)i[t]=e[t]}else Z.isUniDataComponent(n)&&t.enum&&(i[":localdata"]=`formOptions.${e}_localdata`);"password"===t.bsonType&&(n.name="uni-easyinput",i.type="password"),"string"===t.bsonType&&t.trim&&(i.trim=t.trim)}defaultClass(e,t){const n=V[e];n&&(t.class||(t.class=""),t.class.includes(n)||(t.class=(t.class+" "+n).trim()))}defaultVMode(e,t,n){let r=H[e];r?t[r]=`formData.${n}`:t["v-model"]=`formData.${n}`}date(e,t){Z.DefaultDate(e,t)}}class W extends q{constructor(){super()}process(e){this._schema=e;var t=e.arrayFromProperties;for(let e=0;e<t.length;e++){var n=t[e].value;this.getType(n),void 0===n.componentForShow&&(n.componentForShow={}),void 0===n.componentForShow.props&&(n.componentForShow.props={})}}}class Z{static isUniDataComponent(e){return!!e.name&&e.name.includes("uni-data-")}static isClientdbComponent(e,t){return!!e.name&&(e.name.includes("uni-data-")&&t.enum&&!Array.isArray(t.enum))}static DefaultFile(e,t){var n=e.props,r=t.bsonType;t.fileMediaType&&(n["file-mediatype"]=t.fileMediaType),t.fileExtName&&(n["file-extname"]=t.fileExtName),P.forEach((e=>{void 0!==t[e]&&(n[$[e]]=t[e])})),n["return-type"]="array"===r?"array":"object",e.name||(e.name="uni-file-picker")}static DefaultPicker(e,t){e.props[":range"]=`formOptions.${key}_range`,e.name="picker",t.children=`<view>{{formData.${key} === -1 ? '${t.description||""}' : formOptions.${key}_range[formData.${key}]}}</view>`}static DefaultArray(e,t){var n=e.props;L.forEach((e=>{void 0!==t[e]&&(n[j[e]]=t[e])})),"array"===t.bsonType&&(n[":multiple"]=!0),e.name||(t.foreignKey||t.enum&&t.enum.collection?e.name="uni-data-picker":e.name="uni-data-checkbox")}static DefaultString(e,t){var n=e.props;void 0!==t.description&&(n.placeholder=t.description),e.name||(e.name="uni-easyinput")}static DefaultNumber(e,t,n){let r=e.props;const{minimum:i,maximum:o}=t,s=void 0!==i&&void 0!==o&&o-i<=100,a=s?"picker":"uni-easyinput";s||(void 0!==t.description&&(r.placeholder=t.description),r.type="number"),e.name||(e.name=a)}static DefaultBool(e){e.name||(e.name="switch")}static DefaultDate(e){e.props["return-type"]="date",e.name||(e.name="uni-datetime-picker")}static DefaultTimestamp(e){e.props["return-type"]="timestamp",e.name||(e.name="uni-datetime-picker")}static DefaultFileurls(e){e.name||(e.name="uni-file-picker")}}var K={ComponentDefaultProcessor:class{constructor(){this._componentDefaultEdit=new z,this._componentDefaultShow=new W}process(e){this._componentDefaultEdit.process(e),this._componentDefaultShow.process(e)}}};const{INDENT:J,END_OF_LINE:G}=A;class X{constructor(e,t,n=!1){this._isBind=n,this._key=e,this._value=t}get key(){return this._key}set key(e){this._key=e}get value(){return this._value}set value(e){this._value=e}toString(){if(void 0===this.value)return this.key;let e=this.key.replace(/::/g,":"),t=this.value;Array.isArray(t)&&(t=JSON.stringify(t));let n=`${e}="${t}"`;return this._isBind?`:${n}`:n}}var Q={Component:class{constructor(e){this._name=e,this._attributes=new Array,this._children=new Array,this._innerText=""}get name(){return this._name}set name(e){this._name=e}get innerText(){return this._innerText}set innerText(e){this._innerText=e}get children(){return this._children}addChildren(e){this._children.push(e)}addAttribute(e,t,n){let r=new X(e,t,n);this._attributes.push(r)}addAttributes(e,t){for(const n in e)this.addAttribute(n,e[n],t)}getChildrenNames(e=[],t){let n=t||this._children;for(let t=0;t<n.length;t++){const r=n[t];e.push(r.name),r.children.length&&this.getChildrenNames(e,r.children)}}toString(e){let t=this._getIndent(e),n=this._attributesToString(),r=this._childrenToString(e+1),i=n?`${t}<${this.name} ${n}>`:`${t}<${this.name}>`,o=null;return o=r?[i,`${r}`,`${t}${this._innerText}</${this.name}>`]:[`${i}${this._innerText}</${this.name}>`],o.join(G)}_attributesToString(){let e=[],t=this._attributes;for(let n=0;n<t.length;n++){const r=t[n];e.push(r.toString())}return e.join(" ")}_childrenToString(e=0){let t=[],n=this._children;for(let r=0;r<n.length;r++){const i=n[r];t.push(i.toString(e))}return t.length?t.join(G):""}_getIndent(e){return" ".repeat(J*e)}},ComponentAttribute:X};const{INDENT:Y,END_OF_LINE:ee}=A,{Component:te,ComponentAttribute:ne}=Q;class re{static CreateUniGroup(e){return new te("uni-group")}static CreateUniFormsItem(e,t){let n=new te("uni-forms-item");return n.addAttribute("name",e),n.addAttribute("label",t),n}constructor(){this._schema=null,this._children=new Array,this._components=[]}get components(){return this._components}build(e,t){this._schema=e,this._children.length=0,this.buildForm(t)}buildForm({fields:e}){const{required:t,properties:n}=this._schema;let r=new Set,i=this._hasGroup(e,n);i&&r.add("uni-group");let o=this.processGroup(e,n,i);for(let e=0;e<o.length;e++){const n=o[e];if(n.type){let e=n.children,i=re.CreateUniGroup(n.title);for(let n=0;n<e.length;n++){const o=e[n],s=this.buildFormItem(o.name,o.node,t.includes(o.name));r.add(s.name),i.addChildren(s.uniFormsItem)}this._children.push(i)}else{const e=this.buildFormItem(n.name,n.node,t.includes(n.name));r.add(e.name),this._children.push(e.uniFormsItem)}}this._components.length=0,this._components.push(...Array.from(r))}buildFormItem(e,t,n){let r=re.CreateUniFormsItem(e,t.title||t.label||"");n&&r.addAttribute("required");let i=this.newItemChild(e,t,n);return r.addChildren(i),{name:i.name,uniFormsItem:r}}processGroup(e,t,n){var r=[],i={},o=null;for(let a=0;a<e.length;a++){const l=e[a],u=t[l];if(n){var s=u.group;void 0===s?(null==o&&(o={type:"group",title:"",children:[]},r.push(o)),o.children.push({name:l,node:u})):(i[s]||(i[s]={type:"group",title:s,children:[]},r.push(i[s])),i[s].children.push({name:l,node:u}),o=null)}else r.push({name:l,node:u})}return r}_hasGroup(e,t){let n=!1;for(let r=0;r<e.length;r++){if(void 0!==t[e[r]].group){n=!0;break}}return n}newItemChild(e,t){}buildComponent(e){const{name:t,props:n}=e;let r=new te(t);for(const e in n)r.addAttribute(e,n[e]);return r}toString(e){let t=this._children,n=new Array(t.length);for(let t=0;t<this._children.length;t++){const r=this._children[t];n[t]=r.toString(e)}return n.join(ee)}}var ie={FormBuilderEdit:class extends re{constructor(){super()}build(e,t){super.build(e,t)}newItemChild(e,t){let n="picker"===t.componentForEdit.name,r=n&&void 0!==t.maximum&&void 0!==t.minimum;r&&(t.componentForEdit.props["@change"]=`pickerChange($event, '${e}')`,t.componentForEdit.props[":value"]=`formOptions.${e}_index`,delete t.componentForEdit.props["v-model"]);let i=this.buildComponent(t.componentForEdit);if(r){let t=new te("view");t.innerText=`{{formOptions.${e}_data[formOptions.${e}_index] || "请选择..."}}`,i.addChildren(t)}else if(n&&0==i.children){let n=new te("view"),r=t.componentForEdit.props.placeholder||"请选择...";n.innerText=`{{formData.${e} || '${r}'}}`,i.addChildren(n)}return i}},FormBuilderShow:class extends re{constructor(){super()}build(e,t){super.build(e,t)}newItemChild(e,t){return this.buildComponent(t.componentForShow)}}};var oe={StringIndent:function(e,t){let n=e.split("\n"),r="";for(let e=0;e<n.length;e++)r+=" ".repeat(2*t)+n[e],e<n.length-1&&(r+="\n");return r}};const{ComponentType:se}=B,{StringIndent:ae}=oe;class le{constructor(){this._data={}}build(e,t){const{required:n,properties:r}=e,{fields:i}=t;this._data={};for(let e=0;e<i.length;e++){const t=i[e],o=r[t],s=n.includes(t);this._data[t]=this.getDefaultValue(o,s)}}getDefaultValue(e,t){return null}toString(e){return ae(JSON.stringify(this._data,null,2),e).trimStart()}}var ue={FormDataForEdit:class extends le{constructor(){super()}getDefaultValue(e,t){const{bsonType:n,defaultValue:r}=e,i=e[se.Edit],{props:o}=i;return i&&o&&void 0!==o.value?o.value:void 0===r||"object"==typeof r&&Object.keys(r).includes("$env")?"array"===n||"fileArray"===n?[]:"string"===n?"":"int"!==n||!t||void 0===e.minimum&&void 0===e.maximum?null:void 0!==e.minimum?e.minimum:0:r}},FormDataForShow:class extends le{constructor(){super()}getDefaultValue(e,t){return null}},FormStaticForEdit:class extends class{constructor(){this._data={}}build(e,t){const{required:n,properties:r}=e,{fields:i}=t;this._data={};for(let e=0;e<i.length;e++){const t=i[e],n=r[t];if(n.enum&&Array.isArray(n.enum)&&(this._data[`${t}_localdata`]=n.enum.slice(0)),"picker"===n.componentForEdit.name&&void 0!==n.maximum&&void 0!==n.minimum){let e=`${t}_data`,r=`${t}_index`;this._data[e]=`numberRange(${n.minimum}, ${n.maximum})`,this._data[r]=n.defaultValue||null,n.componentForEdit.props[":range"]=`formOptions.${e}`}}}toString(e){let t=ae(JSON.stringify(this._data,null,2),e).trimStart();return this.removeQuotation(t).trimStart()}removeQuotation(e){let t=e.split("\n"),n="";for(let e=0;e<t.length;e++){let r=t[e];r.includes("numberRange")&&(r=r.replace('"numberRange',"numberRange").replace(')"',")")),n+=r,e<t.length-1&&(n+="\n")}return n}}{constructor(){super()}}};const{LOCALE_FORMAT:ce,INDENT:de,END_OF_LINE:he}=A,fe='// 表单校验规则由 schema2code 生成，不建议直接修改校验规则，而建议通过 schema2code 生成, 详情: https://uniapp.dcloud.net.cn/uniCloud/schema\n{import}\n\nconst validator = {validator}\n\nconst enumConverter = {enumConverter}\n\nfunction filterToWhere(filter, command) {\n  let where = {}\n  for (let field in filter) {\n    let { type, value } = filter[field]\n    switch (type) {\n      case "search":\n        if (typeof value === \'string\' && value.length) {\n          where[field] = new RegExp(value)\n        }\n        break;\n      case "select":\n        if (value.length) {\n          let selectValue = []\n          for (let s of value) {\n            selectValue.push(command.eq(s))\n          }\n          where[field] = command.or(selectValue)\n        }\n        break;\n      case "range":\n        if (value.length) {\n          let gt = value[0]\n          let lt = value[1]\n          where[field] = command.and([command.gte(gt), command.lte(lt)])\n        }\n        break;\n      case "date":\n        if (value.length) {\n          let [s, e] = value\n          let startDate = new Date(s)\n          let endDate = new Date(e)\n          where[field] = command.and([command.gte(startDate), command.lte(endDate)])\n        }\n        break;\n      case "timestamp":\n        if (value.length) {\n          let [startDate, endDate] = value\n          where[field] = command.and([command.gte(startDate), command.lte(endDate)])\n        }\n        break;\n    }\n  }\n  return where\n}\n\nexport { validator, enumConverter, filterToWhere }\n',pe=[["bsonType"],["arrayType"],["minimum","maximum","exclusiveMinimum","exclusiveMaximum"],["minLength","maxLength"],["enum"],["format"],["pattern"]],me={enum:"range",bsonType:"format"},ge=["label","title","defaultValue"];var ye={RuleBuilder:class{constructor(){this._imports="",this._content=""}get content(){return this._content}get validators(){return Array.from(this._validator)}get imports(){return this._imports}build(e,{fields:t}){const{required:n,properties:r}=e;this._validator=new Set;var i={};for(let e=0;e<t.length;e++){let a=t[e];var o=r[a],s=this._buildRule(n,a,o,o);Object.keys(s).length>0&&(i[a]=s)}this._imports=this.buildImports(),this._enumDataString=JSON.stringify(this._buildEnumData(t,r),null,2)||"{}";var a=JSON.stringify(i,null,2);a=this._processFunctionString(a,['"validateExpr": "function','validateFunction": "']),a=fe.replace(/\{import\}/,this.imports).replace(/\{validator\}/,a).replace(/\{enumConverter\}/,this._enumDataString),this._content=a}buildImports(){var e=this.validators,t=[];for(let n=0;n<e.length;n++){const r=e[n];t.push(`import ${r} from './validateFunction/${r}.js'`)}return t.join(he)}_buildRule(e,t,n,r){let i=n.errorMessage,o=[];if(e.indexOf(t)>-1){var s={required:!0};i&&(s.errorMessage="string"==typeof i?i:i.required||""),o.push(s)}for(var a=0;a<pe.length;a++){var l={},u=pe[a];for(let e=0;e<u.length;e++){var c=u[e];"arrayType"===me[c]&&"array"!==n.bsonType||void 0!==n[c]&&(l[me[c]||c]=n[c])}if(l.range&&!Array.isArray(l.range)&&delete l.range,Object.keys(l).length>0&&void 0!==i)if("string"==typeof i)l.errorMessage=i;else if("object"==typeof i){var d=u.findIndex((e=>void 0!==i[e]));l.errorMessage=i[u[d]]}Object.keys(l).length>0&&o.push(l)}this._addValidateFunction(o,n);var h={rules:o};return this._processDefaultProperties(h,n),h}_buildEnumData(e,t){const n={};for(let i=0;i<e.length;i++){let o=e[i];var r=t[o];if(!r.enum||!Array.isArray(r.enum)||!r.enum.length)continue;if("object"!=typeof r.enum[0])continue;let s={};if("int"===r.bsonType||"string"===r.bsonType)for(let e=0;e<r.enum.length;e++){const t=r.enum[e];s[t.value]=t.text}else s=r.enum;n[o+"_valuetotext"]=s}return n}_addValidateFunction(e,t){let n=t.validateFunction;if("object"==typeof n){const{name:e,client:t}=n;if(n=e,!1===t)return}n&&(e.push({validateFunction:`${n}`}),this._validator.add(n))}_processFunctionString(e,t){var n=e.split("\n");for(let e=0;e<n.length;e++){const r=n[e];for(let i=0;i<t.length;i++){const o=t[i];if(r.includes(o)){n[e]=r.replace(/\"/g,"");break}}}return n.join("\n")}_processDefaultProperties(e,t){for(let r=0;r<ge.length;r++){var n=ge[r];void 0!==t[n]&&(e[n]=t[n])}void 0===e.label&&void 0!==t.title&&(e.label=t.title)}_processLocale(e){var t=e.split("\n");for(let e=0;e<t.length;e++){const n=t[e];if(n.indexOf(ce)<0)continue;let r=n.substring(0,n.indexOf('"'));const i=n.split(":");let o=i[0].replace(/"/g,"").trimStart(),s=i[1].replace(/"/g,"").split(","),a=s[0].trimStart(),l="";s.length>1&&(l=s[1]);let u=0;for(;a.includes("%");)a=a.replace("%","${t('"),a=a.replace("%","')}"),u++;let c=u>1?`\`${a}\``:a.replace("${","").replace("}","");t[e]=`${r}get ${o}() { return ${c} }${l}`}return t.join("\n")}}};const{Debug:_e}=D,{SchemaLoader:be}=k,{SchemaLocale:ve}=N,{ComponentDefaultProcessor:we}=K,{FormBuilderEdit:Ee,FormBuilderShow:Ce}=ie,{FormDataForEdit:De,FormDataForShow:xe,FormStaticForEdit:Fe}=ue,{RuleBuilder:Se}=ye;var ke={SchemaBuilder:class{constructor(){this._schemaLoader=new be,this._schemaLocale=new ve,this._componentDefaultProcessor=new we,this._formBuilderEdit=new Ee,this._formBuilderShow=new Ce,this._formDataForEdit=new De,this._formDataForShow=new xe,this._formStaticForEdit=new Fe,this._ruleBuilder=new Se}get loader(){return this._schemaLoader}get schema(){return this._schemaLoader.schema}get ruleBuilder(){return this._ruleBuilder}get formBuilderEdit(){return this._formBuilderEdit}get formBuilderShow(){return this._formBuilderShow}get formDataForEdit(){return this._formDataForEdit}get formDataForShow(){return this._formDataForShow}get formStaticForEdit(){return this._formStaticForEdit}get queryCollection(){const e=this._schemaLoader.foreignkeys;let t="";return t=e.length?this._collection+","+e.join(","):this._collection,t}load(e){return _e.Assert(e,"schema invalid"),this._schemaLoader.load(e),this.schema.dependencies.length||this._componentDefaultProcessor.process(this.schema),this._schemaLoader}loadContinue(e){this.schema.schemas=e.schemas,this._componentDefaultProcessor.process(this.schema)}build(e){this.buildForm(e),this._ruleBuilder.build(this.schema,e)}buildForm(e){this._formStaticForEdit.build(this.schema,e),this._formBuilderEdit.build(this.schema,e),this._formBuilderShow.build(this.schema,e),this._formDataForEdit.build(this.schema,e),this._formDataForShow.build(this.schema,e)}getForeignkeyFields(e){return be.GetForeignkeyFields(this.schema,e)}}};class Te{constructor(e,t={}){this._tree=[],this._pages=e,this._rootPath="",this._projectType="vue",this._isAdmin=t.isAdmin||!1}get tree(){return this._tree}get model(){return this._projectType}build(e){e.projectType&&(this._projectType=e.projectType)}createPagesNode(e,t=""){let n=[];return e.forEach((({id:e})=>{let r=e+"."+this._projectType;n.push({id:e,label:r,fullPath:t+r})})),n}createComponentNode(e){let t=[];return e.forEach((e=>{t.push({label:e,children:[]})})),t}createValidatorNode(e,t,n=""){let r=[];t.forEach((e=>{r.push({label:e+".js"})}));var i=[];return r.length&&i.push({id:"validateFunction",label:"validateFunction",children:r}),i.push({id:"validator_file",label:e+".js",fullPath:n+e+".js"}),i}setProjectType(e){this._projectType!==e&&(this._findNodeById(this._tree,"pages_children",(t=>{let n=t.children,r="."+this._projectType,i="."+e;for(let e of n)e.label=e.label.replace(r,i),e.fullPath=e.fullPath.replace(i,i)})),this._projectType=e)}setPageInit(e){this._findNodeById(this._tree,"pages_init",(t=>{t.content=e}))}setPageData(e,t){this._findNodeById(this._tree,e,(e=>{e.content=t}))}setValidatorFile(e){this._findNodeById(this._tree,"validator_file",(t=>{t.content=e}))}setValidatorFunction(e){let t=new Array(e.length);for(let n=0;n<e.length;n++){const{label:r,content:i}=e[n];t[n]={id:r,label:r,content:i,fullPath:this._rootPath+"js_sdk/validator/validateFunction/"+r}}this._findNodeById(this._tree,"validateFunction",(e=>{e.children=t}))}_findNodeById(e,t,n){for(let r=0;r<e.length;r++){let i=e[r];if(i.id===t){n(i);break}i.children&&this._findNodeById(i.children,t,n)}}}var Ie={TreeBuilder:class extends Te{constructor(e){super(e)}build(e){super.build(e);let t=e.validators,n=e.collection,r=e.components;this._tree.length=0,this._tree.push({id:"js_sdk",label:"js_sdk",children:[{id:"validator",label:"validator",children:this.createValidatorNode(n,t,"js_sdk/validator/")}]}),this._tree.push({id:"pages",label:"pages",children:[{id:"pages_children",label:n,children:this.createPagesNode(this._pages,`pages/${n}/`)}]}),this._tree.push({label:"uni_modules",children:this.createComponentNode(r)}),this._tree.push({id:"pages_init",label:"pages_init.json",fullPath:"pages_init.json"})}},UniModulesTreeBuilder:class extends Te{constructor(e,t){super(e,t)}build(e){super.build(e);let t=e.validators,n=e.collection,r=e.components,i=e.pluginId||e.collection;this._tree.length=0;let o=`uni_modules/${i}`;this._rootPath=o+"/";let s=[];this._tree.push({id:"uni_modules",label:"uni_modules",children:[{id:"uni_modules_id",label:i,expanded:1,children:s}]}),s.push({label:"uniCloud",children:[{label:"database",children:[{id:"schema_file",label:n+".schema.json"}]}]}),s.push({id:"js_sdk",label:"js_sdk",children:[{id:"validator",label:"validator",children:this.createValidatorNode(n,t,`${o}/js_sdk/validator/`)}]}),s.push({id:"pages",label:"pages",children:[{id:"pages_children",label:n,children:this.createPagesNode(this._pages,`${o}/pages/${n}/`)}]}),s.push({label:"uni_modules",children:this.createComponentNode(r)}),s.push({label:"changelog.md",command:"changelog_md"},{id:"package",label:"package.json",fullPath:`${o}/package.json`},{id:"pages_init",label:"pages_init.json",fullPath:`${o}/pages_init.json`},{label:"readme.md",command:"readme_md"}),this._isAdmin&&s.push({id:"menu.json",label:"menu.json",command:"admin_menu"})}setSchemaData(e){this._findNodeById(this._tree,"schema_file",(t=>{t.content=e,t.fullPath=this._rootPath+"uniCloud/database/"+t.label}))}setPackageData(e){this._findNodeById(this._tree,"package",(t=>{t.content=e}))}setMenuData(e){this._findNodeById(this._tree,"menu.json",(t=>{t.fullPath=this._rootPath+t.label,t.content=e}))}}};var Ne={PagesBuilder:class{static Build(e,t,n=""){let r=new Array(t.length);for(let i=0;i<t.length;i++){const{id:o,title:s}=t[i],a={path:`${n}pages/${e}/${o}`,style:{navigationBarTitleText:s}};r[i]=a}return{pages:r}}}},Ae=w((function(e,t){!function(){function t(e){return e.replace(y,"").replace(_,",").replace(b,"").replace(v,"").replace(w,"").split(E)}function n(e){return"'"+e.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function r(e,r){function i(e){return p+=e.split(/\n/).length-1,c&&(e=e.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),e&&(e=_[1]+n(e)+_[2]+"\n"),e}function o(e){var n=p;if(u?e=u(e,r):s&&(e=e.replace(/\n/g,(function(){return"$line="+ ++p+";"}))),0===e.indexOf("=")){var i=d&&!/^=[=#]/.test(e);if(e=e.replace(/^=[=#]?|[\s;]*$/g,""),i){var o=e.replace(/\s*\([^\)]+\)/,"");h[o]||/^(include|print)$/.test(o)||(e="$escape("+e+")")}else e="$string("+e+")";e=_[1]+e+_[2]}return s&&(e="$line="+n+";"+e),g(t(e),(function(e){var t;e&&!m[e]&&(t="print"===e?v:"include"===e?w:h[e]?"$utils."+e:f[e]?"$helpers."+e:"$data."+e,E+=e+"="+t+",",m[e]=!0)})),e+"\n"}var s=r.debug,a=r.openTag,l=r.closeTag,u=r.parser,c=r.compress,d=r.escape,p=1,m={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},y="".trim,_=y?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],b=y?"$out+=text;return $out;":"$out.push(text);",v="function(){var text=''.concat.apply('',arguments);"+b+"}",w="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+b+"}",E="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(s?"$line=0,":""),C=_[0],D="return new String("+_[3]+");";g(e.split(a),(function(e){var t=(e=e.split(l))[0],n=e[1];1===e.length?C+=i(t):(C+=o(t),n&&(C+=i(n)))}));var x=E+C+D;s&&(x="try{"+x+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+n(e)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var F=new Function("$data","$filename",x);return F.prototype=h,F}catch(e){throw e.temp="function anonymous($data,$filename) {"+x+"}",e}}var i=function(e,t){return"string"==typeof t?m(t,{filename:e}):a(e,t)};i.version="3.0.0",i.config=function(e,t){o[e]=t};var o=i.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},s=i.cache={};i.render=function(e,t){return m(e,t)};var a=i.renderFile=function(e,t){var n=i.get(e)||p({filename:e,name:"Render Error",message:"Template not found"});return t?n(t):n};i.get=function(e){var t;if(s[e])t=s[e];else if("object"==typeof document){var n=document.getElementById(e);if(n){var r=(n.value||n.innerHTML).replace(/^\s*|\s*$/g,"");t=m(r,{filename:e})}}return t};var l=function(e,t){return"string"!=typeof e&&("number"===(t=typeof e)?e+="":e="function"===t?l(e.call(e)):""),e},u={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},c=function(e){return u[e]},d=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},h=i.utils={$helpers:{},$include:a,$string:l,$escape:function(e){return l(e).replace(/&(?![\w#]+;)|[<>"']/g,c)},$each:function(e,t){var n,r;if(d(e))for(n=0,r=e.length;r>n;n++)t.call(e,e[n],n,e);else for(n in e)t.call(e,e[n],n)}};i.helper=function(e,t){f[e]=t};var f=i.helpers=h.$helpers;i.onerror=function(e){var t="Template Error\n\n";for(var n in e)t+="<"+n+">\n"+e[n]+"\n\n";"object"==typeof console&&console.error(t)};var p=function(e){return i.onerror(e),function(){return"{Template Error}"}},m=i.compile=function(e,t){function n(n){try{return new l(n,a)+""}catch(r){return t.debug?p(r)():(t.debug=!0,m(e,t)(n))}}for(var i in t=t||{},o)void 0===t[i]&&(t[i]=o[i]);var a=t.filename;try{var l=r(e,t)}catch(e){return e.filename=a||"anonymous",e.name="Syntax Error",p(e)}return n.prototype=l.prototype,n.toString=function(){return l.toString()},a&&t.cache&&(s[a]=n),n},g=h.$each,y=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,_=/[^\w$]+/g,b=new RegExp(["\\b"+"break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined".replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),v=/^\d[^,]*|,\d[^,]*/g,w=/^,+|,+$/g,E=/^$|,+/;e.exports=i}()}));var Be={PageAddBuilder:class{constructor(e){this._builder=e,this._content="",this._components=[]}get content(){return this._content}get components(){return this._components}build({collection:e,fields:t}){const n=this._builder.formDataForEdit.toString(3),r=this._builder.formStaticForEdit.toString(4),i=this._builder.formBuilderEdit.toString(3);return this._components.length=0,this._components.push(...this._builder.formBuilderEdit.components),this._content=Ae.compile('<template>\n  <view class="uni-container">\n    <uni-forms ref="form" :model="formData" validate-trigger="submit" err-show-type="toast">\n<%=formTemplate%>\n      <view class="uni-button-group">\n        <button type="primary" class="uni-button" @click="submit">提交</button>\n      </view>\n    </uni-forms>\n  </view>\n</template>\n\n<script>\n  import { validator } from \'../../js_sdk/validator/<%=collection%>.js\';\n\n  const db = uniCloud.database();\n  const dbCollectionName = \'<%=collection%>\';\n\n  function getValidator(fields) {\n    let result = {}\n    for (let key in validator) {\n      if (fields.indexOf(key) > -1) {\n        result[key] = validator[key]\n      }\n    }\n    return result\n  }\n\n  <%if(hasPicker){%>function numberRange(start, end) {\n    return Array.from(new Array(end + 1).keys()).slice(start);\n  }<%}%>\n\n  export default {\n    data() {\n      let formData = <%=formData%>\n      return {\n        formData,\n        formOptions: <%=formOptions%>,\n        rules: {\n          ...getValidator(Object.keys(formData))\n        }\n      }\n    },\n    onReady() {\n      this.$refs.form.setRules(this.rules)\n    },\n    methods: {\n      <%if(hasPicker){%>pickerChange(e, name) {\n        this.formOptions[name + \'_index\'] = e.detail.value;\n        this.formData[name] = this.formOptions[name + \'_data\'][e.detail.value];\n        this.binddata(name, this.formData[name]);\n      },<%}%>\n      /**\n       * 验证表单并提交\n       */\n      submit() {\n        uni.showLoading({\n          mask: true\n        })\n        this.$refs.form.validate().then((res) => {\n          return this.submitForm(res)\n        }).catch(() => {\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      },\n\n      /**\n       * 提交表单\n       */\n      submitForm(value) {\n        // 使用 clientDB 提交数据\n        return db.collection(dbCollectionName).add(value).then((res) => {\n          uni.showToast({\n            icon: \'none\',\n            title: \'新增成功\'\n          })\n          this.getOpenerEventChannel().emit(\'refreshData\')\n          setTimeout(() => uni.navigateBack(), 500)\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        })\n      }\n    }\n  }\n<\/script>\n\n<style>\n  .uni-container {\n    padding: 15px;\n  }\n\n  .uni-input-border,\n  .uni-textarea-border {\n    width: 100%;\n    font-size: 14px;\n    color: #666;\n    border: 1px #e5e5e5 solid;\n    border-radius: 5px;\n    box-sizing: border-box;\n  }\n\n  .uni-input-border {\n    padding: 0 10px;\n    height: 35px;\n\n  }\n\n  .uni-textarea-border {\n    padding: 10px;\n    height: 80px;\n  }\n\n  .uni-button-group {\n    margin-top: 50px;\n    /* #ifndef APP-NVUE */\n    display: flex;\n    /* #endif */\n    justify-content: center;\n  }\n\n  .uni-button {\n    width: 184px;\n  }\n</style>\n',{escape:!1})({collection:e,fields:JSON.stringify(t),formTemplate:i,formData:n,formOptions:r,hasPicker:this._components.includes("picker")}),this._content}}};var Oe={PageEditBuilder:class{constructor(e){this._builder=e,this._content="",this._components=[]}get content(){return this._content}get components(){return this._components}build({collection:e,fields:t}){const n=this._builder.formDataForEdit.toString(3),r=this._builder.formStaticForEdit.toString(4),i=this._builder.formBuilderEdit.toString(3);return this._components.length=0,this._components.push(...this._builder.formBuilderEdit.components),this._content=Ae.compile('<template>\n  <view class="uni-container">\n    <uni-forms ref="form" :model="formData" validate-trigger="submit" err-show-type="toast">\n<%=formTemplate%>\n      <view class="uni-button-group">\n        <button type="primary" class="uni-button" @click="submit">提交</button>\n      </view>\n    </uni-forms>\n  </view>\n</template>\n\n<script>\n  import { validator } from \'../../js_sdk/validator/<%=collection%>.js\';\n\n  const db = uniCloud.database();\n  const dbCollectionName = \'<%=collection%>\';\n\n  function getValidator(fields) {\n    let result = {}\n    for (let key in validator) {\n      if (fields.indexOf(key) > -1) {\n        result[key] = validator[key]\n      }\n    }\n    return result\n  }\n\n  <%if(hasPicker){%>function numberRange(start, end) {\n    return Array.from(new Array(end + 1).keys()).slice(start);\n  }<%}%>\n\n  export default {\n    data() {\n      let formData = <%=formData%>\n      return {\n        formData,\n        formOptions: <%=formOptions%>,\n        rules: {\n          ...getValidator(Object.keys(formData))\n        }\n      }\n    },\n    onLoad(e) {\n      if (e.id) {\n        const id = e.id\n        this.formDataId = id\n        this.getDetail(id)\n      }\n    },\n    onReady() {\n      this.$refs.form.setRules(this.rules)\n    },\n    methods: {\n      <%if(hasPicker){%>pickerChange(e, name) {\n        this.formOptions[name + \'_index\'] = e.detail.value;\n        this.formData[name] = this.formOptions[name + \'_data\'][e.detail.value];\n        this.binddata(name, this.formData[name]);\n      },<%}%>\n      /**\n       * 验证表单并提交\n       */\n      submit() {\n        uni.showLoading({\n          mask: true\n        })\n        this.$refs.form.validate().then((res) => {\n          return this.submitForm(res)\n        }).catch(() => {\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      },\n\n      /**\n       * 提交表单\n       */\n      submitForm(value) {\n        // 使用 clientDB 提交数据\n        return db.collection(dbCollectionName).doc(this.formDataId).update(value).then((res) => {\n          uni.showToast({\n            icon: \'none\',\n            title: \'修改成功\'\n          })\n          this.getOpenerEventChannel().emit(\'refreshData\')\n          setTimeout(() => uni.navigateBack(), 500)\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        })\n      },\n\n      /**\n       * 获取表单数据\n       * @param {Object} id\n       */\n      getDetail(id) {\n        uni.showLoading({\n          mask: true\n        })\n        db.collection(dbCollectionName).doc(id).field("<%=fieldString%>").get().then((res) => {\n          const data = res.result.data[0]\n          if (data) {\n            this.formData = data\n            <%if(hasPicker){%>for (let key in this.formOptions) {\n              let pickerIndex = key.lastIndexOf("_index")\n              if (pickerIndex > -1) {\n                let fieldName = key.substring(0, pickerIndex)\n                let fieldData = this.formOptions[fieldName + "_data"];\n                if (data[fieldName] && fieldData && fieldData.indexOf(data[fieldName]) > -1) {\n                  this.formOptions[fieldName + "_index"] = fieldData.indexOf(data[fieldName])\n                }\n              }\n            }<%}%>\n          }\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      }\n    }\n  }\n<\/script>\n\n<style>\n  .uni-container {\n    padding: 15px;\n  }\n\n  .uni-input-border,\n  .uni-textarea-border {\n    width: 100%;\n    font-size: 14px;\n    color: #666;\n    border: 1px #e5e5e5 solid;\n    border-radius: 5px;\n    box-sizing: border-box;\n  }\n\n  .uni-input-border {\n    padding: 0 10px;\n    height: 35px;\n\n  }\n\n  .uni-textarea-border {\n    padding: 10px;\n    height: 80px;\n  }\n\n  .uni-button-group {\n    margin-top: 50px;\n    /* #ifndef APP-NVUE */\n    display: flex;\n    /* #endif */\n    justify-content: center;\n  }\n\n  .uni-button {\n    width: 184px;\n  }\n</style>\n',{escape:!1})({collection:e,fieldString:t.toString(),formTemplate:i,formData:n,formOptions:r,hasPicker:this._components.includes("picker")}),this._content}}};var Le={PageListBuilder:class{constructor(e){this._builder=e,this._content="",this._components=["uni-load-more","uni-list","uni-fab"]}get content(){return this._content}get components(){return this._components}get foreigns(){return this._builder.schema.foreigns}build({collection:e,fields:t}){const n=this.getQueryCollection(e),r=this._builder.getForeignkeyFields(t).join(",");return this._content=Ae.compile('<template>\n  <view class="container">\n    <unicloud-db ref="udb" v-slot:default="{data, pagination, loading, hasMore, error}" :collection="collectionList"<%if(!hasForeignKey){%> field="<%=queryField%>"<%}%>>\n      <view v-if="error">{{error.message}}</view>\n      <view v-else-if="data">\n        <uni-list>\n          <uni-list-item v-for="(item, index) in data" :key="index" showArrow :clickable="true" @click="handleItemClick(item._id)">\n            <template v-slot:body>\n              <text>\n                \x3c!-- 此处默认显示为_id，请根据需要自行修改为其他字段 --\x3e\n                \x3c!-- 如果使用了联表查询，请参考生成的 admin 项目中 list.vue 页面 --\x3e\n                {{item._id}}\n              </text>\n            </template>\n          </uni-list-item>\n        </uni-list>\n      </view>\n      <uni-load-more :status="loading?\'loading\':(hasMore ? \'more\' : \'noMore\')"></uni-load-more>\n    </unicloud-db>\n    <uni-fab ref="fab" horizontal="right" vertical="bottom" :pop-menu="false" @fabClick="fabClick" />\n  </view>\n</template>\n\n<script>\n  const db = uniCloud.database()\n  export default {\n    data() {\n      return {\n        collectionList: <%=collectionList%>,\n        loadMore: {\n          contentdown: \'\',\n          contentrefresh: \'\',\n          contentnomore: \'\'\n        }\n      }\n    },\n    onPullDownRefresh() {\n      this.$refs.udb.loadData({\n        clear: true\n      }, () => {\n        uni.stopPullDownRefresh()\n      })\n    },\n    onReachBottom() {\n      this.$refs.udb.loadMore()\n    },\n    methods: {\n      handleItemClick(id) {\n        uni.navigateTo({\n          url: \'./detail?id=\' + id\n        })\n      },\n      fabClick() {\n        // 打开新增页面\n        uni.navigateTo({\n          url: \'./add\',\n          events: {\n            // 监听新增数据成功后, 刷新当前页面数据\n            refreshData: () => {\n              this.$refs.udb.loadData({\n                clear: true\n              })\n            }\n          }\n        })\n      }\n    }\n  }\n<\/script>\n\n<style>\n</style>\n',{escape:!1})({collectionList:this.getCollectionList(e,t),queryCollection:n,queryField:r,hasForeignKey:this.foreigns.length>0}),this._content}getQueryCollection(e){let t=e;const n=this.foreigns;return n.length&&(t=t+","+n.join(",")),t}getCollectionList(e,t){if(!this.foreigns.length)return`"${e}"`;let n=[],r=`db.collection('${e}').field('${t.join(",")}').getTemp()`;n.push(r);let i=this._builder.schema.enumForeignKeyMapping;for(const e in i){let t=i[e],r=`db.collection('${t.foreignKey.split(".")[0]}').field('${t.enum.field.replace(" as value","")}').getTemp()`;n.push(r)}return`[ ${n.join(",")} ]`}}};const{INDENT:je,END_OF_LINE:Pe}=A,{Component:$e}=Q;class Me{static CreateView(){return new $e("view")}static CreateText(e){let t=new $e("text");return t.innerText=e,t}static CreateDateformat(e){let t=new $e("uni-dateformat");return t.addAttribute(":threshold","[0, 0]"),t.addAttributes(e),t}constructor(e){this._builder=e,this._content="",this._components=[]}get content(){return this._content}get components(){return this._components}build({fields:e}){const{properties:t,enumStatic:n,enumForeignKeys:r}=this._builder.schema;let i=[],o=new Array;for(let a=0;a<e.length;a++){const l=e[a],u=t[l],{bsonType:c,arrayType:d,format:h,componentForShow:f}=u,p=u.title||u.label||l;let m=Me.CreateView();m.addChildren(Me.CreateText(p)),f&&f.name?this._component(m,l,f):"timestamp"===c?m.addChildren(Me.CreateDateformat({":date":`data.${l}`})):n[l]?this._enumStatic(m,c,l):r[l]?this._enumForeignKey(m,l,r):"bool"===c?m.addChildren(Me.CreateText(`{{data.${l} == true ? '✅' : '❌'}}`)):"file"===c?this._file(m,l):"array"===c&&"file"===d?this._fileArray(m,l):"string"===c&&h?this._stringFormat(m,l,h):m.addChildren(Me.CreateText(`{{data.${l}}}`));var s=[];m.getChildrenNames(s),s.length&&o.push(...s),i.push(m.toString(4))}return this._components.length=0,this._components.push(...Array.from(new Set(o))),this._content=i.join(Pe),this._content}_component(e,t,n){let r=new $e(n.name);for(const e in n.props)r.addAttribute(e,n.props[e]);r.addAttribute(`:value="data.${t}"`),e.addChildren(r)}_stringFormat(e,t,n){let r=new $e("uni-link");"url"===n?(r.addAttribute(`:href="data.${t}"`),r.addAttribute(`:download="data.${t}"`)):"tel"===n?r.addAttribute(`:href="'tel:'+data.${t}"`):"email"===n&&r.addAttribute(`:href="'mailto:'+data.${t}"`),r.addAttribute(`:text="data.${t}"`),e.addChildren(r)}_enumStatic(e,t,n){if("array"===t){let t=new $e("uni-data-picker");t.addAttribute(`:localdata="options.${n}_valuetotext"`),t.addAttribute(`:value="data.${n}"`),t.addAttribute("multiple","false",!0),t.addAttribute("readonly","true",!0),t.addAttribute("arrow","false",!0),t.addAttribute("split",","),e.addChildren(t)}else e.addChildren(Me.CreateText(`{{options.${n}_valuetotext[data.${n}]}}`))}_enumForeignKey(e,t,n){e.addChildren(Me.CreateText(`{{data.${t} && data.${t}[0] && data.${t}[0].text}}`))}_file(e,t){let n=new $e("uni-file-picker");n.addAttribute(`v-if="data.${t} && data.${t}.fileType == 'image'"`),n.addAttribute(`:value="data.${t}"`),n.addAttribute(`:file-mediatype="data.${t} && data.${t}.fileType"`),n.addAttribute("return-type","object"),n.addAttribute("readonly");let r=new $e("uni-link");r.addAttribute(`v-else-if="data.${t}"`),r.addAttribute(`:href="data.${t}.url"`),r.addAttribute(`:text="data.${t}.url"`);let i=new $e("text");i.addAttribute("v-else"),e.addChildren(n),e.addChildren(r),e.addChildren(i)}_fileArray(e,t){let n=new $e("template");n.addAttribute(`v-for="(file, j) in data.${t}"`);let r=new $e("uni-file-picker");r.addAttribute("v-if=\"file.fileType == 'image'\""),r.addAttribute(':value="file"'),r.addAttribute(':file-mediatype="file.fileType"'),r.addAttribute('return-type="object"'),r.addAttribute("readonly"),n.addChildren(r);let i=new $e("uni-link");i.addAttribute("v-else"),i.addAttribute(':href="file.url"'),i.addAttribute(':text="file.url"'),n.addChildren(i),e.addChildren(n)}}var Ue={PageDetailBuilder:class{constructor(e){this._builder=e,this._dbContent=new Me(e),this._content="",this._components=[]}get content(){return this._content}get components(){return this._components}get foreigns(){return this._builder.schema.foreigns}build(e){const{collection:t,fields:n}=e,r=this.getQueryCollection(t),i=this._builder.getForeignkeyFields(n).join(",");this._components.length=0;const o=this._dbContent.build(e);return this._components.push(...this._dbContent.components),this._content=Ae.compile('<template>\n  <view class="container">\n    <unicloud-db ref="udb" v-slot:default="{data, loading, error, options}" :options="options" :collection="collectionList"<%if(!hasForeignKey){%> field="<%=queryField%>" :where="queryWhere"<%}%> :getone="true" :manual="true">\n      <view v-if="error">{{error.message}}</view>\n      <view v-else-if="loading">\n        <uni-load-more :contentText="loadMore" status="loading"></uni-load-more>\n      </view>\n      <view v-else-if="data">\n<%=dbContent%>\n      </view>\n    </unicloud-db>\n    <view class="btns">\n      <button type="primary" @click="handleUpdate">修改</button>\n      <button type="warn" class="btn-delete" @click="handleDelete">删除</button>\n    </view>\n  </view>\n</template>\n\n<script>\n  // 由schema2code生成，包含校验规则和enum静态数据\n  import { enumConverter } from \'../../js_sdk/validator/<%=collection%>.js\'\n  const db = uniCloud.database()\n\n  export default {\n    data() {\n      return {\n        queryWhere: \'\',\n        collectionList: <%=collectionList%>,\n        loadMore: {\n          contentdown: \'\',\n          contentrefresh: \'\',\n          contentnomore: \'\'\n        },\n        options: {\n          // 将scheme enum 属性静态数据中的value转成text\n          ...enumConverter\n        }\n      }\n    },\n    onLoad(e) {\n      this._id = e.id\n    },\n    onReady() {\n      if (this._id) {\n        <%if(hasForeignKey){%><%=foreignKeyWhere%><%}else{%>this.queryWhere = \'_id=="\' + this._id + \'"\'<%}%>\n      }\n    },\n    methods: {\n      handleUpdate() {\n        // 打开修改页面\n        uni.navigateTo({\n          url: \'./edit?id=\' + this._id,\n          events: {\n            // 监听修改页面成功修改数据后, 刷新当前页面数据\n            refreshData: () => {\n              this.$refs.udb.loadData({\n                clear: true\n              })\n            }\n          }\n        })\n      },\n      handleDelete() {\n        this.$refs.udb.remove(this._id, {\n          success: (res) => {\n            // 删除数据成功后跳转到list页面\n            uni.navigateTo({\n              url: \'./list\'\n            })\n          }\n        })\n      }\n    }\n  }\n<\/script>\n\n<style>\n  .container {\n    padding: 10px;\n  }\n\n  .btns {\n    margin-top: 10px;\n    /* #ifndef APP-NVUE */\n    display: flex;\n    /* #endif */\n    flex-direction: row;\n  }\n\n  .btns button {\n    flex: 1;\n  }\n\n  .btn-delete {\n    margin-left: 10px;\n  }\n</style>\n',{escape:!1})({hasForeignKey:this.foreigns.length>0,collectionList:this.getCollectionList(t,n),foreignKeyWhere:this.getForeignKeyWhere(t,n),collection:t,queryCollection:r,queryField:i,dbContent:o}),this._content}getQueryCollection(e){let t=e;const n=this.foreigns;return n.length&&(t=t+","+n.join(",")),t}getForeignKeyWhere(e,t){let n=[],r=`db.collection('${e}').where('_id=="' + this._id + '"').field('${t.join(",")}').getTemp()`;n.push(r);let i=this._builder.schema.enumForeignKeyMapping;for(const e in i){let t=i[e],r=`db.collection('${t.foreignKey.split(".")[0]}').field('${t.enum.field.replace(" as value","")}').getTemp()`;n.push(r)}return`this.collectionList = [ ${n.join(",")} ]`}getCollectionList(e,t){if(!this.foreigns.length)return`"${e}"`;let n=[],r=`db.collection('${e}').field('${t.join(",")}').getTemp()`;n.push(r);let i=this._builder.schema.enumForeignKeyMapping;for(const e in i){let t=i[e],r=`db.collection('${t.foreignKey.split(".")[0]}').field('${t.enum.field.replace(" as value","")}').getTemp()`;n.push(r)}return`[ ${n.join(",")} ]`}}};var Re={id:"",displayName:"",version:"1.0.0",description:"",keywords:[],repository:"",engines:{HBuilderX:"^3.1.0"},dcloudext:{category:[],sale:{regular:{price:"0.00"},sourcecode:{price:"0.00"}},contact:{qq:""},declaration:{ads:"无",data:"无",permissions:"无"},npmurl:""},uni_modules:{dependencies:[],encrypt:[],platforms:{cloud:{tcb:"y",aliyun:"y"},client:{App:{"app-vue":"y","app-nvue":"u"},"H5-mobile":{Safari:"y","Android Browser":"y","微信浏览器(Android)":"y","QQ浏览器(Android)":"y"},"H5-pc":{Chrome:"y",IE:"u",Edge:"y",Firefox:"y",Safari:"y"},"小程序":{"微信":"y","阿里":"y","百度":"y","字节跳动":"y",QQ:"y"},"快应用":{"华为":"u","联盟":"u"}}}}};var Ve={PackageBuilder:class{constructor(e,t){this._builder=e,this._package=JSON.parse(JSON.stringify(Re)),this._package.dcloudext.category=t?["uniCloud","Admin插件"]:["uniCloud","云端一体页面模板"],this._content={}}get content(){return this._content}build({pluginId:e,collection:t,components:n}){let r=this._package;return r.id=e||t,r.displayName=t,r.keywords=[t],r.uni_modules.dependencies=n,this._content=JSON.stringify(r,null,2),this._content}}};const{UNI_COMPONENTS:He}=A,{TreeBuilder:qe,UniModulesTreeBuilder:ze}=Ie,{PagesBuilder:We}=Ne,{PageAddBuilder:Ze}=Be,{PageEditBuilder:Ke}=Oe,{PageListBuilder:Je}=Le,{PageDetailBuilder:Ge}=Ue,{PackageBuilder:Xe}=Ve,Qe=[{id:"add",title:"新增"},{id:"edit",title:"编辑"},{id:"list",title:"列表"},{id:"detail",title:"详情"}],Ye=["uni-forms"];var et={ProjectBuilder:class{constructor(e){this._builder=e,this._treeBuilder=new qe(Qe),this._uniModulesTreeBuilder=new ze(Qe),this._packageBuilder=new Xe(e),this._pageAddBuilder=new Ze(e),this._pageEditBuilder=new Ke(e),this._pageListBuilder=new Je(e),this._pageDetailBuilder=new Ge(e),this._components=[]}get tree(){return this._treeBuilder.tree}get uniModulesTree(){return this._uniModulesTreeBuilder.tree}get components(){return this._components}build(e){this._pageAddBuilder.build(e),this._pageEditBuilder.build(e),this._pageListBuilder.build(e),this._pageDetailBuilder.build(e),this._components=this.getComponents(),this.buildProject(e),this.buildUniModules(e)}buildProject(e){this._treeBuilder.build({...e,validators:this._builder.ruleBuilder.validators,components:this._components}),this._treeBuilder.setValidatorFile(this._builder.ruleBuilder.content),this._treeBuilder.setPageInit(this.buildPagesJson(e.collection)),this._treeBuilder.setPageData("add",this._pageAddBuilder.content),this._treeBuilder.setPageData("edit",this._pageEditBuilder.content),this._treeBuilder.setPageData("list",this._pageListBuilder.content),this._treeBuilder.setPageData("detail",this._pageDetailBuilder.content)}buildUniModules(e){this._uniModulesTreeBuilder.build({...e,validators:this._builder.ruleBuilder.validators,components:this._components}),this._uniModulesTreeBuilder.setValidatorFile(this._builder.ruleBuilder.content),this._uniModulesTreeBuilder.setPageInit(this.buildPagesJson(e.collection,`uni_modules/${e.pluginId||e.collection}/`)),this._uniModulesTreeBuilder.setPageData("add",this._pageAddBuilder.content),this._uniModulesTreeBuilder.setPageData("edit",this._pageEditBuilder.content),this._uniModulesTreeBuilder.setPageData("list",this._pageListBuilder.content),this._uniModulesTreeBuilder.setPageData("detail",this._pageDetailBuilder.content),this._uniModulesTreeBuilder.setPackageData(this._packageBuilder.build({...e,components:this._components}))}buildPagesJson(e,t){let n=We.Build(e,Qe,t);return JSON.stringify(n,null,4)}updateSchemaData(e){this._uniModulesTreeBuilder.setSchemaData(e)}updateValidatorFunction(e){this._treeBuilder.setValidatorFunction(e),this._uniModulesTreeBuilder.setValidatorFunction(e)}getComponents(){let e=[];e.push(...Ye),e.push(...this._pageAddBuilder.components),e.push(...this._pageEditBuilder.components),e.push(...this._pageListBuilder.components),e.push(...this._pageDetailBuilder.components),e=Array.from(new Set(e));for(let t=e.length-1;t>0;t--){const n=e[t];(He.includes(n)||void 0===n)&&e.splice(t,1)}return e}}};var tt={PageAddBuilder:class{constructor(e){this._builder=e,this._content="",this._components=[]}get content(){return this._content}get components(){return this._components}build({collection:e,fields:t}){const n=this._builder.formBuilderEdit.toString(3),r=this._builder.formDataForEdit.toString(3),i=this._builder.formStaticForEdit.toString(4);return this._components.length=0,this._components.push(...this._builder.formBuilderEdit.components),this._content=Ae.compile('<template>\n  <view class="uni-container">\n    <uni-forms ref="form" :model="formData" validateTrigger="bind">\n<%=formTemplate%>\n      <view class="uni-button-group">\n        <button type="primary" class="uni-button" style="width: 100px;" @click="submit">提交</button>\n        <navigator open-type="navigateBack" style="margin-left: 15px;">\n          <button class="uni-button" style="width: 100px;">返回</button>\n        </navigator>\n      </view>\n    </uni-forms>\n  </view>\n</template>\n\n<script>\n  import { validator } from \'../../js_sdk/validator/<%=collection%>.js\';\n\n  const db = uniCloud.database();\n  const dbCmd = db.command;\n  const dbCollectionName = \'<%=collection%>\';\n\n  function getValidator(fields) {\n    let result = {}\n    for (let key in validator) {\n      if (fields.includes(key)) {\n        result[key] = validator[key]\n      }\n    }\n    return result\n  }\n\n  <%if(hasPicker){%>function numberRange(start, end) {\n    return Array.from(new Array(end + 1).keys()).slice(start);\n  }<%}%>\n\n  export default {\n    data() {\n      let formData = <%=formData%>\n      return {\n        formData,\n        formOptions: <%=formOptions%>,\n        rules: {\n          ...getValidator(Object.keys(formData))\n        }\n      }\n    },\n    onReady() {\n      this.$refs.form.setRules(this.rules)\n    },\n    methods: {\n      <%if(hasPicker){%>pickerChange(e, name) {\n        this.formOptions[name + \'_index\'] = e.detail.value;\n        this.formData[name] = this.formOptions[name + \'_data\'][e.detail.value];\n        this.binddata(name, this.formData[name]);\n      },<%}%>\n      /**\n       * 验证表单并提交\n       */\n      submit() {\n        uni.showLoading({\n          mask: true\n        })\n        this.$refs.form.validate().then((res) => {\n          return this.submitForm(res)\n        }).catch(() => {\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      },\n\n      /**\n       * 提交表单\n       */\n      submitForm(value) {\n        // 使用 clientDB 提交数据\n        return db.collection(dbCollectionName).add(value).then((res) => {\n          uni.showToast({\n            title: \'新增成功\'\n          })\n          this.getOpenerEventChannel().emit(\'refreshData\')\n          setTimeout(() => uni.navigateBack(), 500)\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        })\n      }\n    }\n  }\n<\/script>\n',{escape:!1})({collection:e,fields:JSON.stringify(t),formTemplate:n,formData:r,formOptions:i,hasPicker:this._components.includes("picker")}),this._content}}};var nt={PageEditBuilder:class{constructor(e){this._builder=e,this._content="",this._components=[]}get content(){return this._content}get components(){return this._components}build({collection:e,fields:t}){const n=this._builder.formBuilderEdit.toString(3),r=this._builder.formDataForEdit.toString(3),i=this._builder.formStaticForEdit.toString(4);return this._components.length=0,this._components.push(...this._builder.formBuilderEdit.components),this._content=Ae.compile('<template>\n  <view class="uni-container">\n    <uni-forms ref="form" :model="formData" validateTrigger="bind">\n<%=formTemplate%>\n      <view class="uni-button-group">\n        <button type="primary" class="uni-button" style="width: 100px;" @click="submit">提交</button>\n        <navigator open-type="navigateBack" style="margin-left: 15px;">\n          <button class="uni-button" style="width: 100px;">返回</button>\n        </navigator>\n      </view>\n    </uni-forms>\n  </view>\n</template>\n\n<script>\n  import { validator } from \'../../js_sdk/validator/<%=collection%>.js\';\n\n  const db = uniCloud.database();\n  const dbCmd = db.command;\n  const dbCollectionName = \'<%=collection%>\';\n\n  function getValidator(fields) {\n    let result = {}\n    for (let key in validator) {\n      if (fields.includes(key)) {\n        result[key] = validator[key]\n      }\n    }\n    return result\n  }\n\n  <%if(hasPicker){%>function numberRange(start, end) {\n    return Array.from(new Array(end + 1).keys()).slice(start);\n  }<%}%>\n\n  export default {\n    data() {\n      let formData = <%=formData%>\n      return {\n        formData,\n        formOptions: <%=formOptions%>,\n        rules: {\n          ...getValidator(Object.keys(formData))\n        }\n      }\n    },\n    onLoad(e) {\n      if (e.id) {\n        const id = e.id\n        this.formDataId = id\n        this.getDetail(id)\n      }\n    },\n    onReady() {\n      this.$refs.form.setRules(this.rules)\n    },\n    methods: {\n      <%if(hasPicker){%>pickerChange(e, name) {\n        this.formOptions[name + \'_index\'] = e.detail.value;\n        this.formData[name] = this.formOptions[name + \'_data\'][e.detail.value];\n        this.binddata(name, this.formData[name]);\n      },<%}%>\n      /**\n       * 验证表单并提交\n       */\n      submit() {\n        uni.showLoading({\n          mask: true\n        })\n        this.$refs.form.validate().then((res) => {\n          return this.submitForm(res)\n        }).catch(() => {\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      },\n\n      /**\n       * 提交表单\n       */\n      submitForm(value) {\n        // 使用 clientDB 提交数据\n        return db.collection(dbCollectionName).doc(this.formDataId).update(value).then((res) => {\n          uni.showToast({\n            title: \'修改成功\'\n          })\n          this.getOpenerEventChannel().emit(\'refreshData\')\n          setTimeout(() => uni.navigateBack(), 500)\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        })\n      },\n\n      /**\n       * 获取表单数据\n       * @param {Object} id\n       */\n      getDetail(id) {\n        uni.showLoading({\n          mask: true\n        })\n        db.collection(dbCollectionName).doc(id).field("<%=fieldString%>").get().then((res) => {\n          const data = res.result.data[0]\n          if (data) {\n            this.formData = data\n            <%if(hasPicker){%>for (let key in this.formOptions) {\n              let pickerIndex = key.lastIndexOf("_index")\n              if (pickerIndex > -1) {\n                let fieldName = key.substring(0, pickerIndex)\n                let fieldData = this.formOptions[fieldName + "_data"];\n                if (data[fieldName] && fieldData && fieldData.indexOf(data[fieldName]) > -1) {\n                  this.formOptions[fieldName + "_index"] = fieldData.indexOf(data[fieldName])\n                }\n              }\n            }<%}%>\n          }\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || \'请求服务失败\',\n            showCancel: false\n          })\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      }\n    }\n  }\n<\/script>\n',{escape:!1})({collection:e,fieldString:t.toString(),formTemplate:n,formData:r,formOptions:i,hasPicker:this._components.includes("picker")}),this._content}}};const{INDENT:rt,END_OF_LINE:it}=A,{Component:ot}=Q,{StringIndent:st}=oe;class at{constructor(e){this._builder=e,this._content=""}get content(){return this._content}build({fields:e}){const{properties:t,enumStatic:n}=this._builder.schema;let r=this._getHeaders(e,t,n),i=[];for(let e=0;e<r.length;e++){const t=r[e];let n=ut.CreateUniTh();t.props&&n.addAttribute(t.props),n.innerText=t.title,i.push(n.toString(6))}return this._content=i.join(it),this._content}_getHeaders(e,t,n){let r=new Array(e.length);for(let i=0;i<e.length;i++){const o=e[i];let s=t[o],a=new Array;n[o]?(a.push('filter-type="select"'),a.push(`:filter-data="options.filterData.${o}_localdata"`),a.push(`@filter-change="filterChange($event, '${o}')"`)):s.enum||s.foreignKey||("string"===s.bsonType?(a.push('filter-type="search"'),a.push(`@filter-change="filterChange($event, '${o}')"`)):"int"===s.bsonType||"double"===s.bsonType?(a.push('filter-type="range"'),a.push(`@filter-change="filterChange($event, '${o}')"`)):"date"!==s.bsonType&&"timestamp"!==s.bsonType||(a.push(`filter-type="${s.bsonType}"`),a.push(`@filter-change="filterChange($event, '${o}')"`))),s.enum||(a.push("sortable"),a.push(`@sort-change="sortChange($event, '${o}')"`));let l={title:s.label||s.title||o};a.length&&(l.props=a.join(" ")),r[i]=l}return r}}class lt{constructor(e){this._builder=e,this._content="",this._components=[]}get content(){return this._content}get components(){return this._components}build({fields:e}){const{properties:t,enumStatic:n,enumForeignKeys:r}=this._builder.schema;let i=[],o=new Array;for(let a=0;a<e.length;a++){const l=e[a],u=t[l],{bsonType:c,arrayType:d,format:h,componentForShow:f}=u;let p=ut.CreateUniTd();f&&f.name?this._component(p,l,f):"timestamp"===c?p.addChildren(ut.CreateDateformat({":date":`item.${l}`})):n[l]?this._enumStatic(p,c,l):r[l]?this._enumForeignKey(p,l,r):"bool"===c?p.innerText=`{{item.${l} == true ? '✅' : '❌'}}`:"file"===c?this._file(p,l):"array"===c&&"file"===d?this._fileArray(p,l):"string"===c&&h?this._stringFormat(p,l,h):p.innerText=`{{item.${l}}}`;var s=[];p.getChildrenNames(s),s.length&&o.push(...s),i.push(p.toString(6))}return this._components.length=0,this._components.push(...Array.from(new Set(o))),this._content=i.join(it),this._content}_component(e,t,n){let r=new ot(n.name);for(const e in n.props)r.addAttribute(e,n.props[e]);r.addAttribute(`:value="item.${t}"`),e.addChildren(r)}_stringFormat(e,t,n){let r=new ot("uni-link");"url"===n?(r.addAttribute(`:href="item.${t}"`),r.addAttribute(`:download="item.${t}"`)):"tel"===n?r.addAttribute(`:href="'tel:'+item.${t}"`):"email"===n&&r.addAttribute(`:href="'mailto:'+item.${t}"`),r.addAttribute(`:text="item.${t}"`),e.addChildren(r)}_enumStatic(e,t,n){if("array"===t){let t=new ot("uni-data-picker");t.addAttribute(`:localdata="options.${n}_valuetotext"`),t.addAttribute(`:value="item.${n}"`),t.addAttribute("border","false",!0),t.addAttribute("readonly","true",!0),t.addAttribute("split",","),e.addChildren(t)}else e.innerText=`{{options.${n}_valuetotext[item.${n}]}}`}_enumForeignKey(e,t,n){e.innerText=`{{item.${t} && item.${t}[0] && item.${t}[0].text}}`}_file(e,t){let n=new ot("uni-file-picker");n.addAttribute(`v-if="item.${t} && item.${t}.fileType == 'image'"`),n.addAttribute(`:value="item.${t}"`),n.addAttribute(`:file-mediatype="item.${t} && item.${t}.fileType"`),n.addAttribute("return-type","object"),n.addAttribute(":imageStyles","imageStyles"),n.addAttribute("readonly");let r=new ot("uni-link");r.addAttribute("v-else"),r.addAttribute(`:href="item.${t} && item.${t}.url"`),r.addAttribute(`:text="item.${t} && item.${t}.url"`),e.addChildren(n),e.addChildren(r)}_fileArray(e,t){let n=new ot("template");n.addAttribute(`v-for="(file, j) in item.${t}"`);let r=new ot("uni-file-picker");r.addAttribute("v-if=\"file.fileType == 'image'\""),r.addAttribute(':value="file"'),r.addAttribute(':file-mediatype="file.fileType"'),r.addAttribute(":imageStyles","imageStyles"),r.addAttribute("readonly"),n.addChildren(r);let i=new ot("uni-link");i.addAttribute("v-else"),i.addAttribute(':href="file.url"'),i.addAttribute(':text="file.url"'),n.addChildren(i),e.addChildren(n)}}class ut{static CreateUniTh(){let e=new ot("uni-th");return e.addAttribute("align","center"),e}static CreateUniTd(){let e=new ot("uni-td");return e.addAttribute("align","center"),e}static CreateDateformat(e){let t=new ot("uni-dateformat");return t.addAttribute(":threshold","[0, 0]"),t.addAttributes(e),t}}var ct={PageListBuilder:class{constructor(e){this._builder=e,this._tableHeader=new at(e),this._tableContent=new lt(e),this._content="",this._components=[]}get content(){return this._content}get components(){return this._components}get foreigns(){return this._builder.schema.foreigns}build(e){const{collection:t,fields:n}=e,r=this.getQueryCollection(t),i=this._builder.getForeignkeyFields(n).join(","),o=this._builder.formStaticForEdit.toString(5),s=this.buildExportExcel(t,n);this._components.length=0;const a=this._tableHeader.build(e),l=this._tableContent.build(e);return this._components.push(...this._tableContent.components),this._content=Ae.compile('<template>\n  <view>\n    <view class="uni-header">\n      <view class="uni-group">\n        <view class="uni-title"></view>\n        <view class="uni-sub-title"></view>\n      </view>\n      <view class="uni-group">\n        <input class="uni-search" type="text" v-model="query" @confirm="search" placeholder="请输入搜索内容" />\n        <button class="uni-button" type="default" size="mini" @click="search">搜索</button>\n        <button class="uni-button" type="default" size="mini" @click="navigateTo(\'./add\')">新增</button>\n        <button class="uni-button" type="default" size="mini" :disabled="!selectedIndexs.length" @click="delTable">批量删除</button>\n        <download-excel class="hide-on-phone" :fields="exportExcel.fields" :data="exportExcelData" :type="exportExcel.type" :name="exportExcel.filename">\n          <button class="uni-button" type="primary" size="mini">导出 Excel</button>\n        </download-excel>\n      </view>\n    </view>\n    <view class="uni-container">\n      <unicloud-db ref="udb" :collection="collectionList"<%if(!hasForeignKey){%> field="<%=queryField%>"<%}%> :where="where" page-data="replace"\n        :orderby="orderby" :getcount="true" :page-size="options.pageSize" :page-current="options.pageCurrent"\n        v-slot:default="{data,pagination,loading,error,options}" :options="options" loadtime="manual" @load="onqueryload">\n        <uni-table ref="table" :loading="loading" :emptyText="error.message || \'没有更多数据\'" border stripe type="selection" @selection-change="selectionChange">\n          <uni-tr>\n<%=tableHeader%>\n            <uni-th align="center">操作</uni-th>\n          </uni-tr>\n          <uni-tr v-for="(item,index) in data" :key="index">\n<%=tableContent%>\n            <uni-td align="center">\n              <view class="uni-group">\n                <button @click="navigateTo(\'./edit?id=\'+item._id, false)" class="uni-button" size="mini" type="primary">修改</button>\n                <button @click="confirmDelete(item._id)" class="uni-button" size="mini" type="warn">删除</button>\n              </view>\n            </uni-td>\n          </uni-tr>\n        </uni-table>\n        <view class="uni-pagination-box">\n          <uni-pagination show-icon :page-size="pagination.size" v-model="pagination.current" :total="pagination.count" @change="onPageChanged" />\n        </view>\n      </unicloud-db>\n    </view>\n  </view>\n</template>\n\n<script>\n  import { enumConverter, filterToWhere } from \'../../js_sdk/validator/<%=collection%>.js\';\n\n  const db = uniCloud.database()\n  // 表查询配置\n  const dbOrderBy = \'\' // 排序字段\n  const dbSearchFields = [] // 模糊搜索字段，支持模糊搜索的字段列表。联表查询格式: 主表字段名.副表字段名，例如用户表关联角色表 role.role_name\n  // 分页配置\n  const pageSize = 20\n  const pageCurrent = 1\n\n  const orderByMapping = {\n    "ascending": "asc",\n    "descending": "desc"\n  }\n\n  export default {\n    data() {\n      return {\n        collectionList: <%=collectionList%>,\n        query: \'\',\n        where: \'\',\n        orderby: dbOrderBy,\n        orderByFieldName: "",\n        selectedIndexs: [],\n        options: {\n          pageSize,\n          pageCurrent,\n          filterData: <%=filterData%>,\n          ...enumConverter\n        },\n        imageStyles: {\n          width: 64,\n          height: 64\n        },\n        exportExcel: <%=exportExcel%>,\n        exportExcelData: []\n      }\n    },\n    onLoad() {\n      this._filter = {}\n    },\n    onReady() {\n      this.$refs.udb.loadData()\n    },\n    methods: {\n      onqueryload(data) {\n        this.exportExcelData = data\n      },\n      getWhere() {\n        const query = this.query.trim()\n        if (!query) {\n          return \'\'\n        }\n        const queryRe = new RegExp(query, \'i\')\n        return dbSearchFields.map(name => queryRe + \'.test(\' + name + \')\').join(\' || \')\n      },\n      search() {\n        const newWhere = this.getWhere()\n        this.where = newWhere\n        this.$nextTick(() => {\n          this.loadData()\n        })\n      },\n      loadData(clear = true) {\n        this.$refs.udb.loadData({\n          clear\n        })\n      },\n      onPageChanged(e) {\n        this.selectedIndexs.length = 0\n        this.$refs.table.clearSelection()\n        this.$refs.udb.loadData({\n          current: e.current\n        })\n      },\n      navigateTo(url, clear) {\n        // clear 表示刷新列表时是否清除页码，true 表示刷新并回到列表第 1 页，默认为 true\n        uni.navigateTo({\n          url,\n          events: {\n            refreshData: () => {\n              this.loadData(clear)\n            }\n          }\n        })\n      },\n      // 多选处理\n      selectedItems() {\n        var dataList = this.$refs.udb.dataList\n        return this.selectedIndexs.map(i => dataList[i]._id)\n      },\n      // 批量删除\n      delTable() {\n        this.$refs.udb.remove(this.selectedItems(), {\n          success:(res) => {\n            this.$refs.table.clearSelection()\n          }\n        })\n      },\n      // 多选\n      selectionChange(e) {\n        this.selectedIndexs = e.detail.index\n      },\n      confirmDelete(id) {\n        this.$refs.udb.remove(id, {\n          success:(res) => {\n            this.$refs.table.clearSelection()\n          }\n        })\n      },\n      sortChange(e, name) {\n        this.orderByFieldName = name;\n        if (e.order) {\n          this.orderby = name + \' \' + orderByMapping[e.order]\n        } else {\n          this.orderby = \'\'\n        }\n        this.$refs.table.clearSelection()\n        this.$nextTick(() => {\n          this.$refs.udb.loadData()\n        })\n      },\n      filterChange(e, name) {\n        this._filter[name] = {\n          type: e.filterType,\n          value: e.filter\n        }\n        let newWhere = filterToWhere(this._filter, db.command)\n        if (Object.keys(newWhere).length) {\n          this.where = newWhere\n        } else {\n          this.where = \'\'\n        }\n        this.$nextTick(() => {\n          this.$refs.udb.loadData()\n        })\n      }\n    }\n  }\n<\/script>\n\n<style>\n</style>\n',{escape:!1})({collectionList:this.getCollectionList(t,n),collection:t,queryCollection:r,queryField:i,fields:JSON.stringify(n),filterData:o,exportExcel:s,tableHeader:a,tableContent:l,hasForeignKey:this.foreigns.length>0}),this._content}buildExportExcel(e,t){let n={},r={filename:`${e}.xls`,type:"xls",fields:n};const{properties:i}=this._builder.schema;for(let e=0;e<t.length;e++){const r=t[e],o=i[r];n[o.title||o.label||r]=r}return st(JSON.stringify(r,null,2),4).trimStart()}getQueryCollection(e){let t=e;const n=this.foreigns;return n.length&&(t=t+","+n.join(",")),t}getCollectionList(e,t){if(!this.foreigns.length)return`"${e}"`;let n=[],r=`db.collection('${e}').field('${t.join(",")}').getTemp()`;n.push(r);let i=this._builder.schema.enumForeignKeyMapping;for(const e in i){let t=i[e],r=`db.collection('${t.foreignKey.split(".")[0]}').field('${t.enum.field.replace(" as value","")}').getTemp()`;n.push(r)}return`[ ${n.join(",")} ]`}}};const{UNI_COMPONENTS:dt}=A,{TreeBuilder:ht,UniModulesTreeBuilder:ft}=Ie,{PagesBuilder:pt}=Ne,{PageAddBuilder:mt}=tt,{PageEditBuilder:gt}=nt,{PageListBuilder:yt}=ct,{PackageBuilder:_t}=Ve,bt=[{id:"add",title:"新增"},{id:"edit",title:"编辑"},{id:"list",title:"列表"}],vt=["uni-forms","uni-table","uni-pagination"];var wt={AdminProjectBuilder:class{constructor(e){this._builder=e,this._treeBuilder=new ht(bt),this._uniModulesTreeBuilder=new ft(bt,{isAdmin:!0}),this._packageBuilder=new _t(e,!0),this._pageAddBuilder=new mt(e),this._pageEditBuilder=new gt(e),this._pageListBuilder=new yt(e),this._components=[]}get tree(){return this._treeBuilder.tree}get uniModulesTree(){return this._uniModulesTreeBuilder.tree}get components(){return this._components}build(e){this._pageAddBuilder.build(e),this._pageEditBuilder.build(e),this._pageListBuilder.build(e),this._components=this.getComponents(),this.buildProject(e),this.buildUniModules(e)}buildProject(e){this._treeBuilder.build({collection:e.collection,validators:this._builder.ruleBuilder.validators,components:this._components}),this._treeBuilder.setValidatorFile(this._builder.ruleBuilder.content),this._treeBuilder.setPageInit(this.buildPagesJson(e.collection)),this._treeBuilder.setPageData("add",this._pageAddBuilder.content),this._treeBuilder.setPageData("edit",this._pageEditBuilder.content),this._treeBuilder.setPageData("list",this._pageListBuilder.content)}buildUniModules(e){const t=e.pluginId||e.collection;this._uniModulesTreeBuilder.build({...e,validators:this._builder.ruleBuilder.validators,components:this._components}),this._uniModulesTreeBuilder.setValidatorFile(this._builder.ruleBuilder.content),this._uniModulesTreeBuilder.setPageInit(this.buildPagesJson(e.collection,`uni_modules/${t}/`)),this._uniModulesTreeBuilder.setPageData("add",this._pageAddBuilder.content),this._uniModulesTreeBuilder.setPageData("edit",this._pageEditBuilder.content),this._uniModulesTreeBuilder.setPageData("list",this._pageListBuilder.content),this._uniModulesTreeBuilder.setPackageData(this._packageBuilder.build({...e,components:this._components})),this._uniModulesTreeBuilder.setMenuData(this._buildMenu(e))}buildPagesJson(e,t){let n=pt.Build(e,bt,t);return JSON.stringify(n,null,4)}_buildMenu({collection:e,pluginId:t}){let n=[];return n.push({menu_id:t||e,name:e,url:`uni_modules/${t||e}/pages/${e}/list`}),JSON.stringify(n,null,4)}updateSchemaData(e){this._uniModulesTreeBuilder.setSchemaData(e)}updateValidatorFunction(e){this._treeBuilder.setValidatorFunction(e),this._uniModulesTreeBuilder.setValidatorFunction(e)}getComponents(){let e=[];e.push(...vt),e.push(...this._pageAddBuilder.components),e.push(...this._pageEditBuilder.components),e.push(...this._pageListBuilder.components),e=Array.from(new Set(e));for(let t=e.length-1;t>0;t--){const n=e[t];(dt.includes(n)||void 0===n)&&e.splice(t,1)}return e}}};const{SchemaBuilder:Et}=ke,{ProjectBuilder:Ct}=et,{AdminProjectBuilder:Dt}=wt;var xt={SchemaToCode:class{constructor(){this._schemaBuilder=new Et,this._projectBuilder=new Ct(this._schemaBuilder),this._adminProjectBuilder=new Dt(this._schemaBuilder)}get builder(){return this._schemaBuilder}get projectBuilder(){return this._projectBuilder}get adminProjectBuilder(){return this._adminProjectBuilder}get loader(){return this._schemaBuilder.loader}get schema(){return this._schemaBuilder.schema}get fields(){return this._schemaBuilder.schema.fields}get checkedFields(){return this._schemaBuilder.schema.checkedFields}get project(){return this._projectBuilder.tree}get projectForUniModules(){return this._projectBuilder.uniModulesTree}get adminProject(){return this._adminProjectBuilder.tree}get adminProjectForUniModules(){return this._adminProjectBuilder.uniModulesTree}load(e){return this._schemaBuilder.load(e)}loadContinue(e){return this._schemaBuilder.loadContinue(e)}build(e){this.fixOptions(e),this._schemaBuilder.build(e),this._projectBuilder.build(e),this._adminProjectBuilder.build(e)}buildProject(e){this.fixOptions(e),this._schemaBuilder.build(e),this._projectBuilder.build(e)}buildAdminProject(e){this.fixOptions(e),this._schemaBuilder.build(e),this._adminProjectBuilder.build(e)}fixOptions(e){void 0===e.collection&&(e.collection=""),void 0===e.fields&&(e.fields=this.checkedFields)}extractFileTree(e,t){for(let n=0;n<e.length;n++){let{content:r,fullPath:i,children:o}=e[n];r&&t.push({fullPath:i,content:r}),o&&this.extractFileTree(o,t)}}}},Ft={id:"uni-schema-to-code",displayName:"uni-schema-to-code",version:"1.0.0",description:"",keywords:[""],repository:"https://github.com/dcloudio/uni-ui",engines:{HBuilderX:""},directories:{example:"../../temps/example"},dcloudext:{category:["前端组件","通用组件"],sale:{regular:{price:"0.00"},sourcecode:{price:"0.00"}},contact:{qq:""},declaration:{ads:"无",data:"无",permissions:"无"},npmurl:"https://www.npmjs.com/package/@dcloudio/uni-ui"},uni_modules:{dependencies:[],encrypt:[],platforms:{cloud:{tcb:"y",aliyun:"y"},client:{App:{"app-vue":"u","app-nvue":"u"},"H5-mobile":{Safari:"u","Android Browser":"u","微信浏览器(Android)":"u","QQ浏览器(Android)":"u"},"H5-pc":{Chrome:"u",IE:"u",Edge:"u",Firefox:"u",Safari:"u"},"小程序":{"微信":"u","阿里":"u","百度":"u","字节跳动":"u",QQ:"u"},"快应用":{"华为":"u","联盟":"u"}}}}},St=w((function(e,t){!function(e,t){for(var n in t)e[n]=t[n];t.__esModule&&Object.defineProperty(e,"__esModule",{value:!0})}(t,(()=>{var e={285:(e,t,n)=>{var r=n(173),i=r.FileSystem.require(),o=n(622);i.existsSync=i.existsSync||o.existsSync;var s=n(396),a=n(333);/^win/.test(process.platform),e.exports=function(e){var t=void 0,n="";if(e&&"string"==typeof e){if(!i.existsSync(e))throw new Error(r.Errors.INVALID_FILENAME);n=e,t=new a(e,r.Constants.FILE)}else t=e&&Buffer.isBuffer(e)?new a(e,r.Constants.BUFFER):new a(null,r.Constants.NONE);function l(e,t){e=o.resolve(o.normalize(e));for(var n=t.split("/"),r=0,i=n.length;r<i;r++){var s=o.normalize(o.join(e,n.slice(r,i).join(o.sep)));if(0===s.indexOf(e))return s}return o.normalize(o.join(e,o.basename(t)))}function u(e){var n;if(e&&t&&("string"==typeof e&&(n=t.getEntry(e)),"object"==typeof e&&void 0!==e.entryName&&void 0!==e.header&&(n=t.getEntry(e.entryName)),n))return n;return null}function c(e){return"/"!==(e=e.split("\\").join("/")).charAt(e.length-1)&&(e+="/"),e}return{readFile:function(e,t){var n=u(e);return n&&n.getData(t)||null},readFileAsync:function(e,t){var n=u(e);n?n.getDataAsync(t):t(null,"getEntry failed for:"+e)},readAsText:function(e,t){var n=u(e);if(n){var r=n.getData();if(r&&r.length)return r.toString(t||"utf8")}return""},readAsTextAsync:function(e,t,n){var r=u(e);r?r.getDataAsync((function(e,r){r?t(e,r):e&&e.length?t(e.toString(n||"utf8")):t("")})):t("")},deleteFile:function(e){var n=u(e);n&&t.deleteEntry(n.entryName)},addZipComment:function(e){t.comment=e},getZipComment:function(){return t.comment||""},addZipEntryComment:function(e,t){var n=u(e);n&&(n.comment=t)},getZipEntryComment:function(e){var t=u(e);return t&&t.comment||""},updateFile:function(e,t){var n=u(e);n&&n.setData(t)},addLocalFile:function(e,t,n,o){if(!i.existsSync(e))throw new Error(r.Errors.FILE_NOT_FOUND.replace("%s",e));{t=t?c(t):"";var s=e.split("\\").join("/").split("/").pop();t+=n||s;const r=i.statSync(e);this.addFile(t,i.readFileSync(e),o,r)}},addLocalFolder:function(e,t,n){var s;if(n instanceof RegExp?(s=n,n=function(e){return s.test(e)}):"function"!=typeof n&&(n=function(){return!0}),t=t?c(t):"",e=o.normalize(e),!i.existsSync(e))throw new Error(r.Errors.FILE_NOT_FOUND.replace("%s",e));var a=r.findFiles(e),l=this;a.length&&a.forEach((function(r){var s=o.relative(e,r).split("\\").join("/");n(s)&&(r.charAt(r.length-1)!==o.sep?l.addFile(t+s,i.readFileSync(r),"",i.statSync(r)):l.addFile(t+s+"/",Buffer.alloc(0),"",0))}))},addLocalFolderAsync:function(e,t,n,s){void 0===s?s=function(){return!0}:s instanceof RegExp&&(s=function(e){return function(t){return e.test(t)}}(s)),n?"/"!==(n=n.split("\\").join("/")).charAt(n.length-1)&&(n+="/"):n="","/"!==(e=(e=o.normalize(e)).split("\\").join("/")).charAt(e.length-1)&&(e+="/");var a=this;i.open(e,"r",(function(o,l){if(o&&"ENOENT"===o.code)t(void 0,r.Errors.FILE_NOT_FOUND.replace("%s",e));else if(o)t(void 0,o);else{var u=r.findFiles(e),c=-1,d=function(){if((c+=1)<u.length){var r=u[c].split("\\").join("/").replace(new RegExp(e.replace(/(\(|\))/g,"\\$1"),"i"),"");r=r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),s(r)?"/"!==r.charAt(r.length-1)?i.readFile(u[c],(function(e,i){e?t(void 0,e):(a.addFile(n+r,i,"",0),d())})):(a.addFile(n+r,Buffer.alloc(0),"",0),d()):d()}else t(!0,void 0)};d()}}))},addFile:function(e,n,r,o){var a=new s;a.entryName=e,a.comment=r||"";var l="object"==typeof o&&o instanceof i.Stats;l&&(a.header.time=o.mtime);var u=a.isDirectory?16:0;if("win32"!==process.platform){var c=a.isDirectory?16384:32768;u=(u|(c|=l?4095&o.mode:"number"==typeof o?4095&o:a.isDirectory?493:420)<<16)>>>0}a.attr=u,a.setData(n),t.setEntry(a)},getEntries:function(){return t?t.entries:[]},getEntry:function(e){return u(e)},getEntryCount:function(){return t.getEntryCount()},forEach:function(e){return t.forEach(e)},extractEntryTo:function(e,n,s,a,c){a=a||!1,s=void 0===s||s;var d=u(e);if(!d)throw new Error(r.Errors.NO_ENTRY);var h=d.entryName,f=l(n,c&&!d.isDirectory?c:s?h:o.basename(h));if(d.isDirectory)return f=o.resolve(f,".."),t.getEntryChildren(d).forEach((function(e){if(!e.isDirectory){var t=e.getData();if(!t)throw new Error(r.Errors.CANT_EXTRACT_FILE);var i=l(n,s?e.entryName:o.basename(e.entryName));r.writeFileTo(i,t,a)}})),!0;var p=d.getData();if(!p)throw new Error(r.Errors.CANT_EXTRACT_FILE);if(i.existsSync(f)&&!a)throw new Error(r.Errors.CANT_OVERRIDE);return r.writeFileTo(f,p,a),!0},test:function(e){if(!t)return!1;for(var n in t.entries)try{if(n.isDirectory)continue;if(!t.entries[n].getData(e))return!1}catch(e){return!1}return!0},extractAllTo:function(e,n,o){if(n=n||!1,!t)throw new Error(r.Errors.NO_ZIP);t.entries.forEach((function(t){var s=l(e,t.entryName.toString());if(t.isDirectory)r.makeDir(s);else{var a=t.getData(o);if(!a)throw new Error(r.Errors.CANT_EXTRACT_FILE);r.writeFileTo(s,a,n);try{i.utimesSync(s,t.header.time,t.header.time)}catch(e){throw new Error(r.Errors.CANT_EXTRACT_FILE)}}}))},extractAllToAsync:function(e,n,s){if(s||(s=function(){}),n=n||!1,t){var a=t.entries,u=a.length;a.forEach((function(t){if(!(u<=0)){var a=o.normalize(t.entryName.toString());if(t.isDirectory)return r.makeDir(l(e,a)),void(0==--u&&s(void 0));t.getDataAsync((function(c,d){if(!(u<=0)){if(!d)return c?void r.writeFileToAsync(l(e,a),c,n,(function(n){try{i.utimesSync(o.resolve(e,a),t.header.time,t.header.time)}catch(e){s(new Error("Unable to set utimes"))}if(!(u<=0))return n?void(0==--u&&s(void 0)):(u=0,void s(new Error("Unable to write")))})):(u=0,void s(new Error(r.Errors.CANT_EXTRACT_FILE)));s(new Error(d))}}))}}))}else s(new Error(r.Errors.NO_ZIP))},writeZip:function(e,i){if(1===arguments.length&&"function"==typeof e&&(i=e,e=""),!e&&n&&(e=n),e){var o=t.compressToBuffer();if(o){var s=r.writeFileTo(e,o,!0);"function"==typeof i&&i(s?null:new Error("failed"),"")}}},toBuffer:function(e,n,r,i){return this.valueOf=2,"function"==typeof e?(t.toAsyncBuffer(e,n,r,i),null):t.compressToBuffer()}}}},907:(e,t,n)=>{var r=n(173),i=r.Constants;e.exports=function(){var e=20,t=10,n=0,o=0,s=0,a=0,l=0,u=0,c=0,d=0,h=0,f=0,p=0,m=0,g=0;switch(process.platform){case"win32":e|=2560;case"darwin":e|=4864;default:e|=768}var y={};function _(e){e=new Date(e),s=(e.getFullYear()-1980&127)<<25|e.getMonth()+1<<21|e.getDate()<<16|e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()>>1}return _(+new Date),{get made(){return e},set made(t){e=t},get version(){return t},set version(e){t=e},get flags(){return n},set flags(e){n=e},get method(){return o},set method(e){switch(e){case i.STORED:this.version=10;case i.DEFLATED:default:this.version=20}o=e},get time(){return new Date(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1)},set time(e){_(e)},get crc(){return a},set crc(e){a=e},get compressedSize(){return l},set compressedSize(e){l=e},get size(){return u},set size(e){u=e},get fileNameLength(){return c},set fileNameLength(e){c=e},get extraLength(){return d},set extraLength(e){d=e},get commentLength(){return h},set commentLength(e){h=e},get diskNumStart(){return f},set diskNumStart(e){f=e},get inAttr(){return p},set inAttr(e){p=e},get attr(){return m},set attr(e){m=e},get offset(){return g},set offset(e){g=e},get encripted(){return 1==(1&n)},get entryHeaderSize(){return i.CENHDR+c+d+h},get realDataOffset(){return g+i.LOCHDR+y.fnameLen+y.extraLen},get dataHeader(){return y},loadDataHeaderFromBinary:function(e){var t=e.slice(g,g+i.LOCHDR);if(t.readUInt32LE(0)!==i.LOCSIG)throw new Error(r.Errors.INVALID_LOC);y={version:t.readUInt16LE(i.LOCVER),flags:t.readUInt16LE(i.LOCFLG),method:t.readUInt16LE(i.LOCHOW),time:t.readUInt32LE(i.LOCTIM),crc:t.readUInt32LE(i.LOCCRC),compressedSize:t.readUInt32LE(i.LOCSIZ),size:t.readUInt32LE(i.LOCLEN),fnameLen:t.readUInt16LE(i.LOCNAM),extraLen:t.readUInt16LE(i.LOCEXT)}},loadFromBinary:function(y){if(y.length!==i.CENHDR||y.readUInt32LE(0)!==i.CENSIG)throw new Error(r.Errors.INVALID_CEN);e=y.readUInt16LE(i.CENVEM),t=y.readUInt16LE(i.CENVER),n=y.readUInt16LE(i.CENFLG),o=y.readUInt16LE(i.CENHOW),s=y.readUInt32LE(i.CENTIM),a=y.readUInt32LE(i.CENCRC),l=y.readUInt32LE(i.CENSIZ),u=y.readUInt32LE(i.CENLEN),c=y.readUInt16LE(i.CENNAM),d=y.readUInt16LE(i.CENEXT),h=y.readUInt16LE(i.CENCOM),f=y.readUInt16LE(i.CENDSK),p=y.readUInt16LE(i.CENATT),m=y.readUInt32LE(i.CENATX),g=y.readUInt32LE(i.CENOFF)},dataHeaderToBinary:function(){var e=Buffer.alloc(i.LOCHDR);return e.writeUInt32LE(i.LOCSIG,0),e.writeUInt16LE(t,i.LOCVER),e.writeUInt16LE(n,i.LOCFLG),e.writeUInt16LE(o,i.LOCHOW),e.writeUInt32LE(s,i.LOCTIM),e.writeUInt32LE(a,i.LOCCRC),e.writeUInt32LE(l,i.LOCSIZ),e.writeUInt32LE(u,i.LOCLEN),e.writeUInt16LE(c,i.LOCNAM),e.writeUInt16LE(d,i.LOCEXT),e},entryHeaderToBinary:function(){var r=Buffer.alloc(i.CENHDR+c+d+h);return r.writeUInt32LE(i.CENSIG,0),r.writeUInt16LE(e,i.CENVEM),r.writeUInt16LE(t,i.CENVER),r.writeUInt16LE(n,i.CENFLG),r.writeUInt16LE(o,i.CENHOW),r.writeUInt32LE(s,i.CENTIM),r.writeUInt32LE(a,i.CENCRC),r.writeUInt32LE(l,i.CENSIZ),r.writeUInt32LE(u,i.CENLEN),r.writeUInt16LE(c,i.CENNAM),r.writeUInt16LE(d,i.CENEXT),r.writeUInt16LE(h,i.CENCOM),r.writeUInt16LE(f,i.CENDSK),r.writeUInt16LE(p,i.CENATT),r.writeUInt32LE(m,i.CENATX),r.writeUInt32LE(g,i.CENOFF),r.fill(0,i.CENHDR),r},toString:function(){return'{\n\t"made" : '+e+',\n\t"version" : '+t+',\n\t"flags" : '+n+',\n\t"method" : '+r.methodToString(o)+',\n\t"time" : '+this.time+',\n\t"crc" : 0x'+a.toString(16).toUpperCase()+',\n\t"compressedSize" : '+l+' bytes,\n\t"size" : '+u+' bytes,\n\t"fileNameLength" : '+c+',\n\t"extraLength" : '+d+' bytes,\n\t"commentLength" : '+h+' bytes,\n\t"diskNumStart" : '+f+',\n\t"inAttr" : '+p+',\n\t"attr" : '+m+',\n\t"offset" : '+g+',\n\t"entryHeaderSize" : '+(i.CENHDR+c+d+h)+" bytes\n}"}}}},854:(e,t,n)=>{t.EntryHeader=n(907),t.MainHeader=n(519)},519:(e,t,n)=>{var r=n(173),i=r.Constants;e.exports=function(){var e=0,t=0,n=0,o=0,s=0;return{get diskEntries(){return e},set diskEntries(n){e=t=n},get totalEntries(){return t},set totalEntries(n){t=e=n},get size(){return n},set size(e){n=e},get offset(){return o},set offset(e){o=e},get commentLength(){return s},set commentLength(e){s=e},get mainHeaderSize(){return i.ENDHDR+s},loadFromBinary:function(a){if((a.length!==i.ENDHDR||a.readUInt32LE(0)!==i.ENDSIG)&&(a.length<i.ZIP64HDR||a.readUInt32LE(0)!==i.ZIP64SIG))throw new Error(r.Errors.INVALID_END);a.readUInt32LE(0)===i.ENDSIG?(e=a.readUInt16LE(i.ENDSUB),t=a.readUInt16LE(i.ENDTOT),n=a.readUInt32LE(i.ENDSIZ),o=a.readUInt32LE(i.ENDOFF),s=a.readUInt16LE(i.ENDCOM)):(e=r.readBigUInt64LE(a,i.ZIP64SUB),t=r.readBigUInt64LE(a,i.ZIP64TOT),n=r.readBigUInt64LE(a,i.ZIP64SIZ),o=r.readBigUInt64LE(a,i.ZIP64OFF),s=0)},toBinary:function(){var r=Buffer.alloc(i.ENDHDR+s);return r.writeUInt32LE(i.ENDSIG,0),r.writeUInt32LE(0,4),r.writeUInt16LE(e,i.ENDSUB),r.writeUInt16LE(t,i.ENDTOT),r.writeUInt32LE(n,i.ENDSIZ),r.writeUInt32LE(o,i.ENDOFF),r.writeUInt16LE(s,i.ENDCOM),r.fill(" ",i.ENDHDR),r},toString:function(){return'{\n\t"diskEntries" : '+e+',\n\t"totalEntries" : '+t+',\n\t"size" : '+n+' bytes,\n\t"offset" : 0x'+o.toString(16).toUpperCase()+',\n\t"commentLength" : 0x'+s+"\n}"}}}},753:(e,t,n)=>{e.exports=function(e){var t=n(761),r={chunkSize:1024*(parseInt(e.length/1024)+1)};return{deflate:function(){return t.deflateRawSync(e,r)},deflateAsync:function(n){var i=t.createDeflateRaw(r),o=[],s=0;i.on("data",(function(e){o.push(e),s+=e.length})),i.on("end",(function(){var e=Buffer.alloc(s),t=0;e.fill(0);for(var r=0;r<o.length;r++){var i=o[r];i.copy(e,t),t+=i.length}n&&n(e)})),i.end(e)}}}},4:(e,t,n)=>{t.Deflater=n(753),t.Inflater=n(269),t.ZipCrypto=n(729)},269:(e,t,n)=>{e.exports=function(e){var t=n(761);return{inflate:function(){return t.inflateRawSync(e)},inflateAsync:function(n){var r=t.createInflateRaw(),i=[],o=0;r.on("data",(function(e){i.push(e),o+=e.length})),r.on("end",(function(){var e=Buffer.alloc(o),t=0;e.fill(0);for(var r=0;r<i.length;r++){var s=i[r];s.copy(e,t),t+=s.length}n&&n(e)})),r.end(e)}}}},729:e=>{const t=new Uint32Array(256).map(((e,t)=>{for(let e=0;e<8;e++)0!=(1&t)?t=t>>>1^3988292384:t>>>=1;return t>>>0}));e.exports={decrypt:function(e,n,r){if(!e||!Buffer.isBuffer(e)||e.length<12)return Buffer.alloc(0);const i=function(e){const n=(e,t)=>Math.imul(e,t)>>>0,r=new Uint32Array([305419896,591751049,878082192]),i=(e,n)=>t[255&(e^n)]^e>>>8,o=e=>{r[0]=i(r[0],e),r[1]+=255&r[0],r[1]=n(r[1],134775813)+1,r[2]=i(r[2],r[1]>>>24)},s=Buffer.isBuffer(e)?e:Buffer.from(e);for(let e=0;e<s.length;e++)o(s[e]);return function(e){if(!Buffer.isBuffer(e))throw"decrypter needs Buffer";const t=Buffer.alloc(e.length);let i=0;for(let s of e){const e=(2|r[2])>>>0;s^=n(e,1^e)>>8&255,t[i++]=s,o(s)}return t}}(r);if(n.crc>>>24!==i(e.slice(0,12))[11])throw"ADM-ZIP: Wrong Password";return i(e.slice(12))}}},991:e=>{e.exports={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,FLG_ENC:0,FLG_COMP1:1,FLG_COMP2:2,FLG_DESC:4,FLG_ENH:8,FLG_STR:16,FLG_LNG:1024,FLG_MSK:4096,FILE:0,BUFFER:1,NONE:2,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24}},190:e=>{e.exports={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed",FILE_IN_THE_WAY:"There is a file in the way: %s",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:"File not found: %s",NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found"}},455:(e,t,n)=>{var r=n(147).require(),i=n(622);r.existsSync=r.existsSync||i.existsSync,e.exports=function(e){var t=e||"",n={directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0},o=null;return t&&r.existsSync(t)?(o=r.statSync(t),n.directory=o.isDirectory(),n.mtime=o.mtime,n.atime=o.atime,n.executable=0!=(73&o.mode),n.readonly=0==(128&o.mode),n.hidden="."===i.basename(t)[0]):console.warn("Invalid path: "+t),{get directory(){return n.directory},get readOnly(){return n.readonly},get hidden(){return n.hidden},get mtime(){return n.mtime},get atime(){return n.atime},get executable(){return n.executable},decodeAttributes:function(e){},encodeAttributes:function(e){},toString:function(){return'{\n\t"path" : "'+t+',\n\t"isDirectory" : '+n.directory+',\n\t"isReadOnly" : '+n.readonly+',\n\t"isHidden" : '+n.hidden+',\n\t"isExecutable" : '+n.executable+',\n\t"mTime" : '+n.mtime+'\n\t"aTime" : '+n.atime+"\n}"}}}},147:(e,t,n)=>{t.require=function(){var e=n(747);if(process&&process.versions&&process.versions.electron)try{originalFs=n(503),Object.keys(originalFs).length>0&&(e=originalFs)}catch(e){}return e}},173:(e,t,n)=>{e.exports=n(646),e.exports.FileSystem=n(147),e.exports.Constants=n(991),e.exports.Errors=n(190),e.exports.FileAttr=n(455)},646:(e,t,n)=>{var r=n(147).require(),i=n(622);r.existsSync=r.existsSync||i.existsSync,e.exports=function(){var e=[],t=n(991),o=n(190),s=i.sep;function a(e){var t=e.split(s)[0];e.split(s).forEach((function(e){if(e&&":"!==e.substr(-1,1)){var n;t+=s+e;try{n=r.statSync(t)}catch(e){r.mkdirSync(t)}if(n&&n.isFile())throw o.FILE_IN_THE_WAY.replace("%s",t)}}))}function l(e,t,n){"boolean"==typeof t&&(n=t,t=void 0);var o=[];return r.readdirSync(e).forEach((function(a){var u=i.join(e,a);r.statSync(u).isDirectory()&&n&&(o=o.concat(l(u,t,n))),t&&!t.test(u)||o.push(i.normalize(u)+(r.statSync(u).isDirectory()?s:""))})),o}return{makeDir:function(e){a(e)},crc32:function(t){"string"==typeof t&&(t=Buffer.alloc(t.length,t));var n=Buffer.alloc(4);if(!e.length)for(var r=0;r<256;r++){for(var i=r,o=8;--o>=0;)0!=(1&i)?i=3988292384^i>>>1:i>>>=1;i<0&&(n.writeInt32LE(i,0),i=n.readUInt32LE(0)),e[r]=i}for(var s=0,a=0,l=t.length,u=~s;--l>=0;)u=e[255&(u^t[a++])]^u>>>8;return s=~u,n.writeInt32LE(4294967295&s,0),n.readUInt32LE(0)},methodToString:function(e){switch(e){case t.STORED:return"STORED ("+e+")";case t.DEFLATED:return"DEFLATED ("+e+")";default:return"UNSUPPORTED ("+e+")"}},writeFileTo:function(e,t,n,o){if(r.existsSync(e)){if(!n)return!1;if(r.statSync(e).isDirectory())return!1}var s,l=i.dirname(e);r.existsSync(l)||a(l);try{s=r.openSync(e,"w",438)}catch(t){r.chmodSync(e,438),s=r.openSync(e,"w",438)}if(s)try{r.writeSync(s,t,0,t.length,0)}catch(e){throw e}finally{r.closeSync(s)}return r.chmodSync(e,o||438),!0},writeFileToAsync:function(e,t,n,o,s){"function"==typeof o&&(s=o,o=void 0),r.exists(e,(function(l){if(l&&!n)return s(!1);r.stat(e,(function(n,u){if(l&&u.isDirectory())return s(!1);var c=i.dirname(e);r.exists(c,(function(n){n||a(c),r.open(e,"w",438,(function(n,i){n?r.chmod(e,438,(function(){r.open(e,"w",438,(function(n,i){r.write(i,t,0,t.length,0,(function(){r.close(i,(function(){r.chmod(e,o||438,(function(){s(!0)}))}))}))}))})):i?r.write(i,t,0,t.length,0,(function(){r.close(i,(function(){r.chmod(e,o||438,(function(){s(!0)}))}))})):r.chmod(e,o||438,(function(){s(!0)}))}))}))}))}))},findFiles:function(e){return l(e,!0)},getAttributes:function(e){},setAttributes:function(e){},toBuffer:function(e){return Buffer.isBuffer(e)?e:0===e.length?Buffer.alloc(0):Buffer.from(e,"utf8")},readBigUInt64LE:function(e,t){var n=Buffer.from(e.slice(t,t+8));return n.swap64(),parseInt(`0x${n.toString("hex")}`)},Constants:t,Errors:o}}()},396:(e,t,n)=>{var r=n(173),i=n(854),o=r.Constants,s=n(4);e.exports=function(e){var t=new i.EntryHeader,n=Buffer.alloc(0),a=Buffer.alloc(0),l=!1,u=null,c=Buffer.alloc(0);function d(){return e&&Buffer.isBuffer(e)?(t.loadDataHeaderFromBinary(e),e.slice(t.realDataOffset,t.realDataOffset+t.compressedSize)):Buffer.alloc(0)}function h(e){return 8==(8&t.flags)||r.crc32(e)===t.dataHeader.crc}function f(e,i,o){if(void 0===i&&"string"==typeof e&&(o=e,e=void 0),l)return e&&i&&i(Buffer.alloc(0),r.Errors.DIRECTORY_CONTENT_ERROR),Buffer.alloc(0);var a=d();if(0===a.length)return e&&i&&i(a),a;if(t.encripted){if("string"!=typeof o&&!Buffer.isBuffer(o))throw new Error("ADM-ZIP: Incompatible password parameter");a=s.ZipCrypto.decrypt(a,t,o)}var u=Buffer.alloc(t.size);switch(t.method){case r.Constants.STORED:if(a.copy(u),h(u))return e&&i&&i(u),u;throw e&&i&&i(u,r.Errors.BAD_CRC),new Error(r.Errors.BAD_CRC);case r.Constants.DEFLATED:var c=new s.Inflater(a);if(!e){if(c.inflate(u).copy(u,0),!h(u))throw new Error(r.Errors.BAD_CRC+" "+n.toString());return u}c.inflateAsync((function(e){e.copy(u,0),h(u)?i&&i(u):i&&i(u,r.Errors.BAD_CRC)}));break;default:throw e&&i&&i(Buffer.alloc(0),r.Errors.UNKNOWN_METHOD),new Error(r.Errors.UNKNOWN_METHOD)}}function p(n,i){if((!u||!u.length)&&Buffer.isBuffer(e))return n&&i&&i(d()),d();if(u.length&&!l){var o;switch(t.method){case r.Constants.STORED:return t.compressedSize=t.size,o=Buffer.alloc(u.length),u.copy(o),n&&i&&i(o),o;default:case r.Constants.DEFLATED:var a=new s.Deflater(u);if(!n){var c=a.deflate();return t.compressedSize=c.length,c}a.deflateAsync((function(e){o=Buffer.alloc(e.length),t.compressedSize=e.length,e.copy(o),i&&i(o)})),a=null}}else{if(!n||!i)return Buffer.alloc(0);i(Buffer.alloc(0))}}function m(e,t){return(e.readUInt32LE(t+4)<<4)+e.readUInt32LE(t)}function g(e){var n,r,i,s;e.length>=o.EF_ZIP64_SCOMP&&(n=m(e,o.EF_ZIP64_SUNCOMP),t.size===o.EF_ZIP64_OR_32&&(t.size=n)),e.length>=o.EF_ZIP64_RHO&&(r=m(e,o.EF_ZIP64_SCOMP),t.compressedSize===o.EF_ZIP64_OR_32&&(t.compressedSize=r)),e.length>=o.EF_ZIP64_DSN&&(i=m(e,o.EF_ZIP64_RHO),t.offset===o.EF_ZIP64_OR_32&&(t.offset=i)),e.length>=o.EF_ZIP64_DSN+4&&(s=e.readUInt32LE(o.EF_ZIP64_DSN),t.diskNumStart===o.EF_ZIP64_OR_16&&(t.diskNumStart=s))}return{get entryName(){return n.toString()},get rawEntryName(){return n},set entryName(e){var i=(n=r.toBuffer(e))[n.length-1];l=47===i||92===i,t.fileNameLength=n.length},get extra(){return c},set extra(e){c=e,t.extraLength=e.length,function(e){for(var t,n,r,i=0;i<e.length;)t=e.readUInt16LE(i),i+=2,n=e.readUInt16LE(i),i+=2,r=e.slice(i,i+n),i+=n,o.ID_ZIP64===t&&g(r)}(e)},get comment(){return a.toString()},set comment(e){a=r.toBuffer(e),t.commentLength=a.length},get name(){var e=n.toString();return l?e.substr(e.length-1).split("/").pop():e.split("/").pop()},get isDirectory(){return l},getCompressedData:function(){return p(!1,null)},getCompressedDataAsync:function(e){p(!0,e)},setData:function(e){u=r.toBuffer(e),!l&&u.length?(t.size=u.length,t.method=r.Constants.DEFLATED,t.crc=r.crc32(e),t.changed=!0):t.method=r.Constants.STORED},getData:function(e){return t.changed?u:f(!1,null,e)},getDataAsync:function(e,n){t.changed?e(u):f(!0,e,n)},set attr(e){t.attr=e},get attr(){return t.attr},set header(e){t.loadFromBinary(e)},get header(){return t},packHeader:function(){var e=t.entryHeaderToBinary();return n.copy(e,r.Constants.CENHDR),t.extraLength&&c.copy(e,r.Constants.CENHDR+n.length),t.commentLength&&a.copy(e,r.Constants.CENHDR+n.length+t.extraLength,a.length),e},toString:function(){return'{\n\t"entryName" : "'+n.toString()+'",\n\t"name" : "'+(l?n.toString().replace(/\/$/,"").split("/").pop():n.toString().split("/").pop())+'",\n\t"comment" : "'+a.toString()+'",\n\t"isDirectory" : '+l+',\n\t"header" : '+t.toString().replace(/\t/gm,"\t\t").replace(/}/gm,"\t}")+',\n\t"compressedData" : <'+(e&&e.length+" bytes buffer"||"null")+'>\n\t"data" : <'+(u&&u.length+" bytes buffer"||"null")+">\n}"}}}},333:(e,t,n)=>{var r=n(396),i=n(854),o=n(173);e.exports=function(e,t){var n=[],s={},a=Buffer.alloc(0),l="",u=o.FileSystem.require(),c=null,d=new i.MainHeader,h=!1;function f(){h=!0,s={},n=new Array(d.diskEntries);for(var e=d.offset,t=0;t<n.length;t++){var i=e,a=new r(c);a.header=c.slice(i,i+=o.Constants.CENHDR),a.entryName=c.slice(i,i+=a.header.fileNameLength),a.header.extraLength&&(a.extra=c.slice(i,i+=a.header.extraLength)),a.header.commentLength&&(a.comment=c.slice(i,i+a.header.commentLength)),e+=a.header.entryHeaderSize,n[t]=a,s[a.entryName]=a}}function p(){for(var e=c.length-o.Constants.ENDHDR,t=Math.max(0,e-65535),n=t,r=c.length,i=-1,s=0;e>=n;e--)if(80===c[e])if(c.readUInt32LE(e)!==o.Constants.ENDSIG)if(c.readUInt32LE(e)!==o.Constants.END64SIG){if(c.readUInt32LE(e)==o.Constants.ZIP64SIG){i=e,r=e+o.readBigUInt64LE(c,e+o.Constants.ZIP64SIZE)+o.Constants.ZIP64LEAD;break}}else n=t;else i=e,s=e,r=e+o.Constants.ENDHDR,n=e-o.Constants.END64HDR;if(!~i)throw new Error(o.Errors.INVALID_FORMAT);d.loadFromBinary(c.slice(i,r)),d.commentLength&&(a=c.slice(s+o.Constants.ENDHDR))}return t===o.Constants.FILE?(l=e,c=u.readFileSync(l),p()):t===o.Constants.BUFFER?(c=e,p()):h=!0,{get entries(){return h||f(),n},get comment(){return a.toString()},set comment(e){a=o.toBuffer(e),d.commentLength=a.length},getEntryCount:function(){return h?n.length:d.diskEntries},forEach:function(e){h?n.forEach(e):function(e){const t=d.diskEntries;let n=d.offset;for(let i=0;i<t;i++){let t=n;const i=new r(c);i.header=c.slice(t,t+=o.Constants.CENHDR),i.entryName=c.slice(t,t+=i.header.fileNameLength),n+=i.header.entryHeaderSize,e(i)}}(e)},getEntry:function(e){return h||f(),s[e]||null},setEntry:function(e){h||f(),n.push(e),s[e.entryName]=e,d.totalEntries=n.length},deleteEntry:function(e){h||f();var t=s[e];if(t&&t.isDirectory){var r=this;this.getEntryChildren(t).forEach((function(t){t.entryName!==e&&r.deleteEntry(t.entryName)}))}n.splice(n.indexOf(t),1),delete s[e],d.totalEntries=n.length},getEntryChildren:function(e){if(h||f(),e.isDirectory){var t=[],r=e.entryName,i=r.length;return n.forEach((function(e){e.entryName.substr(0,i)===r&&t.push(e)})),t}return[]},compressToBuffer:function(){h||f(),n.length>1&&n.sort((function(e,t){var n=e.entryName.toLowerCase(),r=t.entryName.toLowerCase();return n<r?-1:n>r?1:0}));var e=0,t=[],r=[],i=0;d.size=0,d.offset=0,n.forEach((function(n){var o=n.getCompressedData();n.header.offset=i;var s=n.header.dataHeaderToBinary(),a=n.rawEntryName.length,l=n.extra.toString(),u=Buffer.alloc(a+l.length);n.rawEntryName.copy(u,0),u.fill(l,a);var c=s.length+u.length+o.length;i+=c,t.push(s),t.push(u),t.push(o);var h=n.packHeader();r.push(h),d.size+=h.length,e+=c+h.length})),e+=d.mainHeaderSize,d.offset=i,i=0;var s=Buffer.alloc(e);t.forEach((function(e){e.copy(s,i),i+=e.length})),r.forEach((function(e){e.copy(s,i),i+=e.length}));var l=d.toBinary();return a&&Buffer.from(a).copy(l,o.Constants.ENDHDR),l.copy(s,i),s},toAsyncBuffer:function(e,t,r,i){h||f(),n.length>1&&n.sort((function(e,t){var n=e.entryName.toLowerCase(),r=t.entryName.toLowerCase();return n>r?-1:n<r?1:0}));var s=0,l=[],u=[],c=0;d.size=0,d.offset=0;!function(t){var n=arguments.callee;if(t.length){var h=t.pop(),f=h.entryName+h.extra.toString();r&&r(f),h.getCompressedDataAsync((function(r){i&&i(f),h.header.offset=c;var p,m=h.header.dataHeaderToBinary();try{p=Buffer.alloc(f.length,f)}catch(e){p=new Buffer(f)}var g=m.length+p.length+r.length;c+=g,l.push(m),l.push(p),l.push(r);var y=h.packHeader();if(u.push(y),d.size+=y.length,s+=g+y.length,t.length)n(t);else{s+=d.mainHeaderSize,d.offset=c,c=0;var _=Buffer.alloc(s);l.forEach((function(e){e.copy(_,c),c+=e.length})),u.forEach((function(e){e.copy(_,c),c+=e.length}));var b=d.toBinary();a&&a.copy(b,o.Constants.ENDHDR),b.copy(_,c),e(_)}}))}}(n)}}}},35:function(e){e.exports=function(){let e={};const t=new WeakMap;class n{constructor(n,r){r=Object.assign({units:"metric",precision:1},e,r),t.set(this,r);const i={metric:[{from:0,to:1e3,unit:"B",long:"bytes"},{from:1e3,to:1e6,unit:"kB",long:"kilobytes"},{from:1e6,to:1e9,unit:"MB",long:"megabytes"},{from:1e9,to:1e12,unit:"GB",long:"gigabytes"},{from:1e12,to:1e15,unit:"TB",long:"terabytes"},{from:1e15,to:1e18,unit:"PB",long:"petabytes"},{from:1e18,to:1e21,unit:"EB",long:"exabytes"},{from:1e21,to:1e24,unit:"ZB",long:"zettabytes"},{from:1e24,to:1e27,unit:"YB",long:"yottabytes"}],metric_octet:[{from:0,to:1e3,unit:"o",long:"octets"},{from:1e3,to:1e6,unit:"ko",long:"kilooctets"},{from:1e6,to:1e9,unit:"Mo",long:"megaoctets"},{from:1e9,to:1e12,unit:"Go",long:"gigaoctets"},{from:1e12,to:1e15,unit:"To",long:"teraoctets"},{from:1e15,to:1e18,unit:"Po",long:"petaoctets"},{from:1e18,to:1e21,unit:"Eo",long:"exaoctets"},{from:1e21,to:1e24,unit:"Zo",long:"zettaoctets"},{from:1e24,to:1e27,unit:"Yo",long:"yottaoctets"}],iec:[{from:0,to:Math.pow(1024,1),unit:"B",long:"bytes"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"KiB",long:"kibibytes"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"MiB",long:"mebibytes"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"GiB",long:"gibibytes"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"TiB",long:"tebibytes"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"PiB",long:"pebibytes"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"EiB",long:"exbibytes"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"ZiB",long:"zebibytes"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"YiB",long:"yobibytes"}],iec_octet:[{from:0,to:Math.pow(1024,1),unit:"o",long:"octets"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"Kio",long:"kibioctets"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"Mio",long:"mebioctets"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"Gio",long:"gibioctets"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"Tio",long:"tebioctets"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"Pio",long:"pebioctets"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"Eio",long:"exbioctets"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"Zio",long:"zebioctets"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"Yio",long:"yobioctets"}]};Object.assign(i,r.customUnits);const o=n<0?"-":"";n=Math.abs(n);const s=i[r.units];if(!s)throw new Error(`Invalid units specified: ${r.units}`);{const e=s.find((e=>n>=e.from&&n<e.to));if(e){const t=0===e.from?o+n:o+(n/e.from).toFixed(r.precision);this.value=t,this.unit=e.unit,this.long=e.long}else this.value=o+n,this.unit="",this.long=""}}toString(){const e=t.get(this);return e.toStringFn?e.toStringFn.bind(this)():`${this.value} ${this.unit}`}}function r(e,t){return new n(e,t)}return r.defaultOptions=function(t){e=t},r}()},247:function(e,t){var n,r,i;r=[],void 0===(i="function"==typeof(n=function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function t(e,t){return-1===e.indexOf(t)?e.length:e.indexOf(t)}function n(e){var n=e.replace(/^v/,"").replace(/\+.*$/,""),r=t(n,"-"),i=n.substring(0,r).split(".");return i.push(n.substring(r+1)),i}function r(e){return isNaN(Number(e))?e:Number(e)}function i(t){if("string"!=typeof t)throw new TypeError("Invalid argument expected string");if(!e.test(t))throw new Error("Invalid argument not valid semver ('"+t+"' received)")}function o(e,t){[e,t].forEach(i);for(var o=n(e),s=n(t),a=0;a<Math.max(o.length-1,s.length-1);a++){var l=parseInt(o[a]||0,10),u=parseInt(s[a]||0,10);if(l>u)return 1;if(u>l)return-1}var c=o[o.length-1],d=s[s.length-1];if(c&&d){var h=c.split(".").map(r),f=d.split(".").map(r);for(a=0;a<Math.max(h.length,f.length);a++){if(void 0===h[a]||"string"==typeof f[a]&&"number"==typeof h[a])return-1;if(void 0===f[a]||"string"==typeof h[a]&&"number"==typeof f[a])return 1;if(h[a]>f[a])return 1;if(f[a]>h[a])return-1}}else if(c||d)return c?-1:1;return 0}var s=[">",">=","=","<","<="],a={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function l(e){if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===s.indexOf(e))throw new TypeError("Invalid operator, expected one of "+s.join("|"))}return o.validate=function(t){return"string"==typeof t&&e.test(t)},o.compare=function(e,t,n){l(n);var r=o(e,t);return a[n].indexOf(r)>-1},o})?n.apply(t,r):n)||(e.exports=i)},362:(e,t,n)=>{n.r(t),n.d(t,{activate:()=>je,deactivate:()=>Pe,downloadDeps:()=>de});const r=a.default;var i=n.n(r);const o=d.default;var s=n(622),l=n.n(s),u=n(747),h=n.n(u);const f=i().window.createOutputChannel("");function p(e){"string"==typeof e?e="[uni_modules] "+g(e):e.line="[uni_modules] "+g(e.line),f.appendLine(e)}const m={UserNotLogin:"当前功能需要登录HBuilderX",HostNotFoundError:"网络发生错误，请稍后重试！",OperationCanceledError:"网络发生错误，请稍后重试！",NoPermission:"检测到uni_modules插件代码被篡改，有可能存在安全隐患，解决此问题需要重新安装该插件或者HBuilderX。"};function g(e){return m[e]||e}function y(e){e=g(e),i().window.showErrorMessage(e,["确定"])}function _(e,t){"string"==typeof t?t="[插件:"+e+"] "+g(t):t.line="[插件:"+e+"] "+g(t.line),f.appendLine(t)}function b(e,t){if(!h().existsSync(t))return console.log(t+" not exists"),!1;const n=h().readdirSync(e),r=h().readdirSync(t);return console.log(n,r),!!n.find((e=>r.includes(e)))}const v=c.default;var w=n.n(v);const E=w().tmpdir();l().resolve(E,"uni_modules/upload");const C=l().resolve(E,"uni_modules/download"),D=l().resolve(E,"uni_modules/cache"),x=l().resolve(E,"uni_modules/tmp");function F(){return l().resolve(x,String(Date.now()),"uni_modules")}function S(e,t,n=!0){return function(e,t,n={},r=!0){console.log("request:"),console.log("method:",e),console.log("path:",t),console.log("params:",n);const o=i().http.request({url:"https://ext.dcloud.net.cn"+t,method:e,header:{token:"${user.checked.token}"},params:n}).then((({data:e})=>{console.log("response:"),console.log("data:",e);const t=JSON.parse(e);if(t.ret)throw new Error(t.desc);return t.data}));return r?o.catch((e=>{y(e.error||e.message)})):o}("post",e,t,n)}function k(e){return console.log("requestPlugins",e),e.length?S("/modules/download-dependencies",{dependencies:e.join(",")},!1).then((e=>{if(e)return e})):Promise.resolve([])}function T(e,t){void 0===t&&(t=!1);var n=e.length,r=0,i="",o=0,s=16,a=0,l=0,u=0,c=0,d=0;function h(t,n){for(var i=0,o=0;i<t||!n;){var s=e.charCodeAt(r);if(s>=48&&s<=57)o=16*o+s-48;else if(s>=65&&s<=70)o=16*o+s-65+10;else{if(!(s>=97&&s<=102))break;o=16*o+s-97+10}r++,i++}return i<t&&(o=-1),o}function f(){if(i="",d=0,o=r,l=a,c=u,r>=n)return o=n,s=17;var t=e.charCodeAt(r);if(I(t)){do{r++,i+=String.fromCharCode(t),t=e.charCodeAt(r)}while(I(t));return s=15}if(N(t))return r++,i+=String.fromCharCode(t),13===t&&10===e.charCodeAt(r)&&(r++,i+="\n"),a++,u=r,s=14;switch(t){case 123:return r++,s=1;case 125:return r++,s=2;case 91:return r++,s=3;case 93:return r++,s=4;case 58:return r++,s=6;case 44:return r++,s=5;case 34:return r++,i=function(){for(var t="",i=r;;){if(r>=n){t+=e.substring(i,r),d=2;break}var o=e.charCodeAt(r);if(34===o){t+=e.substring(i,r),r++;break}if(92!==o){if(o>=0&&o<=31){if(N(o)){t+=e.substring(i,r),d=2;break}d=6}r++}else{if(t+=e.substring(i,r),++r>=n){d=2;break}switch(e.charCodeAt(r++)){case 34:t+='"';break;case 92:t+="\\";break;case 47:t+="/";break;case 98:t+="\b";break;case 102:t+="\f";break;case 110:t+="\n";break;case 114:t+="\r";break;case 116:t+="\t";break;case 117:var s=h(4,!0);s>=0?t+=String.fromCharCode(s):d=4;break;default:d=5}i=r}}return t}(),s=10;case 47:var f=r-1;if(47===e.charCodeAt(r+1)){for(r+=2;r<n&&!N(e.charCodeAt(r));)r++;return i=e.substring(f,r),s=12}if(42===e.charCodeAt(r+1)){r+=2;for(var m=n-1,g=!1;r<m;){var y=e.charCodeAt(r);if(42===y&&47===e.charCodeAt(r+1)){r+=2,g=!0;break}r++,N(y)&&(13===y&&10===e.charCodeAt(r)&&r++,a++,u=r)}return g||(r++,d=1),i=e.substring(f,r),s=13}return i+=String.fromCharCode(t),r++,s=16;case 45:if(i+=String.fromCharCode(t),++r===n||!A(e.charCodeAt(r)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=function(){var t=r;if(48===e.charCodeAt(r))r++;else for(r++;r<e.length&&A(e.charCodeAt(r));)r++;if(r<e.length&&46===e.charCodeAt(r)){if(!(++r<e.length&&A(e.charCodeAt(r))))return d=3,e.substring(t,r);for(r++;r<e.length&&A(e.charCodeAt(r));)r++}var n=r;if(r<e.length&&(69===e.charCodeAt(r)||101===e.charCodeAt(r)))if((++r<e.length&&43===e.charCodeAt(r)||45===e.charCodeAt(r))&&r++,r<e.length&&A(e.charCodeAt(r))){for(r++;r<e.length&&A(e.charCodeAt(r));)r++;n=r}else d=3;return e.substring(t,n)}(),s=11;default:for(;r<n&&p(t);)r++,t=e.charCodeAt(r);if(o!==r){switch(i=e.substring(o,r)){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(t),r++,s=16}}function p(e){if(I(e)||N(e))return!1;switch(e){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}return{setPosition:function(e){r=e,i="",o=0,s=16,d=0},getPosition:function(){return r},scan:t?function(){var e;do{e=f()}while(e>=12&&e<=15);return e}:f,getToken:function(){return s},getTokenValue:function(){return i},getTokenOffset:function(){return o},getTokenLength:function(){return r-o},getTokenStartLine:function(){return l},getTokenStartCharacter:function(){return o-c},getTokenError:function(){return d}}}function I(e){return 32===e||9===e||11===e||12===e||160===e||5760===e||e>=8192&&e<=8203||8239===e||8287===e||12288===e||65279===e}function N(e){return 10===e||13===e||8232===e||8233===e}function A(e){return e>=48&&e<=57}function B(e,t,n){var r,i,o,s,a;if(t){for(s=t.offset,a=s+t.length,o=s;o>0&&!L(e,o-1);)o--;for(var l=a;l<e.length&&!L(e,l);)l++;i=e.substring(o,l),r=function(e,t){var n=0,r=0,i=t.tabSize||4;for(;n<e.length;){var o=e.charAt(n);if(" "===o)r++;else{if("\t"!==o)break;r+=i}n++}return Math.floor(r/i)}(i,n)}else i=e,r=0,o=0,s=0,a=e.length;var u,c=function(e,t){for(var n=0;n<t.length;n++){var r=t.charAt(n);if("\r"===r)return n+1<t.length&&"\n"===t.charAt(n+1)?"\r\n":"\r";if("\n"===r)return"\n"}return e&&e.eol||"\n"}(n,e),d=!1,h=0;u=n.insertSpaces?O(" ",n.tabSize||4):"\t";var f=T(i,!1),p=!1;function m(){return c+O(u,r+h)}function g(){var e=f.scan();for(d=!1;15===e||14===e;)d=d||14===e,e=f.scan();return p=16===e||0!==f.getTokenError(),e}var y=[];function _(n,r,i){p||t&&!(r<a&&i>s)||e.substring(r,i)===n||y.push({offset:r,length:i-r,content:n})}var b=g();if(17!==b){var v=f.getTokenOffset()+o;_(O(u,r),o,v)}for(;17!==b;){for(var w=f.getTokenOffset()+f.getTokenLength()+o,E=g(),C="",D=!1;!d&&(12===E||13===E);){_(" ",w,f.getTokenOffset()+o),w=f.getTokenOffset()+f.getTokenLength()+o,C=(D=12===E)?m():"",E=g()}if(2===E)1!==b&&(h--,C=m());else if(4===E)3!==b&&(h--,C=m());else{switch(b){case 3:case 1:h++,C=m();break;case 5:case 12:C=m();break;case 13:d?C=m():D||(C=" ");break;case 6:D||(C=" ");break;case 10:if(6===E){D||(C="");break}case 7:case 8:case 9:case 11:case 2:case 4:12===E||13===E?D||(C=" "):5!==E&&17!==E&&(p=!0);break;case 16:p=!0}!d||12!==E&&13!==E||(C=m())}17===E&&(C=n.insertFinalNewline?c:""),_(C,w,f.getTokenOffset()+o),b=E}return y}function O(e,t){for(var n="",r=0;r<t;r++)n+=e;return n}function L(e,t){return-1!=="\r\n".indexOf(e.charAt(t))}var j;function P(e,t){if(e){for(var n=e,r=0,i=t;r<i.length;r++){var o=i[r];if("string"==typeof o){if("object"!==n.type||!Array.isArray(n.children))return;for(var s=!1,a=0,l=n.children;a<l.length;a++){var u=l[a];if(Array.isArray(u.children)&&u.children[0].value===o){n=u.children[1],s=!0;break}}if(!s)return}else{var c=o;if("array"!==n.type||c<0||!Array.isArray(n.children)||c>=n.children.length)return;n=n.children[c]}}return n}}function $(e,t,n){void 0===n&&(n=j.DEFAULT);var r=T(e,!1);function i(e){return e?function(){return e(r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter())}:function(){return!0}}function o(e){return e?function(t){return e(t,r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter())}:function(){return!0}}var s=i(t.onObjectBegin),a=o(t.onObjectProperty),l=i(t.onObjectEnd),u=i(t.onArrayBegin),c=i(t.onArrayEnd),d=o(t.onLiteralValue),h=o(t.onSeparator),f=i(t.onComment),p=o(t.onError),m=n&&n.disallowComments,g=n&&n.allowTrailingComma;function y(){for(;;){var e=r.scan();switch(r.getTokenError()){case 4:_(14);break;case 5:_(15);break;case 3:_(13);break;case 1:m||_(11);break;case 2:_(12);break;case 6:_(16)}switch(e){case 12:case 13:m?_(10):f();break;case 16:_(1);break;case 15:case 14:break;default:return e}}}function _(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=[]),p(e),t.length+n.length>0)for(var i=r.getToken();17!==i;){if(-1!==t.indexOf(i)){y();break}if(-1!==n.indexOf(i))break;i=y()}}function b(e){var t=r.getTokenValue();return e?d(t):a(t),y(),!0}function v(){switch(r.getToken()){case 3:return function(){u(),y();for(var e=!1;4!==r.getToken()&&17!==r.getToken();){if(5===r.getToken()){if(e||_(4,[],[]),h(","),y(),4===r.getToken()&&g)break}else e&&_(6,[],[]);v()||_(4,[],[4,5]),e=!0}return c(),4!==r.getToken()?_(8,[4],[]):y(),!0}();case 1:return function(){s(),y();for(var e=!1;2!==r.getToken()&&17!==r.getToken();){if(5===r.getToken()){if(e||_(4,[],[]),h(","),y(),2===r.getToken()&&g)break}else e&&_(6,[],[]);(10!==r.getToken()?(_(3,[],[2,5]),0):(b(!1),6===r.getToken()?(h(":"),y(),v()||_(4,[],[2,5])):_(5,[],[2,5]),1))||_(4,[],[2,5]),e=!0}return l(),2!==r.getToken()?_(7,[2],[]):y(),!0}();case 10:return b(!0);default:return function(){switch(r.getToken()){case 11:var e=r.getTokenValue(),t=Number(e);isNaN(t)&&(_(2),t=0),d(t);break;case 7:d(null);break;case 8:d(!0);break;case 9:d(!1);break;default:return!1}return y(),!0}()}}return y(),17===r.getToken()?!!n.allowEmptyContent||(_(4,[],[]),!1):v()?(17!==r.getToken()&&_(9,[],[]),!0):(_(4,[],[]),!1)}function M(e){switch(typeof e){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":return e?Array.isArray(e)?"array":"object":"null";default:return"null"}}function U(e,t,n,r){for(var i,o=t.slice(),s=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=j.DEFAULT);var r={type:"array",offset:-1,length:-1,children:[],parent:void 0};function i(e){"property"===r.type&&(r.length=e-r.offset,r=r.parent)}function o(e){return r.children.push(e),e}$(e,{onObjectBegin:function(e){r=o({type:"object",offset:e,length:-1,parent:r,children:[]})},onObjectProperty:function(e,t,n){(r=o({type:"property",offset:t,length:-1,parent:r,children:[]})).children.push({type:"string",value:e,offset:t,length:n,parent:r})},onObjectEnd:function(e,t){i(e+t),r.length=e+t-r.offset,r=r.parent,i(e+t)},onArrayBegin:function(e,t){r=o({type:"array",offset:e,length:-1,parent:r,children:[]})},onArrayEnd:function(e,t){r.length=e+t-r.offset,r=r.parent,i(e+t)},onLiteralValue:function(e,t,n){o({type:M(e),offset:t,length:n,parent:r,value:e}),i(t+n)},onSeparator:function(e,t,n){"property"===r.type&&(":"===e?r.colonOffset=t:","===e&&i(t))},onError:function(e,n,r){t.push({error:e,offset:n,length:r})}},n);var s=r.children[0];return s&&delete s.parent,s}(e,[]),a=void 0,l=void 0;o.length>0&&(l=o.pop(),void 0===(a=P(s,o))&&void 0!==n);)"string"==typeof l?((i={})[l]=n,n=i):n=[n];if(a){if("object"===a.type&&"string"==typeof l&&Array.isArray(a.children)){var u=P(a,[l]);if(void 0!==u){if(void 0===n){if(!u.parent)throw new Error("Malformed AST");var c=a.children.indexOf(u.parent),d=void 0,h=u.parent.offset+u.parent.length;if(c>0)d=(v=a.children[c-1]).offset+v.length;else if(d=a.offset+1,a.children.length>1)h=a.children[1].offset;return R(e,{offset:d,length:h-d,content:""},r)}return R(e,{offset:u.offset,length:u.length,content:JSON.stringify(n)},r)}if(void 0===n)return[];var f=JSON.stringify(l)+": "+JSON.stringify(n),p=void 0;return R(e,p=(w=r.getInsertionIndex?r.getInsertionIndex(a.children.map((function(e){return e.children[0].value}))):a.children.length)>0?{offset:(v=a.children[w-1]).offset+v.length,length:0,content:","+f}:0===a.children.length?{offset:a.offset+1,length:0,content:f}:{offset:a.offset+1,length:0,content:f+","},r)}if("array"===a.type&&"number"==typeof l&&Array.isArray(a.children)){var m=l;if(-1===m){f=""+JSON.stringify(n),p=void 0;if(0===a.children.length)p={offset:a.offset+1,length:0,content:f};else p={offset:(v=a.children[a.children.length-1]).offset+v.length,length:0,content:","+f};return R(e,p,r)}if(void 0===n&&a.children.length>=0){var g=l,y=a.children[g];p=void 0;if(1===a.children.length)p={offset:a.offset+1,length:a.length-2,content:""};else if(a.children.length-1===g){var _=(v=a.children[g-1]).offset+v.length;p={offset:_,length:a.offset+a.length-2-_,content:""}}else p={offset:y.offset,length:a.children[g+1].offset-y.offset,content:""};return R(e,p,r)}if(void 0!==n){p=void 0,f=""+JSON.stringify(n);if(!r.isArrayInsertion&&a.children.length>l){var b=a.children[l];p={offset:b.offset,length:b.length,content:f}}else if(0===a.children.length||0===l)p={offset:a.offset+1,length:0,content:0===a.children.length?f:f+","};else{var v,w=l>a.children.length?a.children.length:l;p={offset:(v=a.children[w-1]).offset+v.length,length:0,content:","+f}}return R(e,p,r)}throw new Error("Can not "+(void 0===n?"remove":r.isArrayInsertion?"insert":"modify")+" Array index "+m+" as length is not sufficient")}throw new Error("Can not add "+("number"!=typeof l?"index":"property")+" to parent of type "+a.type)}if(void 0===n)throw new Error("Can not delete in empty document");return R(e,{offset:s?s.offset:0,length:s?s.length:0,content:JSON.stringify(n)},r)}function R(e,t,n){if(!n.formattingOptions)return[t];var r=V(e,t),i=t.offset,o=t.offset+t.content.length;if(0===t.length||0===t.content.length){for(;i>0&&!L(r,i-1);)i--;for(;o<r.length&&!L(r,o);)o++}for(var s=B(r,{offset:i,length:o-i},n.formattingOptions),a=s.length-1;a>=0;a--){var l=s[a];r=V(r,l),i=Math.min(i,l.offset),o=Math.max(o,l.offset+l.length),o+=l.content.length-l.length}return[{offset:i,length:e.length-(r.length-o)-i,content:r.substring(i,o)}]}function V(e,t){return e.substring(0,t.offset)+t.content+e.substring(t.offset+t.length)}!function(e){e.DEFAULT={allowTrailingComma:!1}}(j||(j={}));var H=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=j.DEFAULT);var r=null,i=[],o=[];function s(e){Array.isArray(i)?i.push(e):null!==r&&(i[r]=e)}return $(e,{onObjectBegin:function(){var e={};s(e),o.push(i),i=e,r=null},onObjectProperty:function(e){r=e},onObjectEnd:function(){i=o.pop()},onArrayBegin:function(){var e=[];s(e),o.push(i),i=e,r=null},onArrayEnd:function(){i=o.pop()},onLiteralValue:s,onError:function(e,n,r){t.push({error:e,offset:n,length:r})}},n),i[0]};function q(e,t,n,r){return U(e,t,n,r)}function z(e,t){for(var n=t.length-1;n>=0;n--)e=V(e,t[n]);return e}const W={formattingOptions:{tabSize:4,insertSpaces:!0}};function Z(e){return H(e)}const K=["id"];function J(e,t,n){for(let r=0;r<t.length;r++){const i=t[r];if(!e[i])return"插件["+(e.id||n)+"]根目录 package.json 中插件 "+i+" 不能为空"}}const G=K;const X={UniApp_Vue:function(e,t,n,r){const i=l().basename(e),o=J(t,K,i);if(o)return p({level:"error",line:o});if(!r.isPackageJson&&t.id!==i)return _(t.id,{level:"error",line:"根目录 package.json 中插件 id 必须与插件目录名保持一致"});if(!r.isPackageJson){const n=["pages.json","App.vue","main.js","manifest.json","uni.scss"].find((t=>h().existsSync(l().resolve(e,t))));if(n)return _(t.id,{level:"error",line:"根目录不支持"+n+"文件，请删除该文件后重试，若需要插件使用者修改项目"+n+"，请在插件文档说明要调整的"+n+"内容。"})}return t},Extension:function(e,t,n){const r=J(t,G,l().basename(e));return r?p({level:"error",line:r}):t.engines.HBuilderX?t:_(t.id,{level:"error",line:"根目录 package.json 中插件 engines->HBuilderX 不能为空"})}};function Q(e,t,n){const r=e.fsPath,i=e.workspaceFolder,o=i&&i.nature||"UniApp_Vue",s=l().resolve(r,"package.json");if(!h().existsSync(s))return _(l().basename(r),{level:"error",line:"根目录package.json不存在"});if(!X[o])return p({level:"error",line:"项目类型不正确："+o});let a=Z;"HBuilderX"===n&&(a=JSON.parse);try{const n=a(h().readFileSync(s).toString());return X[o](r,n,t,e)}catch(e){console.error(e);const t="根目录package.json格式不正确："+e.message;return _(l().basename(r),{level:"error",line:t})}}const Y='{\n  "id": "",\n  "displayName": "",\n  "version": "1.0.0",\n  "description": "",\n  "keywords": [],\n  "repository": "",\n  "engines": {\n    "HBuilderX": "^3.1.0"\n  },\n  "dcloudext": {\n    "category": [],\n    "sale": {\n      "regular": {\n        "price": "0.00"\n      },\n      "sourcecode": {\n        "price": "0.00"\n      }\n    },\n    "contact": {\n      "qq": ""\n    },\n    "declaration": {\n      "ads": "",\n      "data": "",\n      "permissions": ""\n    },\n    "npmurl": ""\n  },\n  "uni_modules": {\n    "dependencies": [],\n    "encrypt": [],\n    "platforms": {\n      "cloud": {\n        "tcb": "u",\n        "aliyun": "u"\n      },\n      "client": {\n        "App": {\n          "app-vue": "u",\n          "app-nvue": "u"\n        },\n        "H5-mobile": {\n          "Safari": "u",\n          "Android Browser": "u",\n          "微信浏览器(Android)": "u",\n          "QQ浏览器(Android)": "u"\n        },\n        "H5-pc": {\n          "Chrome": "u",\n          "IE": "u",\n          "Edge": "u",\n          "Firefox": "u",\n          "Safari": "u"\n        },\n        "小程序": {\n          "微信": "u",\n          "阿里": "u",\n          "百度": "u",\n          "字节跳动": "u",\n          "QQ": "u"\n        },\n        "快应用": {\n          "华为": "u",\n          "联盟": "u"\n        }\n      }\n    }\n  }\n}',ee=["package.json","src/pages.json","src/manifest.json","src/App.vue"];function te(e){return!ee.find((t=>!h().existsSync(l().resolve(e,t))))}function ne(e){const t=l().resolve(e,"../.."),n=l().resolve(e,"../../..");return te(n)?n:t}function re(e){return Array.isArray(e)&&2===e.length?e[0]===e[1]?e[0]:e[0]+"-"+e[1]:"插件"}var ie=n(285),oe=n.n(ie);function se(e){return require(l().resolve(i().env.appRoot,"plugins/npm/node_modules/npm/node_modules/",e))}function ae(e){return require(l().resolve(i().env.appRoot,"plugins/npm/node_modules/npm/lib",e))}n(35),JSON.stringify([{id:1,name:"HBuilderX",pid:0,children:[{id:11,name:"HBuilderX",pid:1}]}]),JSON.stringify([{id:3,name:"前端页面模板",pid:0,children:[{id:33,name:"uni-app前端项目模板",pid:3}]},{id:7,name:"uniCloud",pid:0,children:[{id:72,name:"云端一体项目模板",pid:7}]}]),l().resolve(w().tmpdir(),"uni_modules.form_meta.json");var le=n(247),ue=n.n(le);function ce(e){try{const{uni_modules:t}=Z(h().readFileSync(l().resolve(e,"package.json")).toString());if(t&&t.dependencies&&Array.isArray(t.dependencies))return Array.from(new Set(t.dependencies))}catch(e){console.error(e)}return[]}async function de(e,t,n){const r=ce(e);if(r.length){const e=await k(r);for(let r of e)r.downloadUrl&&await he({id:r.id,version:r.latestVersion},r.downloadUrl,n,t)}}function he(e,t,n,r){n.useCache=!1!==n.useCache,n.deps=!1!==n.deps,console.log("downloadPlugin",e,t,n,r);const o=e.id+"@"+e.version,s=o+".zip",a=l().resolve(n.output,e.id);if(h().existsSync(a))return Promise.resolve();const u=l().resolve(D,s);function c(){return function(e,t){return console.log("extractPlugin",e,t),new Promise(((n,r)=>{if(h().existsSync(t))return n(!1);new(oe())(e).extractAllToAsync(t,!0,(e=>e?r(e):n(!0)))}))}(u,a).then((t=>{if(t){if(n.deps)return de(a,e.id,n)}else console.log(a+"已存在，跳过")}))}return n.useCache&&h().existsSync(u)?(console.log("use uni_modules cache",u),c()):function(e,t,n){const r=l().resolve(n||C,e);return console.log("downloadFile",r),i().http.request({url:t,downloadFile:r}).then((()=>r))}(s,t,D).then((()=>c())).catch((e=>{console.error(e),_(o,{level:"error",line:`下载失败：${g(e.error||e.message)}`})}))}function fe(e,t){return p("copyFileWithPrompt:"+e+","+t),i().workspace.copyFileWithPrompt({src:i().Uri.file(e),dest:i().Uri.file(t),defaction:"compare",showcomparebutton:!0}).then((e=>(console.log("copyFileWithPrompt end",e),e))).catch((e=>{console.error(e),_("uni_modules",{level:"error",line:e.toString()})}))}function pe({name:e,version:t,size:n}){return e.length,`<table width="100%">\n    <tr>\n        <td>插件名称：${function(e,t=20){const n=e.substring(0,t),r=n.match(/[\u4e00-\u9fa5]/g),i=r?r.length:0,o=2*n.length-i;return e.substr(0,o)+(o<e.length?"...":"")}(e)}</td>\n        <td>插件版本：${t}</td>\n    </tr>\n    <tr>\n        <td>插件大小：${n}</td>\n        <td></td>\n    </tr>\n  </table>`}function me(e){i().window.registerUriHandler({handleUri:function(e){const{plugin:t}=(0,o.parse)(e.query);if(!t)return;const n=JSON.parse(t);p(JSON.stringify(n)),function(e){p(i().env.appName),p(i().env.appVersion);const t=e.ide_version;if(t&&1===ue()(t,i().env.appVersion))return i().window.showMessageBox({type:"warning",title:"升级提示",text:`导入当前插件需要HBuilderX ${t} 以上版本，请先升级。<br>可通过菜单【帮助】-【检查更新】触发升级流程`,buttons:["知道了"]});i().window.showWorkspaceFolderPick({title:"选择一个uni-app项目导入该插件",description:pe(e),platforms:e.platforms||[],filterTypes:["UniApp_Vue"],showSpaceName:!0}).then((({path:t,platform:n})=>{if(p(JSON.stringify({projectPath:t,platform:n})),!t)return;let r=l().basename(t),i="uni_modules";te(t)&&(t=l().resolve(t,"src"),i="src/uni_modules");const o=F();he({id:e.id,version:e.version},e.download_url,{output:o}).then((()=>{const n=o+"/",s=l().resolve(t,"uni_modules");b(n,s)&&_(e.id,"有同名文件，请处理合并"),fe(n,s).then((t=>{1===t?_(e.id,{level:"warn",line:"导入被取消"}):0===t&&_(e.id,{level:"success",line:"导入["+r+"/"+i+"]成功"})}))}))}))}(n)}},e)}const ge=[{id:2,name:"前端组件",children:[{id:21,name:"通用组件",alias:"前端组件-通用组件",files:["components","components/{id}","component.vue"]},{id:23,name:"小程序组件",alias:"前端组件-小程序组件",files:["wxcomponents"]}]},{id:4,name:"JS SDK",children:[{id:41,name:"JS SDK",files:["js_sdk"]}]},{id:3,name:"前端页面模板",children:[{id:31,name:"前端页面模板",files:["pages"]}]},{id:7,name:"uniCloud",children:[{id:71,name:"云函数模板",files:["uniCloud/cloudfunctions","uniCloud/database"]},{id:73,name:"云端一体页面模板",files:["uniCloud/cloudfunctions","uniCloud/database","pages"]},{id:74,name:"Admin插件",alias:"uniCloud Admin插件",files:["uniCloud/cloudfunctions","uniCloud/database","pages","menu.json"]},{id:76,name:"DB Schema及验证函数",files:["uniCloud/database"]}]}].reduce(((e,t)=>(t.children.forEach((n=>{e.push(Object.assign({category:[t.name,n.name]},n))})),e)),[]),ye="^[a-zA-Z]\\w*(-[a-zA-Z\\w]*)+[a-zA-Z0-9]$",_e=new RegExp(ye),be=/^(uni|dcloud)/i;function ve(e,t){return function(e,t,n=Y){return n=z(n,q(n,["id"],e,W)),n=z(n,q(n,["displayName"],e,W)),n=z(n,q(n,["description"],e,W)),n=z(n,q(n,["keywords"],[e],W)),Array.isArray(t)&&2===t.length&&(n=z(n,q(n,["dcloudext","category"],t,W))),n}(e,t&&t.category)}const we=[{pattern:"",errorMsg:"插件ID不能为空"},{pattern:ye,errorMsg:"插件ID格式不正确，格式为：'作者ID-插件英文名称'，如：xx-yy"},{pattern:"^(?i)(?!uni|dcloud)",errorMsg:"插件ID不能使用`DCloud`、`uni`等关键字"}];function Ee(e){const t=e.fsPath;i().window.showFileWizardDialog({title:"新建uni_modules插件",footer:'<p style="text-align:left">插件名称等更多信息后续可以在插件根目录的package.json中修改，详见：<a style="color:#3aad4f" href="https://uniapp.dcloud.net.cn/uni_modules?id=packagejson">文档</a></p>',template:ge.map((e=>e.alias||e.name)),listTitle:"选择分类",namePlaceholder:"请输入插件ID，格式为：'作者ID-插件英文名称'，如：xx-yy",folderEditable:!1,nameValidators:we}).then((e=>{if(console.log(e),!e.file)return;const n=l().basename(e.file);if(!_e.test(n))return y("插件ID格式不正确，格式为：'作者ID-插件英文名称'，如：xx-yy");if(be.test(n))return y("插件ID不能使用`DCloud`、`uni`等关键字");const r=l().resolve(t,n);if(h().existsSync(r))return y("目录["+n+"]已存在");let i;const o=[];e.template&&(i=ge.find((t=>t.alias===e.template||t.name===e.template)),i&&o.push(...i.files));try{h().mkdirSync(r)}catch(e){return y(e.message)}const s=function(e,t){return function(n,r=""){try{h().writeFileSync(l().resolve(t,e,n),r)}catch(e){y(e.message)}}}(n,t);if(o.length){const e=se("mkdirp");try{o.forEach((r=>{"component.vue"===(r=r.replace(/\{id\}/g,n))?s("components/"+n+"/"+n+".vue","<template>\n</template>\n<script>\n<\/script>\n<style>\n</style>\n"):"menu.json"===r?s("menu.json",JSON.stringify([],null,2)):e.sync(l().resolve(t,n,r))}))}catch(e){return y(e.message)}}s("readme.md",`# ${n}`),s("changelog.md"),s("package.json",ve(n,i)),p({level:"success",line:re(i&&i.category)+"["+n+"]创建成功"})}))}async function Ce(e){if(!Q(e,y))return;const t=e.fsPath,n=l().basename(t),r=ce(t);if(r.length){_(n,"开始下载所有的三方依赖");const e=F();try{const i=await k(r);for(let t of i)t.downloadUrl?await he({id:t.id,version:t.latestVersion},t.downloadUrl,{output:e},n):_(n,{level:"warn",line:`三方依赖[${t.id}]不存在`});_(n,"所有的三方依赖下载完成");const o=e+"/",s=l().resolve(t,"..");b(o,s)&&_(n,"有同名文件，请处理合并"),fe(o,s).then((e=>{1===e?_(n,{level:"warn",line:"安装插件三方依赖被取消"}):0===e&&_(n,{level:"success",line:"所有的三方依赖安装完成"})}))}catch(e){console.log(e),_(n,{level:"error",line:"三方依赖安装失败："+g(e.error||e.message)})}}else _(n,"三方依赖列表为空")}function De(e){let t=e.fsPath;te(t)&&(t=l().resolve(t,"src"));const n=l().resolve(t,"uni_modules");if(h().existsSync(n))return p({level:"warn",line:"当前项目已存在目录[uni_modules]"});try{h().mkdirSync(n)}catch(e){return p({level:"error",line:e.message})}p({level:"success",line:"目录创建成功"})}const xe=ae("npm"),Fe=se("npm-lifecycle"),Se=ae("config/lifecycle");function ke(e,{wd:t,ids:n}){const r=function(e){const t=l().resolve(e,"uni_modules.config.json");if(console.log("config",t),!h().existsSync(t))return{scripts:{}};let n={};try{n=Z(h().readFileSync(t).toString())}catch(e){}n.scripts||(n.scripts={});return n}(t);console.log("postupdate config",r);const i=r.scripts[e];return i?new Promise((r=>{xe.load((()=>{process.env.UNI_MODULES_ID=n.join(","),p("开始执行"+e+"脚本"),p("> "+i),function(e,t,n,r,i){"function"==typeof r&&(i=r,r=null);const o=Se(r);Fe(e,t,n,o).then(i,i)}({_id:"uni_modules",scripts:{[e]:i}},e,t,{scriptsPrependNodePath:!0},(t=>{p(e+"脚本执行结束"),console.log(e+" done",t),r(!0)}))}))})):Promise.resolve(!1)}function Te(e,t,n){const r=Q(e,y);if(r)return _(r.id,"开始检查更新"),S("/modules/check-update",{plugin_id:r.id,version:r.version},!1).then((e=>{if(e){if(e.hasNewVersion)return n.push(r.id),_(r.id,"发现新版本["+e.latestVersion+"]"),he({id:r.id,version:e.latestVersion},e.downloadUrl,{output:t,deps:!1}).then((async()=>{const e=ce(l().resolve(t,r.id));if(e.length){_(r.id,"开始下载所有的三方依赖");const n=await k(e);for(let e of n)e.downloadUrl?await he({id:e.id,version:e.latestVersion},e.downloadUrl,{output:t},r.id):_(r.id,{level:"warn",line:`三方依赖[${e.id}]不存在`});_(r.id,"所有的三方依赖下载完成")}}));_(r.id,"本地["+r.version+"]已经是最新版本")}}))}async function Ie(e){let t=!1,n="";const r=F();if(!Array.isArray(e)){const r=e.fsPath;if(r.endsWith("uni_modules")){n=ne(l().resolve(r,"test"));const t=Object.assign({},e),i=h().readdirSync(e.fsPath);e=[];for(const n of i){const i=l().resolve(r,n);h().existsSync(l().resolve(i,"package.json"))&&e.push(Object.assign({},t,{fsPath:i}))}}else r.endsWith("package.json")?(t=!0,e.fsPath=l().dirname(e.fsPath),e.isPackageJson=!0,n=e.fsPath,e=[e]):e=[e]}if(n||(n=ne(e[0].fsPath)),te(n)&&(n=l().resolve(n,"src")),!e.length)return p("未查找到uni_modules插件");const i=[];for(const t of e)try{await Te(t,r,i)}catch(e){console.log(e),_(l().basename(t.fsPath),{level:"error",line:e.error||e.message});break}if(i.length){const e=(t?l().join(r,i[0]):r)+"/",o=t?n:l().resolve(n,"uni_modules");p("有同名文件，请处理合并"),console.log("update.copyFileWithPrompt",e,o);const s=await fe(e,o);1===s?p({level:"error",line:"插件更新被取消"}):0===s&&(p({level:"success",line:"插件更新成功"}),await async function(e,t){return console.log("postupdate",e,t),ke("postupdate",{wd:e,ids:t})}(n,i))}}const Ne={title:"发布到插件市场",description:"向插件市场发布新插件或新版本",dialogButtons:["提交","取消"],size:{width:730,height:600}};function Ae(e,t,n){const r=t.fsPath;if(!Q(t,y,t.workspaceFolder&&"Extension"===t.workspaceFolder.nature?"HBuilderX":"uni_modules"))return function(e){i().workspace.openTextDocument(l().resolve(e,"package.json"))}(r)}async function Be(e){if(console.log(e),Array.isArray(e))return y("您选择了多个目录，仅支持上传单个插件");e.fsPath.endsWith("package.json")&&(e.fsPath=l().dirname(e.fsPath),e.isPackageJson=!0),Ae(0,e)}async function Oe(e){if(Array.isArray(e))return p({level:"error",line:"您选择了多个目录，仅支持修改单个插件基本信息"});e.fsPath.endsWith("package.json")&&(e.fsPath=l().dirname(e.fsPath),e.isPackageJson=!0),Ae(0,e,Object.assign({},Ne,{title:"修改插件基本信息",description:"修改插件市场插件的基本信息，readme.md等。"}))}function Le(e){e.fsPath.endsWith("package.json")&&(e.fsPath=l().dirname(e.fsPath),e.isPackageJson=!0);const t=Q(e,y);t&&i().env.openExternal("https://ext.dcloud.net.cn/plugin?name="+t.id)}function je(e){const{commands:t}=i(),{subscriptions:n}=e;me(e),n.push(t.registerCommand("uni_modules.create",Ee)),n.push(t.registerCommand("uni_modules.install",Ce)),n.push(t.registerCommand("uni_modules.mkdir",De)),n.push(t.registerCommand("uni_modules.update",Ie)),n.push(t.registerCommand("uni_modules.updateInfo",Oe)),n.push(t.registerCommand("uni_modules.upload",Be)),n.push(t.registerCommand("uni_modules.view",Le))}function Pe(){}},747:e=>{e.exports=l.default},503:e=>{},622:e=>{e.exports=u.default},761:e=>{e.exports=h.default}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}return n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(362)})())}));const{SchemaToCode:kt}=xt;const Tt=new class extends kt{constructor(){super(),this._inputDir=null,this._output=null,this._schemaToCodeTempDir=u.default.join(c.default.tmpdir(),"schema2code"),this._inputFileData=""}get collection(){return this._collection}get output(){return this._output}load(e,{workspace:t}){this._inputFileData=l.default.readFileSync(e).toString("utf-8"),this._inputDir=u.default.dirname(e),this._collection=this._getCollection(u.default.basename(e)),this._jsonFile=this.loadJsonFile(e);let n=super.load(this._jsonFile),r=this.schema.dependencies;return r.length&&this.loadReferenceSchemaFile({workspace:t,dependencies:r,filePath:e}),n}loadFile(e,t,{workspace:n}){this._inputFileData=l.default.readFileSync(e).toString("utf-8"),this._inputDir=u.default.dirname(e),this._collection=this._getCollection(u.default.basename(e)),this._jsonFile=E.parse(t);let r=super.load(this._jsonFile),i=this.schema.dependencies;return i.length&&this.loadReferenceSchemaFile({workspace:n,dependencies:i,filePath:e}),r}loadJsonFile(e){let t=l.default.readFileSync(e).toString("utf-8");return E.parse(t)}loadReferenceSchemaFile({workspace:e,dependencies:t,filePath:n}){let r={};for(let e=0;e<t.length;e++)r[t[e]]=null;const i=e.uri.fsPath;this.findReferenceSchemaFile(u.default.dirname(n),r),this.findReferenceSchemaFile(i+"/uniCloud-aliyun/database",r),this.findReferenceSchemaFile(i+"/uniCloud-aliyun/tcb",r);for(const e in r){if(null==r[e]){throw new Error(`加载关联表 [${e}] 时出现错误，请检查是否存在`)}r[e]=this.loadJsonFile(r[e])}this.loadContinue({schemas:r})}findReferenceSchemaFile(e,t){for(const n in t)if(null==t[n]){const r=u.default.join(e,n+".schema.json");v.exists(r)&&(t[n]=r)}}async buildAllProject(e={}){this._resetSchemaDir(),this.fixOptions2(e),super.build(e);let t=this.loadValidateFunctionFiles();t.length&&(this.projectBuilder.updateValidatorFunction(t),this.adminProjectBuilder.updateValidatorFunction(t)),this.projectBuilder.updateSchemaData(this._inputFileData),this.adminProjectBuilder.updateSchemaData(this._inputFileData)}async buildUniApp(e={}){this._resetSchemaDir(),this.fixOptions2(e),super.buildProject(e);let t=this.loadValidateFunctionFiles();return t.length&&this.projectBuilder.updateValidatorFunction(t),this.projectBuilder.updateSchemaData(this._inputFileData),e}async buildUniAppAdmin(e={}){this._resetSchemaDir(),this.fixOptions2(e),super.buildAdminProject(e);let t=this.loadValidateFunctionFiles();return t.length&&this.adminProjectBuilder.updateValidatorFunction(t),this.adminProjectBuilder.updateSchemaData(this._inputFileData),e}fixOptions2(e){void 0===e.collection&&(e.collection=this._collection)}async exportUniApp(e={}){const t=u.default.join(this._output,"uni-app");this._writeTreeFiles(this.project,t),await this.downloadComponent(this.projectBuilder.components,this._getComponentOutput(e.codeType))}async exportUniAppModules(e={}){e.collection||(e.collection=this._collection);const t=e.collection,n=u.default.join(this._output,"uni-app.uni_modules");e.pluginId&&e.pluginId!==t&&this.projectBuilder.buildUniModules(e),this._writeTreeFiles(this.projectForUniModules,n),await this.downloadComponent(this.projectBuilder.components,this._getComponentOutput(e.codeType))}async exportUniAdmin(e={}){const t=u.default.join(this._output,"uni-admin");this._writeTreeFiles(this.adminProject,t),await this.downloadComponent(this.adminProjectBuilder.components,this._getComponentOutput(e.codeType))}async exportUniAdminModules(e={}){e.collection||(e.collection=this._collection);const t=e.collection,n=u.default.join(this._output,"uni-admin.uni_modules");e.pluginId&&e.pluginId!==t&&this.adminProjectBuilder.buildUniModules(e),this._writeTreeFiles(this.adminProjectForUniModules,n),await this.downloadComponent(this.adminProjectBuilder.components,this._getComponentOutput(e.codeType))}loadValidateFunctionFiles(){let e=this.schema.validateFunctions,t=u.default.join(this._inputDir,"validateFunction"),n=new Array(e.length);for(let r=0;r<n.length;r++){let i=e[r]+".js";n[r]={id:i,label:i,content:l.default.readFileSync(u.default.join(t,i)).toString("utf-8")}}return n}async downloadComponent(e,t){if(!e||!e.length)return;let n=u.default.join(t,"schema-to-code");Ft.uni_modules.dependencies=e,this._writeFile(u.default.join(n,"package.json"),JSON.stringify(Ft));try{await St.downloadDeps(n,"schema-to-code",{useCache:!0,deps:!0,output:t})}catch(e){throw e}v.deleteFile(n),v.deleteEmptyDirs(n)}_writeTreeFiles(e,t){let n=[];this.extractFileTree(e,n);for(let e=0;e<n.length;e++){const{fullPath:r,content:i}=n[e];this._writeFile(u.default.join(t,r),i)}}_resetSchemaDir(){let e=this._schemaToCodeTempDir;l.default.existsSync(e)&&(v.deleteFile(e),v.deleteEmptyDirs(e)),l.default.mkdirSync(e),this._output=e}_writeFile(e,t){try{v.saveFile(e,t,"utf8")}catch(e){console.log(e)}}_getComponentOutput(e){return u.default.join(this._schemaToCodeTempDir,e,"uni_modules")}_getCollection(e){return e.substring(0,e.lastIndexOf(".schema.json"))}},It=l.default.readFileSync(u.default.join(__dirname,"index.html")).toString(),Nt=l.default.readFileSync(u.default.join(__dirname,"index.js")).toString(),At=l.default.readFileSync(u.default.join(__dirname,"./highlight.pack.js")).toString(),Bt=It.split("\x3c!--js--\x3e"),Ot=Bt[0]+`<script>${At}<\/script>`+`<script>${Nt}<\/script>`+Bt[1],Lt="uni-app",jt="uni-app.uni_modules",Pt="uni-admin",$t="uni-admin.uni_modules",Mt="all",Ut="uni-app",Rt="uni-admin",Vt={modal:!1,title:"schema2code",description:"",dialogButtons:["确定","取消"],size:{width:960,height:640}},Ht={enableScripts:!0};class qt{constructor(e,t){this._webviewDialog=a.default.window.createWebViewDialog(Vt,Ht),this._webview=this._webviewDialog.webView,this._webview.onDidReceiveMessage(this.onWebviewMessage.bind(this)),this._workspace="",this._filePath="",this._fileName="",this._fileText="",this._isExplorer=!0,this._args(e),t&&(this._outputProjectWorkspace=t.filePath)}get isExplorer(){return this._isExplorer}async show(){this._webview.html=Ot;try{this.isExplorer?Tt.load(this._filePath,{workspace:this._workspace}):Tt.loadFile(this._filePath,this._fileText,{workspace:this._workspace}),await Tt.buildAllProject(),this._webviewDialog.show().then((e=>{}))}catch(e){this.close(),a.default.window.showErrorMessage(e.toString(),["是"])}}close(){this._webviewDialog.close()}async postMessageToWebview(e,t){this._webview.postMessage({command:e,data:{collection:Tt.collection,fields:Tt.fields,checkedFields:t||Tt.checkedFields,project:Tt.project,projectForUniModules:Tt.projectForUniModules,adminProject:Tt.adminProject,adminProjectForUniModules:Tt.adminProjectForUniModules}})}async onWebviewMessage(e){if("ready"==e.command)this.postMessageToWebview(Mt);else if("submit"==e.command)this._webviewDialog.setButtonStatus("确定",["loading","disable"]),this.exportToHX(e.exportType,e.pluginId);else if("cancel"==e.command)this.close();else if("build"==e.command){const{buildType:t,projectType:n,fields:r}=e;switch(t){case Ut:let e=await Tt.buildUniApp({fields:r,projectType:n});this.postMessageToWebview(t,e.fields);break;case Rt:let i=await Tt.buildUniAppAdmin({fields:r});this.postMessageToWebview(t,i.fields)}}}async exportToHX(e,t){const n={codeType:e,pluginId:t};try{e===Lt?await Tt.exportUniApp(n):e===jt?await Tt.exportUniAppModules(n):e===Pt?await Tt.exportUniAdmin(n):e===$t&&await Tt.exportUniAdminModules(n)}catch(e){this.close(),a.default.window.showErrorMessage(e.toString(),["是"])}let r=u.default.join(Tt.output,e)+"/",i=this._outputProjectWorkspace,o="pages_init.json";e!=jt&&e!=$t||(o=u.default.join("uni_modules",t,o)),await this.copyToHX(r,i,o,(()=>{this.close()}))}async copyToHX(e,t,n,r){if(a.default.workspace.showSubPackgeWindow){if(3==await a.default.workspace.showSubPackgeWindow({srcPath:e,destPath:t,specialFile:n,pluginName:"schema2code",showWindow:!0}))return void r();v.deleteFile(u.default.join(e,n))}else a.default.workspace.specialFileOperate&&a.default.workspace.specialFileOperate({srcPath:e,destPath:t,specialFile:n,pluginName:"schema2code"});a.default.workspace.copyFileWithPrompt({src:a.default.Uri.file(e),dest:a.default.Uri.file(t),rootPromptTips:"tips",filePromptTips:"tipstitle",defaction:"compare",showcomparebutton:!0,filter:function(e){return 0},errorHandler:function(e){return 0}}).then((e=>{r()})).catch((e=>{console.log(e)}))}_args(e){if(e.fsPath){this._isExplorer=!0;const{workspace:t,workspaceFolder:n,fsPath:r}=e;this._workspace=t,this._outputProjectWorkspace=n.uri.fsPath,this._filePath=r}else if(e.document){this._isExplorer=!1;const{workspaceFolder:t,text:n,uri:r}=e.document;this._workspace=e.document,this._outputProjectWorkspace=t.uri.fsPath,this._filePath=r.fsPath,this._fileText=n}}}var zt=async function(e,t){new qt(e,t).show()};function Wt(e,t){const n=e.document;if(n&&n.isDirty){a.default.window.showMessageBox({type:"question",title:"schema2code",text:"当前文档尚未保存，可能存在语法错误，继续执行 schema2code 吗?",buttons:["确定","取消"]}).then((t=>{"确定"==t&&zt(e)}))}else e.workspace=e.document?e.document.workspaceFolder:e.workspaceFolder,zt(e,t)}var Zt={activate:function(e){let t=a.default.commands.registerCommand("extension.schema2code",(e=>{!async function(e){a.default.unicloud.getCoverRelationWorkspaceFolder?async function(e,t){await async function(e,t){let n=[],r=[],i=e.document?e.document.workspaceFolder:e.workspaceFolder,o=e.fsPath||e.document.uri.fsPath,s={label:i.name,filePath:i.uri.path};if(o.includes("uniCloud-aliyun")||o.includes("uniCloud-tcb")||!o.includes("uni_modules")){let e=o.split("/").find((e=>"uniCloud-aliyun"===e||"uniCloud-tcb"===e));e&&(e=e.split("-")[1]);try{let t=await a.default.unicloud.getCoverRelationWorkspaceFolder(i,e);r.push(...t)}catch(e){t(n)}}else try{let e=await a.default.unicloud.getCoverRelationWorkspaceFolder(i,"aliyun"),t=await a.default.unicloud.getCoverRelationWorkspaceFolder(i,"tcb");r.push(...e),r.push(...t)}catch(e){t(n)}if(r.length){n.push(s);let e=[];for(let t=0;t<r.length;t++){let{name:i,uri:o}=r[t];e.indexOf(o.path)>-1||(n.push({label:i,filePath:o.path}),e.push(o.path))}}t(n)}(e,(e=>{if(e&&e.length){a.default.window.showQuickPick(e,{placeHolder:"请选择目标项目"}).then((n=>{n.filePath!=e[0].filePath?t(n):t()}))}else t()}))}(e,(t=>{Wt(e,t)})):Wt(e)}(e)}));e.subscriptions.push(t)},deactivate:function(){}};module.exports=Zt;
